"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[84676],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(a),d=r,u=h["".concat(s,".").concat(d)]||h[d]||m[d]||o;return a?n.createElement(u,i(i({ref:t},p),{},{components:a})):n.createElement(u,i({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},37046:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={title:"Tag Guide",date:"2021-11-18",sidebar_position:200},i=void 0,l={unversionedId:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/index",id:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/index",title:"Tag Guide",description:"This template implements the Snowplow Analytics JavaScript tracker v3. The template supports all the features of the tracker, with a few exceptions due to the limitations of custom templates\u2019 sandboxed JavaScript.",source:"@site/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide",slug:"/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/tag-template-guide/index.md",tags:[],version:"current",lastUpdatedAt:1661352356,formattedLastUpdatedAt:"Aug 24, 2022",sidebarPosition:200,frontMatter:{title:"Tag Guide",date:"2021-11-18",sidebar_position:200},sidebar:"tutorialSidebar",previous:{title:"Settings Guide",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v3/settings-variable-guide/"},next:{title:"Template for JavaScript Tracker v2",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/google-tag-manager-custom-template/template-for-javascript-tracker-v2/"}},s={},c=[{value:"Install the template",id:"install-the-template",level:2},{value:"Caveats",id:"caveats",level:2},{value:"Instructions",id:"instructions",level:2},{value:"Settings Configuration",id:"settings-configuration",level:3},{value:"Tag Type",id:"tag-type",level:3},{value:"Tags with a parameter object",id:"tags-with-a-parameter-object",level:4},{value:"Special tags",id:"special-tags",level:4},{value:"Enhanced Ecommerce",id:"enhanced-ecommerce",level:5},{value:"Form Tracking",id:"form-tracking",level:5},{value:"Link Click Tracking",id:"link-click-tracking",level:5},{value:"Page View",id:"page-view",level:5},{value:"Custom Commands",id:"custom-commands",level:4},{value:"Additional Tracking Parameters",id:"additional-tracking-parameters",level:3},{value:"Acknowledgements",id:"acknowledgements",level:3}],p={toc:c};function m(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This template implements the ",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/"},"Snowplow Analytics JavaScript tracker v3"),". The template supports all the features of the tracker, with a few exceptions due to the limitations of custom templates\u2019 sandboxed JavaScript."),(0,r.kt)("h2",{id:"install-the-template"},"Install the template"),(0,r.kt)("p",null,"To ",(0,r.kt)("strong",{parentName:"p"},"install the template"),", browse to ",(0,r.kt)("strong",{parentName:"p"},"Templates")," in the Google Tag Manager user interface."),(0,r.kt)("p",null,"Under ",(0,r.kt)("strong",{parentName:"p"},"Tag Templates"),", click ",(0,r.kt)("strong",{parentName:"p"},"Search Gallery"),", and type ",(0,r.kt)("inlineCode",{parentName:"p"},"snowplow analytics v3")," into the gallery overlay search bar."),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(7594).Z,width:"999",height:"210"})),(0,r.kt)("p",null,"Click the ",(0,r.kt)("strong",{parentName:"p"},"Snowplow Analytics v3")," template name, and then click ",(0,r.kt)("strong",{parentName:"p"},"Add to Workspace")," in the next screen. Review the permissions and click ",(0,r.kt)("strong",{parentName:"p"},"Add")," to finalize the import."),(0,r.kt)("p",null,"After importing the template, you can follow the normal process of creating a ",(0,r.kt)("strong",{parentName:"p"},"new tag")," in Google Tag Manager, and the ",(0,r.kt)("strong",{parentName:"p"},"Snowplow Analytics v3")," template will be listed among the ",(0,r.kt)("strong",{parentName:"p"},"Custom")," tag types you can choose from."),(0,r.kt)("h2",{id:"caveats"},"Caveats"),(0,r.kt)("p",null,"To begin with, some of the caveats of using the Custom Template."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Any methods that require the parsing of HTML elements (e.g. link tracking filter functions, cross domain linking) will not work and are thus disabled."),(0,r.kt)("li",{parentName:"ul"},"Automatic error tracking does not work due to lack of support for the ",(0,r.kt)("inlineCode",{parentName:"li"},"ErrorEvent")," API."),(0,r.kt)("li",{parentName:"ul"},"There is no implementation for the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#ecommerce"},"standard ecommerce")," events. Users are encouraged to implement the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#enhanced-ecommerce"},"enhanced ecommerce")," setup instead.")),(0,r.kt)("h2",{id:"instructions"},"Instructions"),(0,r.kt)("p",null,"Here are basic instructions for how to instrument the JavaScript tracker v3. You are encouraged to consult the ",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/"},"technical documentation")," for more information on each individual feature."),(0,r.kt)("p",null,"In general, when the tag fires, it first checks if the Snowplow JavaScript library has been loaded from the self-hosted URL provided in the template settings (more on this below). Then, the tag checks whether a tracker with the given ",(0,r.kt)("strong",{parentName:"p"},"Tracker Name")," has already been initialized. If not, it proceeds to initialize the new tracker."),(0,r.kt)("p",null,"Finally, the tag bundles a ",(0,r.kt)("strong",{parentName:"p"},"command")," from the settings in the tag, and sends it to the given ",(0,r.kt)("strong",{parentName:"p"},"Collector Endpoint"),"."),(0,r.kt)("h3",{id:"settings-configuration"},"Settings Configuration"),(0,r.kt)("p",null,"The Tag template requires a Settings Variable template to be configured which can be referenced within the Tag. This settings template contains the information required for the Tag to appropriate initialize the tracker."),(0,r.kt)("p",null,"Once a settings variable has been configured, it can be attached to the Tag in the ",(0,r.kt)("strong",{parentName:"p"},"Tracker Initialisation")," section."),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(52450).Z,width:"920",height:"518"})),(0,r.kt)("p",null,"You can also choose to override some of the parameters specifically for this tag if you wish to, such as sending the creating a new tracker by overriding the Tracker Name and a new Collector Endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Self Hosted JavaScript Tracker")),(0,r.kt)("p",null,"If you have the Snowplow library ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/Self-hosting-snowplow-js"},"self-hosted"),", and have configured it as such in your Settings variable, you need to update the ",(0,r.kt)("strong",{parentName:"p"},"Injects Scripts")," permission to reflect the new location, by editing the ",(0,r.kt)("strong",{parentName:"p"},"Snowplow Analytics v3 Tag template"),". Delete the content of the ",(0,r.kt)("strong",{parentName:"p"},"Allowed URL Match Patterns")," field, and type the full URL to the library there. Again, it must match what you input into the tag itself when creating it."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.snowplowanalytics.com/wp-content/uploads/sites/2/2021/11/Screenshot-2021-11-18-at-14.40.16.png?w=1024",alt:null})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.simoahava.com/images/2020/05/template-permissions-snowplow.jpg"}),"Unfortunately, modifying permissions ",(0,r.kt)("strong",{parentName:"p"},"breaks the gallery link")," and you will no longer be notified about updates to the template. Being able to modify permissions without having the link break is a feature request I hope will get solved very soon."),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(22721).Z,width:"982",height:"348"})),(0,r.kt)("h3",{id:"tag-type"},"Tag Type"),(0,r.kt)("p",null,"Under ",(0,r.kt)("strong",{parentName:"p"},"Tag Type"),", you can choose what type of command is compiled and sent to the endpoint. The tag types are split here into three groups: commands that utilize a common ",(0,r.kt)("strong",{parentName:"p"},"parameters")," object, commands that have ",(0,r.kt)("strong",{parentName:"p"},"special conditions"),", and ",(0,r.kt)("strong",{parentName:"p"},"custom commands"),"."),(0,r.kt)("h4",{id:"tags-with-a-parameter-object"},"Tags with a parameter object"),(0,r.kt)("p",null,"Tags that can derive their parameters from a Google Tag Manager variable are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ad Tracking"),(0,r.kt)("li",{parentName:"ul"},"Cart Tracking"),(0,r.kt)("li",{parentName:"ul"},"Error Tracking"),(0,r.kt)("li",{parentName:"ul"},"Consent"),(0,r.kt)("li",{parentName:"ul"},"Self-describing Event"),(0,r.kt)("li",{parentName:"ul"},"Site Search"),(0,r.kt)("li",{parentName:"ul"},"Social Interaction"),(0,r.kt)("li",{parentName:"ul"},"Structured Event"),(0,r.kt)("li",{parentName:"ul"},"Timing")),(0,r.kt)("p",null,"You can set the ",(0,r.kt)("strong",{parentName:"p"},"Retrieve Parameters From Variable")," setting to a Google Tag Manager variable. This parameter ",(0,r.kt)("em",{parentName:"p"},"must")," return an object. In the object, the key-value pairs should reflect the named parameters in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker"},"event documentation"),". For example, to have the variable populate an ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#trackError"},"Error event"),", you could use a Custom JavaScript variable like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"function() {\n  return {\n    message: 'Some Error Happened',\n    filename: 'somefile.js',\n    lineno: 5,\n    colno: 236,\n    error: null\n  }\n}\n")),(0,r.kt)("p",null,"Alternatively, you can set the drop-down to the value ",(0,r.kt)("inlineCode",{parentName:"p"},"No"),", and add the parameters manually instead:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.snowplowanalytics.com/wp-content/uploads/sites/2/2021/11/Screenshot-2021-11-18-at-14.43.42.png?w=1024",alt:null})),(0,r.kt)("p",null,"Some tag types will add additional selections to this section. Follow the official tracker documentation for more information about what each option does."),(0,r.kt)("h4",{id:"special-tags"},"Special tags"),(0,r.kt)("p",null,"Some tag types have special conditions and have been separated into their own configurations."),(0,r.kt)("h5",{id:"enhanced-ecommerce"},"Enhanced Ecommerce"),(0,r.kt)("p",null,"When you select Enhanced Ecommerce, you are left with two options: ",(0,r.kt)("strong",{parentName:"p"},"Use Data Layer")," or ",(0,r.kt)("strong",{parentName:"p"},"Choose Variable"),". The way it works is very similar to Enhanced Ecommerce in Google Analytics."),(0,r.kt)("p",null,"If you choose the first, the template will look into the ",(0,r.kt)("inlineCode",{parentName:"p"},"dataLayer")," structure for the ",(0,r.kt)("strong",{parentName:"p"},"most recently")," pushed ",(0,r.kt)("a",{parentName:"p",href:"https://www.simoahava.com/analytics/enhanced-ecommerce-guide-for-google-tag-manager/#data-types-actions"},"Enhanced Ecommerce object"),", and map this object to the request to Snowplow Analytics."),(0,r.kt)("p",null,"If you selected ",(0,r.kt)("strong",{parentName:"p"},"Choose Variable"),", you need to provide a GTM variable that returns an object in the correct, expected format."),(0,r.kt)("h5",{id:"form-tracking"},"Form Tracking"),(0,r.kt)("p",null,"Form tracking has just two options, because ",(0,r.kt)("strong",{parentName:"p"},"filters")," and ",(0,r.kt)("strong",{parentName:"p"},"transformations")," won\u2019t work with the custom template (due to lack of support for processing HTML elements). The options are to set form and/or field ",(0,r.kt)("strong",{parentName:"p"},"blacklists")," and ",(0,r.kt)("strong",{parentName:"p"},"whitelists"),"."),(0,r.kt)("p",null,"Blacklists and whitelists for forms are a list of comma-separated HTML class names. If blacklisted, then any form element with a listed class will not trigger the form event. If whitelisted, then ",(0,r.kt)("em",{parentName:"p"},"only")," form elements with a listed classname will be tracked."),(0,r.kt)("p",null,"For fields, blacklists and whitelists work similarly, except they use the ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," attribute rather than the class."),(0,r.kt)("h5",{id:"link-click-tracking"},"Link Click Tracking"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Track Link Click")," event is similar to regular parameter-based events, as it lets you add parameters and track a link click as a manually encoded hit."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Enable Automatic Link Click Tracking")," adds listeners to the page, which will track clicks on links permitting they adhere to the blacklisted/whitelisted class names you can optionally provide."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Fix Middle-click Tracking")," adds a fix for some browsers where middle-clicks were not tracked properly."),(0,r.kt)("p",null,"If you check ",(0,r.kt)("strong",{parentName:"p"},"Track HTML Content Of Clicked Link"),", then the full text content of the link element will be sent to Snowplow as well."),(0,r.kt)("h5",{id:"page-view"},"Page View"),(0,r.kt)("p",null,"You can provide a ",(0,r.kt)("strong",{parentName:"p"},"Custom Page Title")," if you wish, and you can add a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#trackPageView"},"custom context function")," to the request."),(0,r.kt)("p",null,"If you enable ",(0,r.kt)("strong",{parentName:"p"},"Page Activity Tracking"),", the tag will setup a ",(0,r.kt)("em",{parentName:"p"},"heartbeat")," tracker, and send page pings to Snowplow at intervals that you can specify."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Callback Function")," is something you can set to a JavaScript function. If you set the callback, then instead of sending the page ping to Snowplow, the function gets invoked instead."),(0,r.kt)("h4",{id:"custom-commands"},"Custom Commands"),(0,r.kt)("p",null,"For any other commands which are supported by the Snowplow JavaScript Tracker v3, you can select the ",(0,r.kt)("strong",{parentName:"p"},"[","Custom Command","]")," option. Once select, you can enter any function name and the associated parameter for that function. The parameter can either be a simple string, in examples such as ",(0,r.kt)("inlineCode",{parentName:"p"},"setUserId"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.snowplowanalytics.com/wp-content/uploads/sites/2/2021/11/Screenshot-2021-11-18-at-14.44.50.png?w=1024",alt:null})),(0,r.kt)("p",null,"Or it can be set to a Custom JavaScript Variable in the instances where an Object should be passed to the function, such as with ",(0,r.kt)("inlineCode",{parentName:"p"},"enableAnonymousTracking"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.snowplowanalytics.com/wp-content/uploads/sites/2/2021/11/Screenshot-2021-11-18-at-14.48.48.png?w=1024",alt:null})),(0,r.kt)("p",null,"And then use this variable as your Command Argument:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.snowplowanalytics.com/wp-content/uploads/sites/2/2021/11/Screenshot-2021-11-18-at-14.50.09.png?w=1024",alt:null})),(0,r.kt)("h3",{id:"additional-tracking-parameters"},"Additional Tracking Parameters"),(0,r.kt)("p",null,"You can choose a Google Tag Manager variable from the drop-down titled ",(0,r.kt)("strong",{parentName:"p"},"Add Custom Contexts"),". This lets you add ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#custom-contexts"},"custom contexts")," to the current hit. The variable ",(0,r.kt)("strong",{parentName:"p"},"must")," return an array of valid context objects."),(0,r.kt)("p",null,"You can also choose to override the device timestamp with the ",(0,r.kt)("strong",{parentName:"p"},"Set Custom Timestamp")," field. The format must be UNIX time in milliseconds."),(0,r.kt)("h3",{id:"acknowledgements"},"Acknowledgements"),(0,r.kt)("p",null,"Thanks to ",(0,r.kt)("a",{parentName:"p",href:"https://www.simoahava.com/"},"Simo Ahava")," for building the intial release of this template."))}m.isMDXComponent=!0},7594:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Screenshot-2021-11-18-at-10.30.35-75591a4dfbaef1696f5e2b8eb6809e0d.png"},52450:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Screenshot-2021-11-18-at-14.31.55-0d7c533e05c28af4bde2027a23f20a70.png"},22721:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Screenshot-2021-11-18-at-14.40.47-fa71c79b0a20618c82ccd82438af6f87.png"}}]);