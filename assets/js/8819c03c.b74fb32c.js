"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[46496],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(a),m=i,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||r;return a?n.createElement(h,o(o({ref:t},p),{},{components:a})):n.createElement(h,o({ref:t},p))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var u=2;u<r;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},20080:(e,t,a)=>{a.d(t,{ZP:()=>o});var n=a(87462),i=(a(67294),a(3905));const r={toc:[{value:"Obtaining an API key",id:"obtaining-an-api-key",level:2}]};function o(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},r,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"obtaining-an-api-key"},"Obtaining an API key"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://console.snowplowanalytics.com/credentials"},"Create a new api key for your organization in console"),"."),(0,i.kt)("p",null,"Use the generated api key to obtain an authorization token."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl \\\n  --header 'X-API-Key: $API_KEY' \\\n  https://console.snowplowanalytics.com/api/msc/v1/organizations/$ORGANIZATION_ID/credentials/v2/token\n")),(0,i.kt)("p",null,"This command will return an access token wrapped in json."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{"accessToken":"<access token value>"}\n')),(0,i.kt)("p",null,"You may then use this access token value to supply authorization headers for subsequent api requests."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl \\\n  --header 'authorization: Bearer $ACCESS_TOKEN_VALUE'\n")))}o.isMDXComponent=!0},20619:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),i=(a(67294),a(3905)),r=a(20080);const o={title:"Managing data structures via the API",date:"2021-12-22",sidebar_position:70},s=void 0,l={unversionedId:"understanding-tracking-design/managing-data-structures-via-the-api-2/index",id:"understanding-tracking-design/managing-data-structures-via-the-api-2/index",title:"Managing data structures via the API",description:"As well as managing data structures through the Snowplow BDP Console, Snowplow BDP customers can also manage them programmatically through the data structures API.",source:"@site/docs/understanding-tracking-design/managing-data-structures-via-the-api-2/index.md",sourceDirName:"understanding-tracking-design/managing-data-structures-via-the-api-2",slug:"/understanding-tracking-design/managing-data-structures-via-the-api-2/",permalink:"/docs/understanding-tracking-design/managing-data-structures-via-the-api-2/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/understanding-tracking-design/managing-data-structures-via-the-api-2/index.md",tags:[],version:"current",lastUpdatedAt:1661514108,formattedLastUpdatedAt:"Aug 26, 2022",sidebarPosition:70,frontMatter:{title:"Managing data structures via the API",date:"2021-12-22",sidebar_position:70},sidebar:"tutorialSidebar",previous:{title:"Predefined vs custom entities",permalink:"/docs/understanding-tracking-design/predefined-vs-custom-entities/"},next:{title:"Managing data structures in the console",permalink:"/docs/understanding-tracking-design/managing-data-structures/"}},u={},p=[{value:"Getting started",id:"getting-started",level:2},{value:"Retrieving data structures",id:"retrieving-data-structures",level:2},{value:"Retrieve a list of all data structures",id:"retrieve-a-list-of-all-data-structures",level:3},{value:"Retrieve a specific data structure",id:"retrieve-a-specific-data-structure",level:3},{value:"Retrieve specific version of a specific data structure",id:"retrieve-specific-version-of-a-specific-data-structure",level:3},{value:"Validation",id:"validation",level:2},{value:"Example",id:"example",level:3},{value:"Deployments",id:"deployments",level:2},{value:"Example",id:"example-1",level:3},{value:"Managing meta data",id:"managing-meta-data",level:2},{value:"Migrating from the legacy API",id:"migrating-from-the-legacy-api",level:2}],d={toc:p};function c(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"As well as managing data structures through the Snowplow BDP Console, Snowplow BDP customers can also manage them programmatically through the data structures API."),(0,i.kt)("p",null,"This functionality is key to automating any existing process you may have, including workflows in version control systems like GitHub."),(0,i.kt)("p",null,"Partnered with other tools like our ",(0,i.kt)("a",{parentName:"p",href:"/docs/managing-data-quality/testing-and-qa-workflows/using-the-data-structures-ci-tool-for-data-quality/"},"CI tool")," and / or ",(0,i.kt)("a",{parentName:"p",href:"/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/"},"Snowplow Micro"),", it's possible to have a very robust and automated data structure workflow that ensures data quality upstream of data hitting your pipeline."),(0,i.kt)("p",null,"Note"),(0,i.kt)("p",null,"Data structures interfaces are only compatible with pipelines that have been upgraded to use Iglu Server registries, rather than static S3 registries. Please check ",(0,i.kt)("a",{parentName:"p",href:"https://console.snowplowanalytics.com/data-structures/"},"here")," in the console, to see if you need an upgrade or if your registries are ready to go."),(0,i.kt)("h2",{id:"getting-started"},"Getting started"),(0,i.kt)("p",null,"You can have a look at and interact with all available endpoints in the ",(0,i.kt)("a",{parentName:"p",href:"https://console.snowplowanalytics.com/api/msc/v1/docs"},"API documentation"),"."),(0,i.kt)("p",null,"Authorizing in the API documentation"),(0,i.kt)("p",null,"To be able to post sample requests in the documentation you need to click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorize"),"\xa0button at the top of the document and authorize with your token. The value for the token field in each individual requests is overwritten by this authorization."),(0,i.kt)("p",null,"The endpoints focus on the main operations in the workflow around:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Retrieving existing data structures and their associated schemas"),(0,i.kt)("li",{parentName:"ol"},"Creating or editing new or existing data structures"),(0,i.kt)("li",{parentName:"ol"},"Validating a data structure"),(0,i.kt)("li",{parentName:"ol"},"Deploying a data structure to a registry")),(0,i.kt)("p",null,"Each request will need to include your company's ",(0,i.kt)("inlineCode",{parentName:"p"},"organizationID")," which is a UUID that can be retrieved from the URL immediately following the .com when visiting console:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(60782).Z,width:"727",height:"57"})),(0,i.kt)(r.ZP,{mdxType:"Block14551"}),(0,i.kt)("h2",{id:"retrieving-data-structures"},"Retrieving data structures"),(0,i.kt)("p",null,"The following ",(0,i.kt)("inlineCode",{parentName:"p"},"GET")," requests allow you to retrieve data structures from both your development and production environment registries."),(0,i.kt)("h3",{id:"retrieve-a-list-of-all-data-structures"},"Retrieve a list of all data structures"),(0,i.kt)("p",null,"Use this request to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Retrieve a list of all data structures"),(0,i.kt)("li",{parentName:"ul"},"Retrieve a list of data structures filtered by ",(0,i.kt)("inlineCode",{parentName:"li"},"vendor")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"name")," query parameters")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**GET** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1")),(0,i.kt)("h3",{id:"retrieve-a-specific-data-structure"},"Retrieve a specific data structure"),(0,i.kt)("p",null,"Use this request to retrieve a specific data structure by its hash (see 'Generating a data structure hash' below), which is generated on creation."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**GET** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures\u200b/v1/{dataStructureHash}")),(0,i.kt)("h3",{id:"retrieve-specific-version-of-a-specific-data-structure"},"Retrieve specific version of a specific data structure"),(0,i.kt)("p",null,"Use this request to retrieve all versions of a specific data structure by its hash (see 'Generating a data structure hash' below)"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**GET** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1/{dataStructureHash}\u200b/versions\u200b/{versionNumber}")),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"https://console.snowplowanalytics.com/api/msc/v1/docs"},"detailed API documentation")," for all options."),(0,i.kt)("p",null,"Generating a data structure hash"),(0,i.kt)("p",null,"To use the commands to retrieve information about a specific Data Structure, you need to encode its identifying parameters (",(0,i.kt)("inlineCode",{parentName:"p"},"organization ID"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"vendor"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"name")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"format"),") and hash it with SHA-256."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example:"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"organization ID: _38e97db9-f3cb-404d-8250-cd227506e544_"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"vendor_: com.acme.event_"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"schema name: _search_"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"format: _jsonschema_"),"\xa0"),(0,i.kt)("p",null,"First concatenate the information with a dash (-) as the separator:",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"_38e97db9-f3cb-404d-8250-cd227506e544_-_com.acme.event_-_search_-jsonschema")),(0,i.kt)("p",null,"And then hash them with SHA-256 to receive: ",(0,i.kt)("inlineCode",{parentName:"p"},"a41ef92847476c1caaf5342c893b51089a596d8ecd28a54d3f22d922422a6700")),(0,i.kt)("h2",{id:"validation"},"Validation"),(0,i.kt)("p",null,"To validate that your schema is in proper JSON format and complies with warehouse loading requirements, you can use the validation ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," requests."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**POST** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1/validation-requests")),(0,i.kt)("h3",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'curl \'https://console.snowplowanalytics.com/api/msc/v1/organizations/cad39ca5-3e1e-4e88-91af-87d977a4acd8/data-structures/v1/validation-requests\' \\\n  -H \'authorization: Bearer YOUR_TOKEN\' \\\n  -H \'content-type: application/json\' \\\n  --data-binary \'{\n  "meta": {\n    "hidden": false,\n    "schemaType": "event",\n    "customData": {}\n  },\n  "data": {\n    "description": "Schema for an example event",\n    "properties": {\n      "example_field_1": {\n        "type": "string",\n        "description": "the example_field_1 means x",\n        "maxLength": 128\n      }\n    },\n    "additionalProperties": false,\n    "type": "object",\n    "required": [\n      "example_field_1"\n    ],\n    "$schema": "http://iglucentral.com/schemas/com.snowplowanalytics.self-desc/schema/jsonschema/1-0-0#",\n    "self": {\n      "vendor": "com.acme",\n      "name": "example_schema_name",\n      "format": "jsonschema",\n      "version": "1-0-0"\n    }\n  }\n}\'\n')),(0,i.kt)("p",null,"Please note:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the request's body has two parts:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"one for data structure metadata as value to the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"meta"),"\xa0key"),(0,i.kt)("li",{parentName:"ul"},"one for the schema itself as value to the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"data"),"\xa0key"))),(0,i.kt)("li",{parentName:"ul"},"this example uses the synchronous version of validation that responds with the result immediately. There is also an asynchronous version available that returns a request ID that you can later poll to get the result."),(0,i.kt)("li",{parentName:"ul"},"you can add metadata specific to your organisation to the schema as key/value pairs in the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"customData"),"\xa0object. See '",(0,i.kt)("a",{parentName:"li",href:"#managing-meta-data"},"Managing Meta Data"),"' for more information.")),(0,i.kt)("h2",{id:"deployments"},"Deployments"),(0,i.kt)("p",null,"The deployment endpoints deal with getting a new or edited version of your data structure into your development and production environments."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**GET** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1/{dataStructureHash}\u200b/deployments")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**POST** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1/deployment-requests")),(0,i.kt)("h3",{id:"example-1"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'curl \'https://console.snowplowanalytics.com/api/msc/v1/organizations/cad39ca5-3e1e-4e88-91af-87d977a4acd8/data-structures/v1/deployment-requests\' \\\n  -H \'authorization: Bearer MY_TOKEN\' \\\n  -H \'content-type: application/json\' \\\n  --data-binary \'{\n  "message": "",\n  "source": "VALIDATED",\n  "target": "DEV",\n  "vendor": "com.acme",\n  "name": "example_schema_name",\n  "format": "jsonschema",\n  "version": "1-0-0"\n}\'\n')),(0,i.kt)("p",null,"Please note:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"This example shows an example of deploying from ",(0,i.kt)("inlineCode",{parentName:"li"},"VALIDATED")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"DEV"),". The method is the same for Production, but you would change the variables where ",(0,i.kt)("inlineCode",{parentName:"li"},'"source": "DEV"')," and ",(0,i.kt)("inlineCode",{parentName:"li"},'"target": "PROD"')),(0,i.kt)("li",{parentName:"ul"},"The API enforces a workflow of validating, testing on development and then deploying to production. To achieve this you deploy from one environment to another; from (virtual environment) ",(0,i.kt)("inlineCode",{parentName:"li"},"VALIDATED")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"DEV"),", then ",(0,i.kt)("inlineCode",{parentName:"li"},"DEV")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"PROD"),"."),(0,i.kt)("li",{parentName:"ul"},'Only users designated as "admin" in the console have the permissions to promote from ',(0,i.kt)("inlineCode",{parentName:"li"},"DEV")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"PROD"),"."),(0,i.kt)("li",{parentName:"ul"},"There is a sync option that will return the response of the deployment request directly. Otherwise you can poll for deployment responses using the deployment ID."),(0,i.kt)("li",{parentName:"ul"},"The property for ",(0,i.kt)("inlineCode",{parentName:"li"},"message")," can be sent with a deployment which will capture any change log notes that will be stored against the deployment. This feature is only available to Enterprise tier accounts in the console.")),(0,i.kt)("h2",{id:"managing-meta-data"},"Managing meta data"),(0,i.kt)("p",null,"Meta data is used to add additional information to a Data Structure."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"meta": {\n  "hidden": false,\n  "schemaType": "event",\n  "customData": {}\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"hidden")," property sets the data structure as visible (true) or not (false) in the console."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"schemaType"),' property can be set as null | "event" | "entity".'),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"customData")," property is mapped as ",(0,i.kt)("inlineCode",{parentName:"p"},"[string, string]")," and can be used to send across any key/value pairs you'd like to associate with the schema."),(0,i.kt)("p",null,"For example if you wanted to specify departmental ownership through meta data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"customData": { "department": "marketing" }\n')),(0,i.kt)("p",null,"You can update the meta data for a data structure using the PUT endpoint:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"**PUT** \u200b/api\u200b/msc\u200b/v1\u200b/organizations\u200b/{organizationId}\u200b/data-structures/v1/{dataStructureHash}\u200b/meta")),(0,i.kt)("h2",{id:"migrating-from-the-legacy-api"},"Migrating from the legacy API"),(0,i.kt)("p",null,"The API described above supersedes the legacy one, which was to be found under ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/schemas"),". It offers under-the-hood improvements and a clear path forward to adding further value. To make the transition easier, we have kept the same models for the data being exchanged; it is therefore simply a matter of 1) ",(0,i.kt)("a",{parentName:"p",href:"#obtaining-an-api-key"},"updating the authentication method"),", and 2) switching to the new endpoints listed above."),(0,i.kt)("p",null,"The legacy API is currently tunneled to the new one, so there is no data differences to be expected after the upgrade. We will maintain this facade while supporting customers in upgrading. Your Customer Success Manager and our Engineers will be glad to assist you during this transition."))}c.isMDXComponent=!0},60782:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/orgID-abcb03ac4037410de585e7079489d91c.png"}}]);