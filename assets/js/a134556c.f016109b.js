"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[28834],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(n),k=r,u=m["".concat(s,".").concat(k)]||m[k]||d[k]||l;return n?a.createElement(u,i(i({ref:t},c),{},{components:n})):a.createElement(u,i({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},37666:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(87462),r=(n(67294),n(3905)),l=n(41481);const i={title:"Tracking Events",date:"2021-03-26",sidebar_position:1e3},o=void 0,s={unversionedId:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/index",id:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/index",title:"Tracking Events",description:"Snowplow has been built to enable users to track a wide range of events that occur when consumers interact with their websites and webapps.",source:"@site/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events",slug:"/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/index.md",tags:[],version:"current",lastUpdatedAt:1661260644,formattedLastUpdatedAt:"Aug 23, 2022",sidebarPosition:1e3,frontMatter:{title:"Tracking Events",date:"2021-03-26",sidebar_position:1e3},sidebar:"tutorialSidebar",previous:{title:"Managing multiple trackers",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracker-setup/managing-multiple-trackers/"},next:{title:"Plugins",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/plugins/"}},p={},c=[{value:"Page Views",id:"page-views",level:3},{value:"<code>trackPageView</code>",id:"trackpageview",level:4},{value:"Activity Tracking: page pings",id:"activity-tracking-page-pings",level:3},{value:"<code>enableActivityTracking</code>",id:"enableactivitytracking",level:4},{value:"<code>enableActivityTrackingCallback</code>",id:"enableactivitytrackingcallback",level:4},{value:"<code>updatePageActivity</code>",id:"updatepageactivity",level:4},{value:"Tracking custom self-describing events",id:"tracking-custom-self-describing-events",level:3},{value:"<code>trackSelfDescribingEvent</code>",id:"trackselfdescribingevent",level:4},{value:"Tracking custom structured events",id:"tracking-custom-structured-events",level:3},{value:"<code>trackStructEvent</code>",id:"trackstructevent",level:4},{value:"Custom context",id:"custom-context",level:3},{value:"Tracking events with Custom Context",id:"tracking-events-with-custom-context",level:4},{value:"Global context",id:"global-context",level:3},{value:"Context generators",id:"context-generators",level:4},{value:"<code>eventType</code>",id:"eventtype",level:5},{value:"<code>eventSchema</code>",id:"eventschema",level:5},{value:"Conditional context providers",id:"conditional-context-providers",level:4},{value:"Filter functions",id:"filter-functions",level:4},{value:"Example",id:"example",level:4},{value:"Rulesets",id:"rulesets",level:4},{value:"Rule requirements",id:"rule-requirements",level:4},{value:"Global contexts methods",id:"global-contexts-methods",level:4},{value:"<code>addGlobalContexts</code>",id:"addglobalcontexts",level:4},{value:"<code>removeGlobalContexts</code>",id:"removeglobalcontexts",level:4},{value:"<code>clearGlobalContexts</code>",id:"clearglobalcontexts",level:4},{value:"Link click tracking",id:"link-click-tracking",level:3},{value:"<code>enableLinkClickTracking</code>",id:"enablelinkclicktracking",level:4},{value:"<code>refreshLinkClickTracking</code>",id:"refreshlinkclicktracking",level:4},{value:"<code>trackLinkClick</code>",id:"tracklinkclick",level:4},{value:"Form tracking",id:"form-tracking",level:3},{value:"<code>change_form</code>",id:"change_form",level:5},{value:"<code>submit_form</code>",id:"submit_form",level:5},{value:"<code>focus_form</code>",id:"focus_form",level:5},{value:"<code>enableFormTracking</code>",id:"enableformtracking",level:4},{value:"Custom form tracking",id:"custom-form-tracking",level:4},{value:"Tracking forms embedded inside iframes",id:"tracking-forms-embedded-inside-iframes",level:4},{value:"Ecommerce tracking",id:"ecommerce-tracking",level:3},{value:"<code>addTrans</code>",id:"addtrans",level:4},{value:"<code>addItem</code>",id:"additem",level:4},{value:"trackTrans",id:"tracktrans",level:4},{value:"Putting the three methods together: a complete example",id:"putting-the-three-methods-together-a-complete-example",level:4},{value:"<code>trackAddToCart</code>\xa0and\xa0<code>trackRemoveFromCart</code>",id:"trackaddtocartandtrackremovefromcart",level:4},{value:"Social tracking",id:"social-tracking",level:3},{value:"<code>trackSocialInteraction</code>",id:"tracksocialinteraction",level:4},{value:"Campaign tracking",id:"campaign-tracking",level:3},{value:"Identifying paid sources",id:"identifying-paid-sources",level:4},{value:"Anatomy of the query parameters",id:"anatomy-of-the-query-parameters",level:4},{value:"Ad tracking methods",id:"ad-tracking-methods",level:3},{value:"<code>trackAdImpression</code>",id:"trackadimpression",level:4},{value:"<code>trackAdClick</code>",id:"trackadclick",level:4},{value:"<code>trackAdConversion</code>",id:"trackadconversion",level:4},{value:"<code>trackSiteSearch</code>",id:"tracksitesearch",level:3},{value:"<code>trackTiming</code>",id:"tracktiming",level:3},{value:"Enhanced Ecommerce tracking",id:"enhanced-ecommerce-tracking",level:3},{value:"<code>addEnhancedEcommerceActionContext</code>",id:"addenhancedecommerceactioncontext",level:4},{value:"<code>addEnhancedEcommerceImpressionContext</code>",id:"addenhancedecommerceimpressioncontext",level:4},{value:"<code>addEnhancedEcommerceProductContext</code>",id:"addenhancedecommerceproductcontext",level:4},{value:"<code>addEnhancedEcommercePromoContext</code>",id:"addenhancedecommercepromocontext",level:4},{value:"<code>trackEnhancedEcommerceAction</code>",id:"trackenhancedecommerceaction",level:4},{value:"Consent tracking",id:"consent-tracking",level:3},{value:"<code>trackConsentGranted</code>",id:"trackconsentgranted",level:4},{value:"<code>trackConsentWithdrawn</code>",id:"trackconsentwithdrawn",level:4},{value:"Consent documents",id:"consent-documents",level:4},{value:"GDPR context",id:"gdpr-context",level:3},{value:"Error tracking",id:"error-tracking",level:4},{value:"<code>trackError</code>",id:"trackerror",level:5},{value:"<code>enableErrorTracking</code>",id:"enableerrortracking",level:5},{value:"Setting the true timestamp",id:"setting-the-true-timestamp",level:3}],d={toc:c};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(l.ZP,{mdxType:"Block5966"}),(0,r.kt)("p",null,"Snowplow has been built to enable users to track a wide range of events that occur when consumers interact with their websites and webapps."),(0,r.kt)("p",null,'Snowplow has a number of "built-in" events but offers unlimited event types through Self Describing Events. In addition to this, events can have additional data properties attached them by adding "context" to each event.'),(0,r.kt)("p",null,"Typical Snowplow web tracking plans often leverage the following event types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#page-views"},"Page Views")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#activity-tracking-page-pings"},"Page Pings (Activity Tracking)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#tracking-custom-self-describing-events"},"Self Describing Events")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#custom-context"},"Event with custom context"))),(0,r.kt)("p",null,"This page goes on to discuss more advanced topics in tracking events:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#global-context"},"Global context")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#link-click-tracking"},"Link click tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#form-tracking"},"Form tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ecommerce-tracking"},"Ecommerce tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#social-tracking"},"Social tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#campaign-tracking"},"Campaign tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ad-tracking-methods"},"Ad tracking methods")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#enhanced-ecommerce-tracking"},"Enhanced Ecommerce tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#consent-tracking"},"Consent tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#gdpr-context"},"GDPR context")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#setting-the-true-timestamp"},"Setting the true timestamp"))),(0,r.kt)("h3",{id:"page-views"},"Page Views"),(0,r.kt)("p",null,"Page views are tracked using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackPageView"),"\xa0method. This is generally part of the first Snowplow tag to fire on a particular web page. As a result, the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackPageView"),"\xa0method is usually deployed straight after the tag that also invokes the Snowplow JavaScript (sp.js) e.g."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"\x3c!-- Snowplow starts plowing --\x3e\n<script type=\"text/javascript\">\n;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];\np.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)\n};p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;\nn.src=w;g.parentNode.insertBefore(n,g)}}(window,document,\"script\",\"{{URL to sp.js}}\",\"snowplow\"));\n\nsnowplow('newTracker', 'sp', '{{collector_url_here}}', {\n    appId: 'my-app-id',\n});\n\nsnowplow('enableActivityTracking', {\n  minimumVisitLength: 30,\n  heartbeatDelay: 10\n});\nsnowplow('trackPageView');\n\n<\/script>\n\x3c!-- Snowplow stops plowing --\x3e\n")),(0,r.kt)("h4",{id:"trackpageview"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackPageView")),(0,r.kt)("p",null,"Track pageview is called using the simple:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackPageView');\n")),(0,r.kt)("p",null,"This method automatically captures the URL, referrer and page title (inferred from the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Title")," tag."),(0,r.kt)("p",null,"If you wish, you can override the title with a custom value:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackPageView', { title: 'my custom page title' });\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackPageView"),"\xa0can also be passed an array of custom context as an additional final parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("p",null,"Additionally, you can pass a function which returns an array of zero or more contexts to trackPageView. For the page view and for all subsequent page pings, the function will be called and the contexts it returns will be added to the event."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// Turn on page pings every 10 seconds\nsnowplow('enableActivityTracking', {\n  minimumVisitLength: 10,\n  heartbeatDelay: 10\n});\n\nsnowplow('trackPageView', {\n  // The usual array of static contexts\n  context: [{\n    schema: 'iglu:com.acme/static_context/jsonschema/1-0-0',\n    data: {\n      staticValue: new Date().toString()\n    }\n  }],\n  // Function which returns an array of custom context\n  // Gets called once per page view / page ping\n  contextCallback: function() {\n    return [{\n      schema: 'iglu:com.acme/dynamic_context/jsonschema/1-0-0',\n      data: {\n        dynamicValue: new Date().toString()\n      }\n    }];\n  }\n});\n")),(0,r.kt)("p",null,"The page view and every subsequent page ping will have both a static","_","context and a dynamic","_","context attached. The static","_","contexts will all have the same staticValue, but the dynamic","_","contexts will have different dynamicValues since a new context is created for every event."),(0,r.kt)("h3",{id:"activity-tracking-page-pings"},"Activity Tracking: page pings"),(0,r.kt)("p",null,"As well as tracking page views, we can monitor whether a user continues to engage with a page over time, and record how he / she digests content on the page over time."),(0,r.kt)("p",null,"That is accomplished using 'page ping' events. If activity tracking is enabled, the web page is monitored to see if a user is engaging with it. (E.g. is the tab in focus, does the mouse move over the page, does the user scroll etc.) If any of these things occur in a set period of time, a page ping event fires, and records the maximum scroll left / right and up / down in the last ping period. If there is no activity in the page (e.g. because the user is on a different tab in his / her browser), no page ping fires."),(0,r.kt)("h4",{id:"enableactivitytracking"},(0,r.kt)("inlineCode",{parentName:"h4"},"enableActivityTracking")),(0,r.kt)("p",null,"Page pings are enabled by:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableActivityTracking', { \n  minimumVisitLength: number, \n  heartbeatDelay: number \n});\n")),(0,r.kt)("p",null,"where\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"minimumVisitLength"),"\xa0is the time period from page load before the first page ping occurs, in seconds.\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"heartbeat"),"\xa0is the number of seconds between each page ping, once they have started. So, if you executed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableActivityTracking', { \n  minimumVisitLength: 30, \n  heartbeatDelay: 10 \n});\n\nsnowplow('trackPageView');\n")),(0,r.kt)("p",null,"The first ping would occur after 30 seconds, and subsequent pings every 10 seconds as long as the user continued to browse the page actively."),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In general this is executed as part of the main Snowplow tracking tag. As a result, you can elect to enable this on specific pages."),(0,r.kt)("li",{parentName:"ul"},"The\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"enableActivityTracking"),"\xa0method\xa0",(0,r.kt)("strong",{parentName:"li"},"must"),"\xa0be called\xa0",(0,r.kt)("em",{parentName:"li"},"before"),"\xa0the\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"trackPageView"),"\xa0method."),(0,r.kt)("li",{parentName:"ul"},"Activity tracking will be disabled if either\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"minimumVisitLength"),"\xa0or\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"heartbeatDelay"),"\xa0is not integer. This is to prevent relentless callbacks.")),(0,r.kt)("h4",{id:"enableactivitytrackingcallback"},(0,r.kt)("inlineCode",{parentName:"h4"},"enableActivityTrackingCallback")),(0,r.kt)("p",null,"You can now perform edge analytics in the browser to reduce the number of events sent to you collector whilst still tracking user activity. The Snowplow JavaScript Tracker enabled this by allowing a callback to be specified in place of a page ping being sent. This is enabled by:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableActivityTrackingCallback', { \n  minimumVisitLength: number, \n  heartbeatDelay: number, \n  callback: (data: ActivityCallbackData) => void\n});\n")),(0,r.kt)("p",null,"where\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"minimumVisitLength"),"\xa0is the time period from page load before the first page ping occurs, in seconds.\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"heartbeat"),"\xa0is the number of seconds between each page ping, once they have started. The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"callback"),"\xa0should be a function which will receive an event object containing the page ping activity information, including pageivew","_","id, and any Page View contexts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"type ActivityCallbackData = {\n    /**\n     * All context for the activity tracking\n     * Often generated by the page view events context callback\n     */\n    context: Array<SelfDescribingJson>;\n    /** The current page view id */\n    pageViewId: string;\n    /** The minimum X scroll position for the current page view */\n    minXOffset: number;\n    /** The maximum X scroll position for the current page view */\n    minYOffset: number;\n    /** The minimum Y scroll position for the current page view */\n    maxXOffset: number;\n    /** The maximum Y scroll position for the current page view */\n    maxYOffset: number;\n};\n")),(0,r.kt)("p",null,"A full example of how this might be used to aggregate page ping information and then send an event on page unload is below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('newTracker', 'sp', '{{collector_url_here}}', {\n    appId: 'my-app-id',\n    eventMethod: 'beacon'\n});\nvar aggregatedEvent = {\n    pageViewId: null,\n    minXOffset: 0,\n    maxXOffset: 0,\n    minYOffset: 0,\n    maxYOffset: 0,\n    numEvents: 0\n};\nsnowplow('enableActivityTrackingCallback', { \n  minimumVisitLength: 10, \n  heartbeatDelay: 10, \n  callback: function (event) {\n    aggregatedEvent = {\n        pageViewId: event.pageViewId,\n        minXOffset: aggregatedEvent.minXOffset < event.minXOffset ? aggregatedEvent.minXOffset : event.minXOffset,\n        maxXOffset: aggregatedEvent.maxXOffset > event.maxXOffset ? aggregatedEvent.maxXOffset : event.maxXOffset,\n        minYOffset: aggregatedEvent.minYOffset < event.minYOffset ? aggregatedEvent.minYOffset : event.minYOffset,\n        maxYOffset: aggregatedEvent.maxYOffset > event.maxYOffset ? aggregatedEvent.maxYOffset : event.maxYOffset,\n        numEvents: aggregatedEvent.numEvents + 1\n    };\n});\ndocument.addEventListener('visibilitychange', function() {\n  if (document.visibilityState == 'hidden') {\n    window.snowplow('trackSelfDescribingEvent', {\n      event: {\n        schema: 'iglu:com.acme_company/page_unload/jsonschema/1-0-0',\n        data: {\n            minXOffset: Math.max(0, Math.round(aggregatedEvent.minXOffset)),\n            maxXOffset: Math.max(0, Math.round(aggregatedEvent.maxXOffset)),\n            minYOffset: Math.max(0, Math.round(aggregatedEvent.minYOffset)),\n            maxYOffset: Math.max(0, Math.round(aggregatedEvent.maxYOffset)),\n            activeSeconds: aggregatedEvent.numEvents * 10\n        }\n      }\n    });\n  }\n});\nwindow.snowplow('trackPageView');\n")),(0,r.kt)("p",null,"Note: For this technique of sending on visibility change to work reliably, we recommend initialising the Snowplow tracker with\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventMethod: 'beacon'"),"\xa0and/or\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy: 'cookieAndLocalStorage'"),"\xa0(if navigating to a page that also contains the JS Tracker). Using the visibility change technique may not work as expected for Single Page Applications (SPA), you would need to send the aggregated event to the Snowplow collector on navigation within your application."),(0,r.kt)("p",null,"We are using ",(0,r.kt)("inlineCode",{parentName:"p"},"visibilitychange")," events as ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeunload")," isn't a reliable option for mobile devices when using ",(0,r.kt)("inlineCode",{parentName:"p"},"beacon"),". You can read more about this on ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon#description"},"MDN"),". An idea on the different levels of compatibility of the different Page Visiblity API across browsers and mobile can here found ",(0,r.kt)("a",{parentName:"p",href:"https://www.igvita.com/2015/11/20/dont-lose-user-and-app-state-use-page-visibility/"},"here"),"."),(0,r.kt)("h4",{id:"updatepageactivity"},(0,r.kt)("inlineCode",{parentName:"h4"},"updatePageActivity")),(0,r.kt)("p",null,"You can also trigger a page ping manually with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('updatePageActivity');\n")),(0,r.kt)("p",null,"This is particularly useful when a user is passively engaging with your content, e.g. watching a video."),(0,r.kt)("h3",{id:"tracking-custom-self-describing-events"},"Tracking custom self-describing events"),(0,r.kt)("p",null,"You may wish to track events on your website or application which are not directly supported by Snowplow and which\xa0structured event tracking\xa0does not adequately capture. Your event may have more than the five fields offered by\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackStructEvent"),", or its fields may not fit into the category-action-label-property-value model. The solution is Snowplow\u2019s self-describing events. Self-describing events are a ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/understanding-schemas-and-validation/"},"data structure based on JSON Schemas")," and can have arbitrarily many fields."),(0,r.kt)("p",null,"To define your own custom event, you must create a\xa0",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/understanding-schemas-and-validation/"},"JSON schema"),"\xa0for that event and upload it to an\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu"},"Iglu Schema Repository")," using ",(0,r.kt)("a",{parentName:"p",href:"/docs/pipeline-components-and-applications/iglu/"},"igluctl")," (or if a Snowplow BDP customer, you can use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/managing-data-structures/"},"Snowplow BDP Console UI")," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/managing-data-structures-via-the-api-2/"},"Data Structures API"),"). Snowplow uses the schema to validate that the JSON containing the event properties is well-formed."),(0,r.kt)("h4",{id:"trackselfdescribingevent"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackSelfDescribingEvent")),(0,r.kt)("p",null,"To track a self-describing event, you make use the ",(0,r.kt)("inlineCode",{parentName:"p"},"trackSelfDescribingEvent"),"\xa0method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSelfDescribingEvent', {{SELF-DESCRIBING EVENT JSON}});\n")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSelfDescribingEvent', {\n  event: {\n    schema: 'iglu:com.acme_company/viewed_product/jsonschema/1-0-0',\n    data: {\n        productId: 'ASO01043',\n        category: 'Dresses',\n        brand: 'ACME',\n        returning: true,\n        price: 49.95,\n        sizes: ['xs', 's', 'l', 'xl', 'xxl'],\n        availableSince: new Date(2013,3,7)\n    }\n  }\n});\n")),(0,r.kt)("p",null,"The second argument is a\xa0",(0,r.kt)("a",{parentName:"p",href:"http://snowplowanalytics.com/blog/2014/05/15/introducing-self-describing-jsons/"},"self-describing JSON"),". It has two fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"data"),"\xa0field, containing the properties of the event"),(0,r.kt)("li",{parentName:"ul"},"A\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"schema"),"\xa0field, containing the location of the\xa0",(0,r.kt)("a",{parentName:"li",href:"http://json-schema.org/"},"JSON schema"),"\xa0against which the\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"data"),"\xa0field should be validated.")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"data"),"\xa0field should be flat, not nested."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackSelfDescribingEvent"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"tracking-custom-structured-events"},"Tracking custom structured events"),(0,r.kt)("p",null,"There are likely to be a large number of events that can occur on your site, for which a specific tracking method is part of Snowplow."),(0,r.kt)("p",null,"Our philosophy in creating Snowplow is that users should capture important consumer interactions and design suitable data structures for this data capture. You can read more about that philosophy ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/"},"here"),". Using ",(0,r.kt)("inlineCode",{parentName:"p"},"trackSelfDescribingEvent")," captures these interactions with custom schemas, as desribed above."),(0,r.kt)("p",null,"However, as part of a Snowplow implementation there may be interactons where custom Self Describing events are perhaps too complex or unwarranted. They are then candidates to track using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackStructEvent"),", if none of the other event-specific methods outlined above are appropriate."),(0,r.kt)("h4",{id:"trackstructevent"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackStructEvent")),(0,r.kt)("p",null,"There are five parameters can be associated with each structured event. Of them, only the first two are required:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Category")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"The name you supply for the group of objects you want to track e.g. 'media', 'ecomm'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Action")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"A string which defines the type of user interaction for the web object e.g. 'play-video', 'add-to-basket'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Label")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"An optional string which identifies the specific object being actioned e.g. ID of the video being played, or the SKU or the product added-to-basket")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Property")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"An optional string describing the object or the action performed on it. This might be the quantity of an item added to basket")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Value")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"An optional float to quantify or further describe the user action. This might be the price of an item added-to-basket, or the starting time of the video where play was just pressed")))),(0,r.kt)("p",null,"The async specification for the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackStructEvent"),"\xa0method is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackStructEvent', {\n  category: 'category',\n  action: 'action',\n  label: 'label',\n  property: 'property',\n  value: 0.0\n});\n")),(0,r.kt)("p",null,"An example of tracking a user listening to a music mix:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackStructEvent', {\n  category: 'Mixes', \n  action: 'Play', \n  label: 'MrC/fabric-0503-mix', \n  property: '',\n  value: 0.0\n});\n")),(0,r.kt)("p",null,"Note that in the above example no value is set for the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"event property"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackStructEvent"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"custom-context"},"Custom context"),(0,r.kt)("p",null,"Custom context can be used to augment any standard Snowplow event type, including self describing events, with additional data. We refer to this custom context as ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/understanding-events-entities/"},"Event Entities"),"."),(0,r.kt)("p",null,"Custom context can be added as an extra argument to any of Snowplow's\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"track..()"),"\xa0methods and to\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addItem"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addTrans"),"."),(0,r.kt)("p",null,"Each custom context is an array of self-describing JSON following the same pattern as an\xa0self describing event. As with self describing events, if you want to create your own custom context, you must create a\xa0",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/understanding-schemas-and-validation/"},"JSON schema"),"\xa0for it and upload it to an\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu"},"Iglu repository")," using the ",(0,r.kt)("a",{parentName:"p",href:"https://snowplowanalytics.com/snowplow-insights/"},"Snowplow BDP Console UI"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/managing-data-structures/"},"Data Structures API"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/pipeline-components-and-applications/iglu/"},"igluctl")," or one of the other supported ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu/wiki/Setting-up-an-Iglu-client"},"Iglu clients"),". Since more than one (of either different or the same type) can be attached to an event, the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"context"),"\xa0argument (if it is provided at all) should be a non-empty array of self-describing JSONs."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Important:"),"\xa0Even if only one custom context is being attached to an event, it still needs to be wrapped in an array."),(0,r.kt)("p",null,"Here are two example custom context JSONs. One describes a page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n    schema: \"iglu:com.example_company/page/jsonschema/1-2-1\",\n    data: {\n        pageType: 'test',\n        lastUpdated: new Date(2014,1,26)\n    }\n}\n")),(0,r.kt)("p",null,"and the other describes a user on that page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n    schema: \"iglu:com.example_company/user/jsonschema/2-0-0\",\n    data: {\n      userType: 'tester'\n    }\n}\n")),(0,r.kt)("h4",{id:"tracking-events-with-custom-context"},"Tracking events with Custom Context"),(0,r.kt)("p",null,"How to track a ",(0,r.kt)("strong",{parentName:"p"},"page view")," with both of these contexts attached:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackPageView', {\n  context: [{\n    schema: \"iglu:com.example_company/page/jsonschema/1-2-1\",\n    data: {\n      pageType: 'test',\n      lastUpdated: new Date(2021,04,01)\n    }\n  },\n  {\n    schema: \"iglu:com.example_company/user/jsonschema/2-0-0\",\n    data: {\n      userType: 'tester'\n    }\n  }]\n});\n")),(0,r.kt)("p",null,"How to track a ",(0,r.kt)("strong",{parentName:"p"},"self describing event")," with both of these contexts attached:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSelfDescribingEvent', {\n  event: {\n    schema: 'iglu:com.example_company/product_viewed/jsonschema/1-0-1',\n    data: {\n      productId: '12345',\n      price: 10.99\n    }\n  },\n  context: [{\n    schema: 'iglu:com.example_company/page/jsonschema/1-2-1',\n    data: {\n      pageType: 'test',\n      lastUpdated: new Date(2021,04,01)\n    }\n  },\n  {\n    schema: \"iglu:com.example_company/user/jsonschema/2-0-0\",\n    data: {\n      userType: 'tester'\n    }\n  }]\n});\n")),(0,r.kt)("p",null,"For more information on custom context, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/understanding-tracking-design/predefined-vs-custom-entities/"},"here"),"."),(0,r.kt)("h3",{id:"global-context"},"Global context"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Global context"),"\xa0lets you define your own contexts once (e.g. on tracker initialization) and then have this context sent with every single event subsequently recorded on the page. This saves having to manually build and send the context array with every single event fired."),(0,r.kt)("p",null,"Here is an example that adds a global context entity to all subsequently tracked events:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// Create a context entity and add it to global context\nlet contextEntity = {\n  schema: 'iglu:com.acme/user_context/jsonschema/1-0-0',\n  data: { userid: 1234, name: 'John Doe' }\n};\nwindow.snowplow('addGlobalContexts', [contextEntity]);\n\n// The global context will be added to this page view event as well\nwindow.snowplow('trackPageView');\n")),(0,r.kt)("p",null,"You may not want to add the same context entity to all tracked events. There are several ways to make global context dynamic:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Using a\xa0",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"#context-generators"},"context generator")),"\xa0that generates context entities on the fly when events are sent."),(0,r.kt)("li",{parentName:"ol"},"Using\xa0",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"#filter-functions"},"filter functions")),"\xa0that filter which events to add global context entities to."),(0,r.kt)("li",{parentName:"ol"},"Using\xa0",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"#rulesets"},"rulesets")),"\xa0that define rules which types of events to accept or reject when generating global context entities.")),(0,r.kt)("h4",{id:"context-generators"},"Context generators"),(0,r.kt)("p",null,"Generating context on-the-fly is accomplished with\xa0",(0,r.kt)("strong",{parentName:"p"},"context generators"),". A context generator is a callback that will be evaluated with an optional argument that contains useful information."),(0,r.kt)("p",null,"A sample context generator that conditionally generates a context entity could look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const contextGenerator = (args) => {\n    if (args.eventType == 'pv') {\n        return {\n            schema: 'iglu:com.acme.marketing/some_event/jsonschema/1-0-0',\n            data: { test: 1 },\n        };\n    }\n};\nwindow.snowplow('addGlobalContexts', [contextGenerator]);\n")),(0,r.kt)("p",null,"The optional input is an associative array that contains three elements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event"),"\xa0: self-describing JSON"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eventType"),"\xa0: string"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eventSchema"),"\xa0: string (schema URI)")),(0,r.kt)("p",null,"Keep in mind that the arguments\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventType"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventSchema"),"\xa0are data found in ",(0,r.kt)("inlineCode",{parentName:"p"},"event"),".\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventType")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"eventSchema")," are provided for convenience, so that simple tasks don't require users to search through the event payload."),(0,r.kt)("h5",{id:"eventtype"},(0,r.kt)("inlineCode",{parentName:"h5"},"eventType")),(0,r.kt)("p",null,"This argument is a string taken from the event payload field,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"e"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"eventType"),"\xa0takes the following values:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"e")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Pageview tracking"),(0,r.kt)("td",{parentName:"tr",align:null},"pv")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Page pings"),(0,r.kt)("td",{parentName:"tr",align:null},"pp")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Link click"),(0,r.kt)("td",{parentName:"tr",align:null},"ue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Ad impression tracking"),(0,r.kt)("td",{parentName:"tr",align:null},"ue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Ecommerce transaction tracking"),(0,r.kt)("td",{parentName:"tr",align:null},"tr and ti")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Custom structured event"),(0,r.kt)("td",{parentName:"tr",align:null},"se")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Custom self describing event"),(0,r.kt)("td",{parentName:"tr",align:null},"ue")))),(0,r.kt)("p",null,"Further information about the event payload can be found in the\xa0",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol/"},"tracker protocol documentation"),"."),(0,r.kt)("h5",{id:"eventschema"},(0,r.kt)("inlineCode",{parentName:"h5"},"eventSchema")),(0,r.kt)("p",null,"Users should be aware of the behavior of the argument\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventSchema"),". Since 'first-class events' (e.g. structured events, transactions, pageviews, etc.) lack a proper schema (their event type is determined by the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"e"),"\xa0field), callbacks will be provided the upper-level schema that defines the payload of all events:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-4")),(0,r.kt)("p",null,"For self describing events,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventSchema"),"\xa0will be the schema that describes the self describing event, not the event payload. Again, this behavior isn't necessarily uniform, but provides more utility to differentiate events."),(0,r.kt)("h4",{id:"conditional-context-providers"},"Conditional context providers"),(0,r.kt)("p",null,"We can augment context primitives by allowing them to be sent conditionally. While it's possible to define this functionality within context generators (with conditional logic), conditional context providers simplify common ways of sending contexts that follow certain rules."),(0,r.kt)("p",null,"The general form is an array of two objects:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"[conditional part, context primitive or [array of primitives]]")),(0,r.kt)("p",null,"The conditional part is standardized into two options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a filter function"),(0,r.kt)("li",{parentName:"ul"},"a schema ruleset")),(0,r.kt)("h4",{id:"filter-functions"},"Filter functions"),(0,r.kt)("p",null,"Filter functions take the standard callback arguments defined for context generators, but instead of returning a Self Describing JSON, return a boolean value. As should be expected:\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\xa0will attach the context part,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"\xa0will not attach the context part."),(0,r.kt)("h4",{id:"example"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#example"}),"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// A filter that will only attach contexts to structured events\nfunction structuredEventFilter(args) {\n  return args['eventType'] === 'se';\n}\nvar globalContextDefinition = [structuredEventFilter, contextEntityToBeAdded];\nwindow.snowplow('addGlobalContexts', [globalContextDefinition]);\n")),(0,r.kt)("h4",{id:"rulesets"},"Rulesets"),(0,r.kt)("p",null,"Rulesets define when to attach context primitives based on the event schema. This follows the standard behavior for all callbacks (the schema used to evaluate is the same provided in\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"eventSchema"),', namely the payload schema for "first-class events" and otherwise the schema found within the self describing event).'),(0,r.kt)("p",null,"Here's the specific structure of a ruleset, it's an object with certain optional rules that take the form of fields, each holding an array of strings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n    accept: [],\n    reject: []\n}\n")),(0,r.kt)("p",null,"Some examples, take note that wild-card matching URI path components is defined with an asterisk,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"*"),", in place of the component:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// Only attaches contexts to this one schema\nvar ruleSetAcceptOne = {\n  accept: ['iglu:com.mailchimp/cleaned_email/jsonschema/1-0-0']\n};\n\n// Only attaches contexts to these schemas\nvar ruleSetAcceptTwo = {\n  accept: ['iglu:com.mailchimp/cleaned_email/jsonschema/1-0-0',\n  'iglu:com.mailchimp/subscribe/jsonschema/1-0-0']\n};\n\n// Only attaches contexts to schemas with mailchimp vendor\nvar ruleSetAcceptVendor = {\n  accept: ['iglu:com.mailchimp/*/jsonschema/*-*-*']\n};\n\n// Only attaches contexts to schemas that aren't mailchimp vendor\nvar ruleSetRejectVendor = {\n  reject: ['iglu:com.mailchimp/*/jsonschema/*-*-*']\n};\n\n// Only attach to Snowplow first class events\nvar ruleSet = {\n  accept: ['iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-4']\n};\n")),(0,r.kt)("p",null,"You can add a global context entity with a ruleset as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"var globalContextDefinition = [ruleSet, contextEntityToAdd];\nwindow.snowplow('addGlobalContexts', [globalContextDefinition]);\n")),(0,r.kt)("h4",{id:"rule-requirements"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#rule-requirements"}),"Rule requirements"),(0,r.kt)("p",null,"All rules and schemas follow a standard form:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"protocol:vendor/event_name/format/version")),(0,r.kt)("p",null,"And rules must meet some requirements to be considered valid:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Two parts are invariant: protocol and format. They are always\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"iglu"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"jsonschema"),"\xa0respectively.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Wildcards can therefore be used only in\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"vendor"),",\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"event_name"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"version"),"."))),(0,r.kt)("li",{parentName:"ul"},"Version matching must be specified like so:\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"*-*-*"),", where any part of the versioning can be defined, e.g.\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"1-*-*"),", but only sequential parts are to be wildcarded, e.g.\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"1-*-1"),"\xa0is invalid but\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"1-*-*"),"\xa0is valid."),(0,r.kt)("li",{parentName:"ul"},'Vendors require the first two "larger parts":',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"com.acme.*")))),(0,r.kt)("li",{parentName:"ul"},"Vendors cannot be defined with non-wildcarded parts between wildcarded parts:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"com.acme.*.marketing.*"),"\xa0is invalid"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"com.acme.*.*"),"\xa0is valid")))),(0,r.kt)("h4",{id:"global-contexts-methods"},"Global contexts methods"),(0,r.kt)("p",null,"These are the standard methods to add and remove global contexts:"),(0,r.kt)("h4",{id:"addglobalcontexts"},(0,r.kt)("inlineCode",{parentName:"h4"},"addGlobalContexts")),(0,r.kt)("p",null,"To add global contexts: ",(0,r.kt)("inlineCode",{parentName:"p"},"snowplow('addGlobalContexts', [array of global contexts])")),(0,r.kt)("h4",{id:"removeglobalcontexts"},(0,r.kt)("inlineCode",{parentName:"h4"},"removeGlobalContexts")),(0,r.kt)("p",null,"To remove a global context:\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"snowplow('removeGlobalContexts', [array of global contexts])"),"."),(0,r.kt)("p",null,"Global context entities are removed by doing a JSON match of the context to be removed with the added context. So the objects have to be the same in order for them to be matched."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"var entity = {\n  schema: 'iglu:com.acme.marketing/some_event/jsonschema/1-0-0',\n  data: { test: 1 },\n};\nwindow.snowplow('addGlobalContexts', [entity]); // add a global context\nwindow.snowplow('removeGlobalContexts', [entity]); // remove the global context\n")),(0,r.kt)("h4",{id:"clearglobalcontexts"},(0,r.kt)("inlineCode",{parentName:"h4"},"clearGlobalContexts")),(0,r.kt)("p",null,"To remove all global contexts: ",(0,r.kt)("inlineCode",{parentName:"p"},"snowplow('clearGlobalContexts')")),(0,r.kt)("h3",{id:"link-click-tracking"},"Link click tracking"),(0,r.kt)("p",null,"Link click tracking is enabled using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableLinkClickTracking"),"\xa0method. Use this method once and the Tracker will add click event listeners to all link elements. Link clicks are tracked as self describing events. Each link click event captures the link's href attribute. The event also has fields for the link's id, classes, and target (where the linked document is opened, such as a new tab or new window)."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/link_click/jsonschema/1-0-1"},"Here"),"\xa0is the JSON schema for a link click event."),(0,r.kt)("h4",{id:"enablelinkclicktracking"},(0,r.kt)("inlineCode",{parentName:"h4"},"enableLinkClickTracking")),(0,r.kt)("p",null,"Turn on link click tracking like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking');\n")),(0,r.kt)("p",null,"This is its signature (Where ",(0,r.kt)("inlineCode",{parentName:"p"},"?")," defines an optional property):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { \n  options?: FilterCriterion, \n  pseudoClicks?: boolean, \n  trackContent?: boolean\n  context?: SelfDescribingJson[]\n});\n")),(0,r.kt)("p",null,"Where FilterCriterion is an object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"interface FilterCriterion {\n    /** A collection of class names to include */\n    allowlist?: string[];\n    /** A collector of class names to exclude */\n    denylist?: string[];\n    /** A callback which returns a boolean as to whether the element should be included */\n    filter?: (elt: HTMLElement) => boolean;\n}\n")),(0,r.kt)("p",null,"You can control which links are tracked using the second argument. There are three ways to do this: a denylist, an allowlist, and a filter function."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Denylists")),(0,r.kt)("p",null,'This is an array of CSS classes which should be ignored by link click tracking. For example, the below code will stop link click events firing for links with the class "barred" or "untracked", but will fire link click events for all other links:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { \n  options: {\n    denylist: ['barred', 'untracked']\n  }\n});\n")),(0,r.kt)("p",null,"If there is only one class name you wish to deny, you should still put it in an array:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { options: { 'denylist': ['barred'] } });\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Allowlists")),(0,r.kt)("p",null,"The opposite of a denylist. This is an array of the CSS classes of links which you do want to be tracked. Only clicks on links with a class in the list will be tracked."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { \n  options: { \n    'allowlist': ['unbarred', 'tracked']\n  }\n});\n")),(0,r.kt)("p",null,"If there is only one class name you wish to whitelist, you should still put it in an array:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { options: { 'allowlist': ['unbarred'] } });\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Filter functions")),(0,r.kt)("p",null,"You can provide a filter function which determines which links should be tracked. The function should take one argument, the link element, and return either 'true' (in which case clicks on the link will be tracked) or 'false' (in which case they won't)."),(0,r.kt)("p",null,'The following code will track clicks on those and only those links whose id contains the string "interesting":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"function myFilter (linkElement) {\n  return linkElement.id.indexOf('interesting') > -1;\n}\n\nsnowplow('enableLinkClickTracking', { options: { 'filter': myFilter } });\n")),(0,r.kt)("p",null,"An optional parameter is\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"pseudoClicks"),". If this is not turned on, Firefox will not recognise middle clicks. If it is turned on, there is a small possibility of false positives (click events firing when they shouldn't). ",(0,r.kt)("strong",{parentName:"p"},"Turning this feature on is recommended"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { pseudoClicks: true });\n")),(0,r.kt)("p",null,"Another optional parameter is\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackContent"),". Set it to\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\xa0if you want link click events to capture the innerHTML of the clicked link:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableLinkClickTracking', { trackContent: true });\n")),(0,r.kt)("p",null,"The innerHTML of a link is all the text between the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"a"),"\xa0tags. Note that if you use a base 64 encoded image as a link, the entire base 64 string will be included in the event."),(0,r.kt)("p",null,"Each link click event will include (if available) the destination URL, id, classes and target of the clicked link. (The target attribute of a link specifies a window or frame where the linked document will be loaded.)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Contexts")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"enableLinkClickTracking"),"\xa0can also be passed an array of custom context to attach to every link click event as an additional final parameter."),(0,r.kt)("p",null,"Link click tracking supports dynamic contexts. Callbacks passed in the contexts argument will be evaluated with the source element passed as the only argument. The self-describing JSON context object returned by the callback will be sent with the link click event."),(0,r.kt)("p",null,"A dynamic context could therefore look something like this for link click events:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let dynamicContext = function (element) {\n  // perform operations here to construct the context\n  return context;\n};\n\nsnowplow('enableLinkClickTracking', { context: [dynamicContext] });\n")),(0,r.kt)("p",null,"See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h4",{id:"refreshlinkclicktracking"},(0,r.kt)("inlineCode",{parentName:"h4"},"refreshLinkClickTracking")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"enableLinkClickTracking"),"\xa0only tracks clicks on links which exist when the page has loaded. If new links can be added to the page after then which you wish to track, just use\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"refreshLinkClickTracking"),". This will add Snowplow click listeners to all links which do not already have them (and which match the denylist, allowlist, or filter function you specified when\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableLinkClickTracking"),"\xa0was originally called). Use it like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('refreshLinkClickTracking');\n")),(0,r.kt)("h4",{id:"tracklinkclick"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackLinkClick")),(0,r.kt)("p",null,"You can manually track individual link click events with the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackLinkClick"),"\xa0method. This is its signature:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackLinkClick, {\n    /** The target URL of the link */\n    targetUrl: string;\n    /** The ID of the element clicked if present */\n    elementId?: string;\n    /** An array of class names from the element clicked */\n    elementClasses?: Array<string>;\n    /** The target value of the element if present */\n    elementTarget?: string;\n    /** The content of the element if present and enabled */\n    elementContent?: string;\n});\n")),(0,r.kt)("p",null,"Of these arguments, only\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"targetUrl"),"\xa0is required. This is how to use\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackLinkClick"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackLinkClick', {\n  targetUrl: 'http://www.example.com', \n  elementId: 'first-link', \n  elementClasses: ['class-1', 'class-2'], \n  elementTarget: '', \n  elementContent: 'this page'\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackLinkClick"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"form-tracking"},"Form tracking"),(0,r.kt)("p",null,"Snowplow automatic form tracking detects three event types:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"[change_form](#change_form)"),"\xa0\u2013 form field changed."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"[submit_form](#submit_form)"),"\xa0\u2013 form submitted."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"[focus_form](#focus_form)"),"\xa0\u2013 form field focused.")),(0,r.kt)("p",null,"By default, all three event types are tracked. However, it is possible to subscribe only to specific event types using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"options.events"),"\xa0option when enabling form tracking:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableFormTracking', {\n    options: {\n        events: ['submit_form', 'focus_form', 'change_form']\n    },\n});\n")),(0,r.kt)("h5",{id:"change_form"},(0,r.kt)("a",{parentName:"h5",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#change_form"}),(0,r.kt)("inlineCode",{parentName:"h5"},"change_form")),(0,r.kt)("p",null,"When a user changes the value of a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"textarea"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"input"),", or\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"select"),"\xa0element inside a form, a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/change_form/jsonschema/1-0-0"},(0,r.kt)("inlineCode",{parentName:"a"},"change_form")),"\xa0event will be fired. It will capture the name, type, and new value of the element, and the id of the parent form."),(0,r.kt)("h5",{id:"submit_form"},(0,r.kt)("a",{parentName:"h5",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#submit_form"}),(0,r.kt)("inlineCode",{parentName:"h5"},"submit_form")),(0,r.kt)("p",null,"When a user submits a form, a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/submit_form/jsonschema/1-0-0"},(0,r.kt)("inlineCode",{parentName:"a"},"submit_form")),"\xa0event will be fired. It will capture the id and classes of the form and the name, type, and value of all\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"textarea"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"input"),", and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"select"),"\xa0elements inside the form."),(0,r.kt)("p",null,"Note that this will only work if the original form submission event is actually fired. If you prevent it from firing, for example by using a jQuery event handler which returns\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"\xa0to handle clicks on the form's submission button, the Snowplow\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"submit_form"),"\xa0event will not be fired."),(0,r.kt)("h5",{id:"focus_form"},(0,r.kt)("a",{parentName:"h5",href:"https://github.com/snowplow/snowplow/wiki/2-Specific-event-tracking-with-the-Javascript-tracker#focus_form"}),(0,r.kt)("inlineCode",{parentName:"h5"},"focus_form")),(0,r.kt)("p",null,"When a user focuses on a form element, a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/focus_form/jsonschema/1-0-0"},(0,r.kt)("inlineCode",{parentName:"a"},"focus_form")),"\xa0event will be fired. It will capture the id and classes of the form and the name, type, and value of the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"textarea"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"input"),", or\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"select"),"\xa0element inside the form that received focus."),(0,r.kt)("h4",{id:"enableformtracking"},(0,r.kt)("inlineCode",{parentName:"h4"},"enableFormTracking")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),"\xa0method to add event listeners to turn on form tracking by adding event listeners to all form elements and to all interactive elements inside forms (that is, all\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"input"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"textarea"),", and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"select"),"\xa0elements)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableFormTracking');\n")),(0,r.kt)("p",null,"This will only work for form elements which exist when it is called. If you are creating a form programatically, call\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),"\xa0again after adding it to the document to track it. You can call\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),"\xa0multiple times without risk of duplicated events. ",(0,r.kt)("strong",{parentName:"p"},"From v3.2.0"),", if you are programatically adding additional fields to a form after initially calling ",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking")," then calling it again after the new form fields are added will include them in form tracking."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," that events on password fields will not be tracked."),(0,r.kt)("h4",{id:"custom-form-tracking"},"Custom form tracking"),(0,r.kt)("p",null,"It may be that you do not want to track every field in a form, or every form on a page. You can customize form tracking by passing a configuration argument to the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),'\xa0method. This argument should be an object with two elements named "forms" and "fields". The "forms" element determines which forms will be tracked; the "fields" element determines which fields inside the tracked forms will be tracked. As with link click tracking, there are three ways to configure each field: a denylist, an allowlist, or a filter function. You do not have to use the same method for both fields.'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Denylists")),(0,r.kt)("p",null,"This is an array of strings used to prevent certain elements from being tracked. Any form with a CSS class in the array will be ignored. Any field whose name property is in the array will be ignored. All other elements will be tracked."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Allowlists")),(0,r.kt)("p",null,"This is an array of strings used to turn on certail. Any form with a CSS class in the array will be tracked. Any field in a tracked form whose name property is in the array will be tracked. All other elements will be ignored."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Filter functions")),(0,r.kt)("p",null,"This is a function used to determine which elements are tracked. The element is passed as the argument to the function and is tracked if and only if the value returned by the function is truthy."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Transform functions")),(0,r.kt)("p",null,"This is a function used to transform data in each form field. The value and element (2.15.0+ only) are passed as arguments to the function and the tracked value is replaced by the value returned."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Contexts")),(0,r.kt)("p",null,"Contexts can be sent with all form tracking events by supplying them in an array in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"contexts"),"\xa0argument."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableFormTracking', { options: {}, context: [] });\n")),(0,r.kt)("p",null,"These contexts can be dynamic, i.e. they can be traditional self-describing JSON objects, or callbacks that generate valid self-describing JSON objects."),(0,r.kt)("p",null,"For form change events, context generators are passed\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"(elt, type, value)"),", and form submission events are passed\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"(elt, innerElements)"),"."),(0,r.kt)("p",null,"A dynamic context could therefore look something like this for form change events:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let dynamicContext = function (elt, type, value) {\n  // perform operations here to construct the context\n  return context;\n};\n\nsnowplow('enableFormTracking', { options: {}, context: [dynamicContext] });\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Examples")),(0,r.kt)("p",null,'To track every form element and every field except those fields named "password":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"var opts = {\n  forms: {\n    denylist: []\n  },\n  fields: {\n    denylist: ['password']\n  }\n};\n\nsnowplow('enableFormTracking', { options: opts });\n")),(0,r.kt)("p",null,'To track only the forms with CSS class "tracked", and only those fields whose ID is not "private":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'var opts = {\n  forms: {\n    allowlist: ["tracked"]\n  },\n  fields: {\n    filter: function (elt) {\n      return elt.id !== "private";\n    }\n  }\n};\n\nsnowplow(\'enableFormTracking\', { options: opts });\n')),(0,r.kt)("p",null,"To transform the form fields with an MD5 hashing function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'var opts = {\n  forms: {\n    allowlist: ["tracked"]\n  },\n  fields: {\n    filter: function (elt) {\n      return elt.id !== "private";\n    },\n    transform: function (value, elt) {\n      // can use elt to make transformation decisions\n      return MD5(value);\n    }\n  }\n};\n\nsnowplow(\'enableFormTracking\', { options: opts });\n')),(0,r.kt)("h4",{id:"tracking-forms-embedded-inside-iframes"},"Tracking forms embedded inside iframes"),(0,r.kt)("p",null,"The options for tracking forms inside of iframes are limited \u2013 browsers block access to contents of iframes that are from different domains than the parent page. We are not able to provide a solution to track events using trackers initialized on the parent page in such cases. However, since version 3.4, it is possible to track events from forms embedded in iframes loaded from the same domain as the parent page or iframes created using JavaScript on the parent page (e.g., HubSpot forms)."),(0,r.kt)("p",null,"In case you are able to access form elements inside an iframe, you can pass them in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"options.forms"),"\xa0argument when calling\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),"\xa0on the parent page. This will enable form tracking for the specific form elements. The feature may also be used for forms not embedded in iframes, but it's most useful in this particular case."),(0,r.kt)("p",null,"The following example shows how to identify the form elements inside an iframe and pass them to the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableFormTracking"),"\xa0function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let iframe = document.getElementById('form_iframe'); // find the element for the iframe\nlet forms = iframe.contentWindow.document.getElementsByTagName('form'); // find form elements inside the iframe\nsnowplow('enableFormTracking', {\n    options: {\n        forms: forms // pass the embedded forms when enabling form tracking\n    },\n});\n")),(0,r.kt)("h3",{id:"ecommerce-tracking"},"Ecommerce tracking"),(0,r.kt)("p",null,"Modelled on Google Analytics ecommerce tracking capability, Snowplow uses three methods that have to be used together to track online transactions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Create a transaction object"),". Use\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"addTrans()"),"\xa0method to initialize a transaction object. This will be the object that is loaded with all the data relevant to the specific transaction that is being tracked including all the items in the order, the prices of the items, the price of shipping and the\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"order_id"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Add items to the transaction."),"\xa0Use the\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"addItem()"),"\xa0method to add data about each individual item to the transaction object."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Submit the transaction to Snowplow"),"\xa0using the trackTrans() method, once all the relevant data has been loaded into the object.")),(0,r.kt)("h4",{id:"addtrans"},(0,r.kt)("inlineCode",{parentName:"h4"},"addTrans")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addTrans"),"\xa0method creates a transaction object. It takes nine possible parameters, two of which are required:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Example value")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"orderId")),(0,r.kt)("td",{parentName:"tr",align:null},"Internal unique order id number for this transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'1234'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"affiliation")),(0,r.kt)("td",{parentName:"tr",align:null},"Partner or store affiliation"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'Womens Apparel'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"total")),(0,r.kt)("td",{parentName:"tr",align:null},"Total amount of the transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'19.99'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tax")),(0,r.kt)("td",{parentName:"tr",align:null},"Tax amount of the transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'1.00'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"shipping")),(0,r.kt)("td",{parentName:"tr",align:null},"Shipping charge for the transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'2.99'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"city")),(0,r.kt)("td",{parentName:"tr",align:null},"City to associate with transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'San Jose'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"state")),(0,r.kt)("td",{parentName:"tr",align:null},"State or province to associate with transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'California'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"country")),(0,r.kt)("td",{parentName:"tr",align:null},"Country to associate with transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'USA'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"Currency to associate with this transaction"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'USD'")))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addTrans', {\n    orderId: '1234',  // required\n    total: 11.99,   // required\n    affiliation: 'Acme Clothing', \n    tax: 1.29,\n    shipping: 5,\n    city: 'San Jose',\n    state: 'California',\n    country: 'USA',\n    currency: 'USD'\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"addTrans"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h4",{id:"additem"},(0,r.kt)("inlineCode",{parentName:"h4"},"addItem")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addItem"),"\xa0method is used to capture the details of each product item included in the transaction. It should therefore be called once for each item."),(0,r.kt)("p",null,"There are six potential parameters that can be passed with each call, four of which are required:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Example value")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"orderId")),(0,r.kt)("td",{parentName:"tr",align:null},"Order ID of the transaction to associate with item"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'1234'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sku")),(0,r.kt)("td",{parentName:"tr",align:null},"Item's SKU code"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'pbz0001234'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"Product name"),(0,r.kt)("td",{parentName:"tr",align:null},"No, but advisable (to make interpreting SKU easier)"),(0,r.kt)("td",{parentName:"tr",align:null},"'Black Tarot'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"Product category"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'Large'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"price")),(0,r.kt)("td",{parentName:"tr",align:null},"Product price"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"9.99")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"quantity")),(0,r.kt)("td",{parentName:"tr",align:null},"Purchase quantity"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"Product price currency"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'USD'")))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addItem', {\n    orderId: '1234', // required\n    sku: 'DD44',     // required\n    name: 'T-Shirt',      \n    category: 'Green Medium',\n    price: 11.99,\n    quantity: 1,\n    currency: 'USD'\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"addItem"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h4",{id:"tracktrans"},"trackTrans"),(0,r.kt)("p",null,"Once the transaction object has been created (using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addTrans"),") and the relevant item data added to it using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addItem"),"\xa0method, we are ready to send the data to the collector. This is initiated using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackTrans"),"\xa0method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackTrans');\n")),(0,r.kt)("h4",{id:"putting-the-three-methods-together-a-complete-example"},"Putting the three methods together: a complete example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<html>\n<head>\n<title>Receipt for your clothing purchase from Acme Clothing</title>\n<script type=\"text/javascript\">\n\n  ;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];\n  p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)\n  };p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;\n  n.src=w;g.parentNode.insertBefore(n,g)}}(window,document,\"script\",\"{{URL to sp.js}}\",\"snowplow\"));\n\n  snowplow('newTracker', 'sp', '{{collector_url_here}}', { appId: 'my-store' });\n  snowplow('enableActivityTracking',{ \n    minimumVisitLength: 30, \n    heartbeatDelay: 10 \n  });\n  snowplow('trackPageView');\n  snowplow('enableLinkClickTracking');\n\n  snowplow('addTrans', {\n    orderId: '1234',  // required\n    total: 11.99,   // required\n    affiliation: 'Acme Clothing', \n    tax: 1.29,\n    shipping: 5,\n    city: 'San Jose',\n    state: 'California',\n    country: 'USA',\n    currency: 'USD'\n  });\n\n   // add item might be called for every item in the shopping cart\n   // where your ecommerce engine loops through each item in the cart and\n   // prints out _addItem for each\n  snowplow('addItem', {\n    orderId: '1234', // required\n    sku: 'DD44',     // required\n    name: 'T-Shirt',      \n    category: 'Green Medium',\n    price: 11.99,\n    quantity: 1,\n    currency: 'USD'\n  });\n\n  // trackTrans sends the transaction to Snowplow tracking servers.\n  // Must be called last to commit the transaction.\n  snowplow('trackTrans'); //submits transaction to the collector\n\n<\/script>\n</head>\n<body>\n\n  Thank you for your order.  You will receive an email containing all your order details.\n\n</body>\n</html>\n")),(0,r.kt)("h4",{id:"trackaddtocartandtrackremovefromcart"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackAddToCart"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"h4"},"trackRemoveFromCart")),(0,r.kt)("p",null,"These methods let you track users adding and removing items from a cart on an ecommerce site. Their arguments are identical:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sku")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Item SKU"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Item name"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Item category"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"unitPrice")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Item price"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"quantity")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Quantity added to or removed from cart"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Item price currency"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackAddToCart', {\n  sku: '000345', \n  name: 'blue tie', \n  category: 'clothing', \n  unitPrice: 3.49, \n  quantity: 2, \n  currency: 'GBP'\n});\n\nsnowplow('trackRemoveFromCart', {\n  sku: '000345', \n  name: 'blue tie', \n  category: 'clothing', \n  unitPrice: 3.49, \n  quantity: 2, \n  currency: 'GBP'\n});\n")),(0,r.kt)("p",null,"Both methods are implemented as Snowplow self describing events. You can see schemas for the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/add_to_cart/jsonschema/1-0-0"},(0,r.kt)("inlineCode",{parentName:"a"},"add_to_cart")),"\xa0and\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/remove_from_cart/jsonschema/1-0-0"},(0,r.kt)("inlineCode",{parentName:"a"},"remove_from_cart")),"\xa0events."),(0,r.kt)("p",null,"Both methods can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"social-tracking"},"Social tracking"),(0,r.kt)("p",null,'Social tracking will be used to track the way users interact with Facebook, Twitter and Google + widgets, e.g. to capture "like this" or "tweet this" events.'),(0,r.kt)("h4",{id:"tracksocialinteraction"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackSocialInteraction")),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackSocialInteraction"),"\xa0method takes three parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Example value")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"action")),(0,r.kt)("td",{parentName:"tr",align:null},"Social action performed"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'like', 'retweet'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"network")),(0,r.kt)("td",{parentName:"tr",align:null},"Social network"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"'facebook', 'twitter'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"target")),(0,r.kt)("td",{parentName:"tr",align:null},"Object social action is performed on e.g. page ID, product ID"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"'19.99'")))),(0,r.kt)("p",null,"The method is executed in as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSocialInteraction', { \n  action: string, \n  network: string, \n  target: string \n});\n")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSocialInteraction', {\n  action: 'like', \n  network: 'facebook', \n  target: 'pbz00123'\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackSocialInteraction"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracking-specific-events/#custom-contexts"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"campaign-tracking"},"Campaign tracking"),(0,r.kt)("p",null,"Campaign tracking is used to identify the source of traffic coming to a website."),(0,r.kt)("p",null,"At the highest level, we can distinguish\xa0",(0,r.kt)("strong",{parentName:"p"},"paid"),"\xa0traffic (that derives from ad spend) with\xa0",(0,r.kt)("strong",{parentName:"p"},"non paid"),"\xa0traffic: visitors who come to the website by entering the URL directly, clicking on a link from a referrer site or clicking on an organic link returned in a search results, for example."),(0,r.kt)("p",null,"In order to identify\xa0",(0,r.kt)("strong",{parentName:"p"},"paid"),"\xa0traffic, Snowplow users need to set five query parameters on the links used in ads. Snowplow checks for the presence of these query parameters on the web pages that users load: if it finds them, it knows that that user came from a paid source, and stores the values of those parameters so that it is possible to identify the paid source of traffic exactly."),(0,r.kt)("p",null,"If the query parameters are not present, Snowplow reasons that the user is from a\xa0",(0,r.kt)("strong",{parentName:"p"},"non paid"),"\xa0source of traffic. It then checks the page referrer (the url of the web page the user was on before visiting our website), and uses that to deduce the source of traffic:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'If the URL is identified as a search engine, the traffic medium is set to "organic" and Snowplow tries to derive the search engine name from the referrer URL domain and the keywords from the query string.'),(0,r.kt)("li",{parentName:"ol"},'If the URL is a non-search 3rd party website, the medium is set to "referrer". Snowplow derives the source from the referrer URL domain.')),(0,r.kt)("h4",{id:"identifying-paid-sources"},"Identifying paid sources"),(0,r.kt)("p",null,"Your different ad campaigns (PPC campaigns, display ads, email marketing messages, Facebook campaigns etc.) will include one or more links to your website e.g.:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<a href="http://mysite.com/myproduct.html">Visit website</a>\n')),(0,r.kt)("p",null,"We want to be able to identify people who've clicked on ads e.g. in a marketing email as having come to the site having clicked on a link in that particular marketing email. To do that, we modify the link in the marketing email with query parameters, like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<a href="http://mysite.com/myproduct.html?utm_source=newsletter-october&utm_medium=email&utm_campaign=cn0201">Visit website</a>\n')),(0,r.kt)("p",null,"For the prospective customer clicking on the link, adding the query parameters does not change the user experience. (The user is still directed to the webpage at\xa0",(0,r.kt)("a",{parentName:"p",href:"http://mysite.com/myproduct.html"},"http://mysite.com/myproduct.html"),".) But Snowplow then has access to the fields given in the query string, and uses them to identify this user as originating from the October Newsletter, an email marketing campaign with campaign id = cn0201."),(0,r.kt)("h4",{id:"anatomy-of-the-query-parameters"},"Anatomy of the query parameters"),(0,r.kt)("p",null,"Snowplow uses the same query parameters used by Google Analytics. Because of this, Snowplow users who are also using GA do not need to do any additional work to make their campaigns trackable in Snowplow as well as GA. Those parameters are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"utm_source")),(0,r.kt)("td",{parentName:"tr",align:null},"Campaign source"),(0,r.kt)("td",{parentName:"tr",align:null},"Identify the advertiser driving traffic to your site e.g. Google, Facebook, autumn-newsletter etc.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"utm_medium")),(0,r.kt)("td",{parentName:"tr",align:null},"Campaign medium"),(0,r.kt)("td",{parentName:"tr",align:null},"The advertising / marketing medium e.g. cpc, banner, email newsletter, in-app ad, cpa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"utm_campaign")),(0,r.kt)("td",{parentName:"tr",align:null},"Campaign id"),(0,r.kt)("td",{parentName:"tr",align:null},"A unique campaign id. This can be a descriptive name or a number / string that is then looked up against a campaign table as part of the analysis")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"utm_term")),(0,r.kt)("td",{parentName:"tr",align:null},"Campaign term(s)"),(0,r.kt)("td",{parentName:"tr",align:null},"Used for search marketing in particular, this field is used to identify the search terms that triggered the ad being displayed in the search results.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"utm_content")),(0,r.kt)("td",{parentName:"tr",align:null},"Campaign content"),(0,r.kt)("td",{parentName:"tr",align:null},"Used either to differentiate similar content or two links in the same ad. (So that it is possible to identify which is generating more traffic.)")))),(0,r.kt)("p",null,"The parameters are descibed in the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://support.google.com/analytics/answer/1033863"},"Google Analytics help page"),". Google also provides a\xa0",(0,r.kt)("a",{parentName:"p",href:"https://support.google.com/analytics/answer/1033867?hl=en"},"urlbuilder"),"\xa0which can be used to construct the URL incl. query parameters to use in your campaigns."),(0,r.kt)("h3",{id:"ad-tracking-methods"},"Ad tracking methods"),(0,r.kt)("p",null,"Snowplow tracking code can be included in ad tags in order to track impressions and ad clicks. This is used by e.g. ad networks to identify which sites and web pages users visit across a network, so that they can be segmented, for example."),(0,r.kt)("p",null,"Each ad tracking method has a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"costModel"),"\xa0field and a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"cost"),"\xa0field. If you provide the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"cost"),"\xa0field, you must also provide one of\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"'cpa'"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"'cpc'"),", and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"'cpm'"),"\xa0for the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"costModel"),"\xa0field."),(0,r.kt)("p",null,"It may be the case that multiple ads from the same source end up on a single page. If this happens, it is important that the different Snowplow code snippets associated with those ads not interfere with one another. The best way to prevent this is to randomly name each tracker instance you create so that the probability of a name collision is negligible. See\xa0",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/managing-multiple-trackers/"},"Managing multiple trackers"),"\xa0for more on having more than one tracker instance on a single page."),(0,r.kt)("p",null,"Below is an example of how to achieve this when using Snowplow ad impression tracking."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"\x3c!-- Snowplow starts plowing --\x3e\n<script type=\"text/javascript\">\n\n// Wrap script in a closure.\n// This prevents rnd from becoming a global variable.\n// So if multiple copies of the script are loaded on the same page,\n// each instance of rnd will be inside its own namespace and will\n// not overwrite any of the others.\n// See http://benalman.com/news/2010/11/immediately-invoked-function-expression/\n(function(){\n  // Randomly generate tracker namespace to prevent clashes\n  var rnd = Math.random().toString(36).substring(2);\n\n  // Load Snowplow\n  ;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];\n  p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)\n  };p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;\n  n.src=w;g.parentNode.insertBefore(n,g)}}(window,document,\"script\",\"{{URL to sp.js}}\",\"snowplow\"));\n\n  // Create a new tracker namespaced to rnd\n  snowplow('newTracker', rnd, '{{COLLECTOR_URL}}', {\n    appId: 'myApp',\n  });\n\n  // Replace the values below with macros from your adserver\n  snowplow('trackAdImpression:' + rnd, {\n    impressionId: '67965967893',\n    costModel: 'cpm',          // 'cpa', 'cpc', or 'cpm'\n    cost: 5.5,\n    targetUrl: 'http://www.example.com',\n    bannerId: '23',\n    zoneId: '7',\n    advertiserId: '201',\n    campaignId: '12'\n  });\n}());\n<\/script>\n\x3c!-- Snowplow stops plowing --\x3e\n")),(0,r.kt)("p",null,"Even if several copies of the above script appear on a page, the trackers created will all (probably) have different names and so will not interfere with one another. The same technique should be used when tracking ad clicks. The below examples for\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdImpression"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdClick"),"\xa0assume that\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"rnd"),"\xa0has been defined in this way."),(0,r.kt)("h4",{id:"trackadimpression"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackAdImpression")),(0,r.kt)("p",null,"Ad impression tracking is accomplished using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdImpression"),"\xa0method. Here are the arguments it accepts:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"impressionId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the particular impression instance"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"costModel")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"The cost model for the campaign: 'cpc', 'cpm', or 'cpa'"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cost")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Ad cost"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"targetUrl")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"The destination URL"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bannerId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the ad banner (creative) being displayed"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"zoneId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the zone where the ad banner is located"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"advertiserID")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the advertiser which the campaign belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"campaignId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the ad campaign which the banner belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"NOTE: All properties are optional but you must specify at least 1 for this to be a valid call to ",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdImpression"),"."),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackAdImpression', {\n    impressionId: '67965967893',\n    costModel: 'cpm', // 'cpa', 'cpc', or 'cpm'\n    cost: 5.5,\n    targetUrl: 'http://www.example.com',\n    bannerId: '23',\n    zoneId: '7',\n    advertiserId: '201',\n    campaignId: '12'\n});\n")),(0,r.kt)("p",null,"Ad impression events are implemented as Snowplow self describing events.\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/ad_impression/jsonschema/1-0-0"},"Here"),"\xa0is the JSON schema for an ad impression event."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackAdImpression"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h4",{id:"trackadclick"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackAdClick")),(0,r.kt)("p",null,"Ad click tracking is accomplished using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdClick"),"\xa0method. Here are the arguments it accepts:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"targetUrl")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"The destination URL"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"clickId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the particular click instance"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"costModel")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"The cost model for the campaign: 'cpc', 'cpm', or 'cpa'"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cost")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Ad cost"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bannerId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the ad banner (creative) being displayed"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"zoneId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the zone where the ad banner is located"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"advertiserID")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the advertiser which the campaign belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"campaignId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the ad campaign which the banner belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackAdClick',\n  targetUrl: 'http://www.example.com',\n  clickId: '12243253',\n  costModel: 'cpm',\n  cost: 2.5,\n  bannerId: '23',\n  zoneId: '7',\n  impressionId: '67965967893', // the same as in trackAdImpression\n  advertiserId: '201',\n  campaignId: '12'\n);\n")),(0,r.kt)("p",null,"Ad click events are implemented as Snowplow self describing events.",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/ad_click/jsonschema/1-0-0"},"Here"),"\xa0is the JSON schema for an ad click event."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackAdClick"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h4",{id:"trackadconversion"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackAdConversion")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdConversion"),"\xa0method to track ad conversions. Here are the arguments it accepts:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"conversionId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the particular conversion instance"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"costModel")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"The cost model for the campaign: 'cpc', 'cpm', or 'cpa'"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cost")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Ad cost"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Conversion category"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"action")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"The type of user interaction, e.g. 'purchase'"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"property")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Describes the object of the conversion"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"initialValue")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"How much the conversion is initially worth"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"advertiserID")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the advertiser which the campaign belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"campaignId")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Adserver identifier for the ad campaign which the banner belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"NOTE: All properties are optional but you must specify at least 1 for this to be a valid call to ",(0,r.kt)("inlineCode",{parentName:"p"},"trackAdConversion"),"."),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackAdConversion', {\n    conversionId: '743560297',\n    costModel: 'cpa',\n    cost: 10,\n    category: 'ecommerce',\n    action: 'purchase',\n    property: '',\n    initialValue: 99,\n    advertiserId: '201',\n    campaignId: '12'\n});\n")),(0,r.kt)("p",null,"Ad conversion events are implemented as Snowplow self describing events.\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/ad_conversion/jsonschema/1-0-0"},"Here"),"\xa0is the schema for an ad conversion event."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackAdConversion"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"tracksitesearch"},(0,r.kt)("inlineCode",{parentName:"h3"},"trackSiteSearch")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackSiteSearch"),"\xa0method to track users searching your website. Here are its arguments:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"terms")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Search terms"),(0,r.kt)("td",{parentName:"tr",align:null},"array")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"filters")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Search filters"),(0,r.kt)("td",{parentName:"tr",align:null},"JSON")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"totalResults")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Results found"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pageResults")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Results displayed on first page"),(0,r.kt)("td",{parentName:"tr",align:null},"number")))),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"snowplow('trackSiteSearch', {\n    terms: ['unified', 'log'],\n    filters: {'category': 'books', 'sub-category': 'non-fiction'},\n    totalResults: 14,\n    pageResults: 8\n});\n")),(0,r.kt)("p",null,"Site search events are implemented as Snowplow self describing events.\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/site_search/jsonschema/1-0-0"},"Here"),"\xa0is the schema for a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"site_search"),"\xa0event."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackSiteSearch"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"tracktiming"},(0,r.kt)("inlineCode",{parentName:"h3"},"trackTiming")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackTiming"),"\xa0method to track user timing events such as how long resources take to load. Here are its arguments:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Timing category"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"variable")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Timed variable"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"timing")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Number of milliseconds elapsed"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"label")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Label for the event"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"An example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackTiming', {\n  category: 'load',\n  variable: 'map_loaded',\n  timing: 50,\n  label: 'Map loading time'\n});\n")),(0,r.kt)("p",null,"Site search events are implemented as Snowplow self describing events.\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/timing/jsonschema/1-0-0"},"Here"),"\xa0is the schema for a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"timing"),"\xa0event."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackTiming"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("h3",{id:"enhanced-ecommerce-tracking"},"Enhanced Ecommerce tracking"),(0,r.kt)("p",null,"For more information on the Enhanced Ecommerce functions please see the Google Analytics\xa0",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/analytics/devguides/collection/analyticsjs/enhanced-ecommerce"},"documentation"),"."),(0,r.kt)("h4",{id:"addenhancedecommerceactioncontext"},(0,r.kt)("inlineCode",{parentName:"h4"},"addEnhancedEcommerceActionContext")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addEnhancedEcommerceActionContext"),"\xa0method to add a GA Enhanced Ecommerce Action Context to the Tracker:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"affiliation")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"revenue")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"number OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tax")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"number OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"shipping")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"number OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"coupon")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"list")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"step")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"integer OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"option")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"Adding an action using Google Analytics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"ga('ec:setAction', 'purchase', {\n  'id': 'T12345',\n  'affiliation': 'Google Store - Online',\n  'revenue': '37.39',\n  'tax': '2.85',\n  'shipping': '5.34',\n  'coupon': 'SUMMER2013'\n});\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE"),": The action type is passed with the action context in the Google Analytics example. We have seperated this by asking you to call the\xa0trackEnhancedEcommerceAction\xa0function to actually send the context and the action."),(0,r.kt)("p",null,"Adding an action using Snowplow:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addEnhancedEcommerceActionContext', {\n  id: 'T12345',\n  affiliation: 'Google Store - Online',\n  revenue: '37.39', // Can also pass as number\n  tax: '2.85', // Can also pass as number\n  shipping: '5.34', // Can also pass as number\n  coupon: 'WINTER2016'\n});\n")),(0,r.kt)("h4",{id:"addenhancedecommerceimpressioncontext"},(0,r.kt)("inlineCode",{parentName:"h4"},"addEnhancedEcommerceImpressionContext")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addEnhancedEcommerceImpressionContext"),"\xa0method to add a GA Enhanced Ecommerce Impression Context to the Tracker:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"list")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"brand")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"variant")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"position")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"integer OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"price")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"number OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"Adding an impression using Google Analytics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"ga('ec:addImpression', {\n  'id': 'P12345',\n  'name': 'Android Warhol T-Shirt',\n  'list': 'Search Results',\n  'brand': 'Google',\n  'category': 'Apparel/T-Shirts',\n  'variant': 'Black',\n  'position': 1\n});\n")),(0,r.kt)("p",null,"Adding an impression using Snowplow:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addEnhancedEcommerceImpressionContext', {\n  id: 'P12345',\n  name: 'Android Warhol T-Shirt',\n  list: 'Search Results',\n  brand: 'Google',\n  category: 'Apparel/T-Shirts',\n  variant: 'Black',\n  position: 1\n});\n")),(0,r.kt)("h4",{id:"addenhancedecommerceproductcontext"},(0,r.kt)("inlineCode",{parentName:"h4"},"addEnhancedEcommerceProductContext")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addEnhancedEcommerceProductContext"),"\xa0method to add a GA Enhanced Ecommerce Product Field Context:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"list")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"brand")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"category")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"variant")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"price")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"number OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"quantity")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"integer OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"coupon")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"position")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"integer OR string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"Adding a product using Google Analytics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"ga('ec:addProduct', {\n  'id': 'P12345',\n  'name': 'Android Warhol T-Shirt',\n  'brand': 'Google',\n  'category': 'Apparel/T-Shirts',\n  'variant': 'Black',\n  'position': 1\n});\n")),(0,r.kt)("p",null,"Adding a product using Snowplow:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addEnhancedEcommerceProductContext', {\n  id: 'P12345',\n  name: 'Android Warhol T-Shirt',\n  list: 'Search Results',\n  brand: 'Google',\n  category: 'Apparel/T-Shirts',\n  variant: 'Black',\n  quantity: 1\n});\n")),(0,r.kt)("h4",{id:"addenhancedecommercepromocontext"},(0,r.kt)("inlineCode",{parentName:"h4"},"addEnhancedEcommercePromoContext")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"addEnhancedEcommercePromoContext"),"\xa0method to add a GA Enhanced Ecommerce Promotion Field Context:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"creative")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"position")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"currency")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"Adding a promotion using Google Analytics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"ga('ec:addPromo', {\n  'id': 'PROMO_1234',\n  'name': 'Summer Sale',\n  'creative': 'summer_banner2',\n  'position': 'banner_slot1'\n});\n")),(0,r.kt)("p",null,"Adding a promotion using Snowplow:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addEnhancedEcommercePromoContext', {\n  id: 'PROMO_1234', // The Promotion ID\n  name: 'Summer Sale', // The name\n  creative: 'summer_banner2', // The name of the creative\n  position: 'banner_slot1' // The position\n});\n")),(0,r.kt)("h4",{id:"trackenhancedecommerceaction"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackEnhancedEcommerceAction")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackEnhancedEcommerceAction"),"\xa0method to track a GA Enhanced Ecommerce Action. When this function is called all of the added Ecommerce Contexts are attached to this action and flushed from the Tracker."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"action")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"string")))),(0,r.kt)("p",null,"The allowed actions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"click")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"detail")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"add")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"remove")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"checkout")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"checkout_option")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"purchase")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"refund")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"promo_click")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"view"))),(0,r.kt)("p",null,"Adding an action using Google Analytics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"ga('ec:setAction', 'refund', {\n  'id': 'T12345'\n});\n")),(0,r.kt)("p",null,"Adding an action using Snowplow:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('addEnhancedEcommerceActionContext', {\n  id: 'T12345'\n});\nsnowplow('trackEnhancedEcommerceAction', {\n  action: 'refund'\n});\n")),(0,r.kt)("h3",{id:"consent-tracking"},"Consent tracking"),(0,r.kt)("h4",{id:"trackconsentgranted"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackConsentGranted")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackConsentGranted"),"\xa0method to track a user opting into data collection. A consent document context will be attached to the event if at least the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"id"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"version"),"\xa0arguments are supplied. The method arguments are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the document granting consent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"version")),(0,r.kt)("td",{parentName:"tr",align:null},"Version of the document granting consent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the document granting consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:null},"Description of the document granting consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"expiry")),(0,r.kt)("td",{parentName:"tr",align:null},"Date-time string specifying when consent document expires"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"context")),(0,r.kt)("td",{parentName:"tr",align:null},"Custom context for the event"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Array")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tstamp")),(0,r.kt)("td",{parentName:"tr",align:null},"When the event occurred"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Positive integer")))),(0,r.kt)("p",null,"The\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"expiry"),"\xa0field specifies that the user consents to the attached documents until the date-time provided, after which the consent is no longer valid."),(0,r.kt)("p",null,"Tracking a consent granted event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackConsentGranted', {\n  id: '1234',\n  version: '5',\n  name: 'consent_document',\n  description: 'a document granting consent',\n  expiry: '2020-11-21T08:00:00.000Z'\n});\n")),(0,r.kt)("h4",{id:"trackconsentwithdrawn"},(0,r.kt)("inlineCode",{parentName:"h4"},"trackConsentWithdrawn")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackConsentWithdrawn"),"\xa0method to track a user withdrawing consent for data collection. A consent document context will be attached to the event if at least the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"id"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"version"),"\xa0arguments are supplied. To specify that a user opts out of all data collection,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"all"),"\xa0should be set to\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("p",null,"The method arguments are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"all")),(0,r.kt)("td",{parentName:"tr",align:null},"Specifies whether all consent should be withdrawn"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the document withdrawing consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"version")),(0,r.kt)("td",{parentName:"tr",align:null},"Version of the document withdrawing consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the document withdrawing consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:null},"Description of the document withdrawing consent"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"context")),(0,r.kt)("td",{parentName:"tr",align:null},"Custom context for the event"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Array")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tstamp")),(0,r.kt)("td",{parentName:"tr",align:null},"When the event occurred"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Positive integer")))),(0,r.kt)("p",null,"Tracking a consent withdrawn event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackConsentWithdrawn', {\n  all: false,\n  id: '1234',\n  version: '5',\n  name: 'consent_document',\n  description: 'a document withdrawing consent'\n});\n")),(0,r.kt)("h4",{id:"consent-documents"},"Consent documents"),(0,r.kt)("p",null,"Consent documents are stored in the context of a consent event. Each consent method adds a consent document to the event. The consent document is a custom context storing the arguments supplied to the method (in both granted and withdrawn events, this will be: id, version, name, and description). In either consent method, additional documents can be appended to the event by passing an array of consent document self-describing JSONs in the context argument."),(0,r.kt)("p",null,"The fields of a consent document are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"id")),(0,r.kt)("td",{parentName:"tr",align:null},"Identifier for the document"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"version")),(0,r.kt)("td",{parentName:"tr",align:null},"Version of the document"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the document"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:null},"Description of the document"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")))),(0,r.kt)("p",null,"A consent document self-describing JSON looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n  schema: 'iglu:com.snowplowanalytics.snowplow/consent_document/jsonschema/1-0-0',\n  data: {\n    id: '1234',\n    version: '5',\n    name: 'consent_document_name',\n    description: 'here is a description'\n  }\n}\n")),(0,r.kt)("p",null,"As an example,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackConsentGranted"),"\xa0will store one consent document as a custom context:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackConsentGranted',\n  id: '1234', \n  version: '5', \n  name: 'consent_document', \n  description: 'a document granting consent', \n  expiry: '2020-11-21T08:00:00.000Z'\n);\n")),(0,r.kt)("p",null,"The method call will generate this event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n  e: 'ue',\n  ue_pr: {\n    schema: 'iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0',\n    data: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/consent_granted/jsonschema/1-0-0',\n      data: {\n        expiry: '2020-11-21T08:00:00.000Z'\n      }\n    }\n  },\n  co: {\n    schema: 'iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0',\n    data: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/consent_document/jsonschema/1-0-0',\n      data: {\n        id: '1234',\n        version: '5',\n        name: 'consent_document',\n        description: 'a document granting consent'\n      }\n    }\n  }\n}\n")),(0,r.kt)("h3",{id:"gdpr-context"},"GDPR context"),(0,r.kt)("p",null,"The GDPR context attaches a context with the GDPR basis for processing and the details of a related docuemnt (eg. a consent document) to all events which are fired after it is set."),(0,r.kt)("p",null,"It takes the following arguments:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"basisForProcessing")),(0,r.kt)("td",{parentName:"tr",align:null},"GDPR Basis for processing"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Enum String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"documentId")),(0,r.kt)("td",{parentName:"tr",align:null},"ID of a GDPR basis document"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"documentVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"Version of the document"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"documentDescription")),(0,r.kt)("td",{parentName:"tr",align:null},"Description of the document"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n  e: 'ue',\n  ue_pr: {\n    schema: 'iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0',\n    data: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/consent_granted/jsonschema/1-0-0',\n      data: {\n        expiry: '2020-11-21T08:00:00.000Z'\n      }\n    }\n  },\n  co: {\n    schema: 'iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0',\n    data: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/consent_document/jsonschema/1-0-0',\n      data: {\n        id: '1234',\n        version: '5',\n        name: 'consent_document',\n        description: 'a document granting consent'\n      }\n    }\n  }\n}\n")),(0,r.kt)("p",null,"The required basisForProcessing accepts only the following literals:\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"consent"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"contract"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"legalObligation"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"vitalInterests"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"publicTask"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"legitimateInterests"),"\xa0- in accordance with the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/lawful-basis-for-processing/"},"five legal bases for processing")),(0,r.kt)("p",null,"The GDPR context is enabled by calling the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableGdprContext"),"\xa0method once the tracker has been initialised, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableGdprContext', {\n  basisForProcessing: 'consent',\n  documentId: 'consentDoc-abc123',\n  documentVersion: '0.1.0',\n  documentDescription: 'this document describes consent basis for processing'\n});\n")),(0,r.kt)("h4",{id:"error-tracking"},"Error tracking"),(0,r.kt)("p",null,"Snowplow JS tracker provides two ways of tracking exceptions: manual tracking of handled exceptions using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackError"),"\xa0and automatic tracking of unhandled exceptions using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableErrorTracking"),"."),(0,r.kt)("h5",{id:"trackerror"},(0,r.kt)("inlineCode",{parentName:"h5"},"trackError")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackError"),"\xa0method to track handled exceptions (application errors) in your JS code. This is its signature:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackError', {\n  /** The error message */\n  message: string;\n  /** The filename where the error occurred */\n  filename?: string;\n  /** The line number which the error occurred on */\n  lineno?: number;\n  /** The column number which the error occurred on */\n  colno?: number;\n  /** The error object */\n  error?: Error;\n});\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"message")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Error message"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"filename")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Filename or URL"),(0,r.kt)("td",{parentName:"tr",align:null},"string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"lineno")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Line number of problem code chunk"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"colno")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Column number of problem code chunk"),(0,r.kt)("td",{parentName:"tr",align:null},"number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"error")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"JS\xa0",(0,r.kt)("inlineCode",{parentName:"td"},"ErrorEvent")),(0,r.kt)("td",{parentName:"tr",align:null},"ErrorEvent")))),(0,r.kt)("p",null,"Of these arguments, only\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"message"),"\xa0is required. Signature of this method defined to match\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"window.onerror"),"\xa0callback in modern browsers."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"try {\n  var user = getUser()\n} catch(e) {\n  snowplow('trackError', {\n    message: 'Cannot get user object', \n    filename: 'shop.js', \n    error: e\n  });\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"trackError"),"\xa0can also be passed an array of custom context as an additional parameter. See\xa0",(0,r.kt)("a",{parentName:"p",href:"#custom-context"},"custom context"),"\xa0for more information."),(0,r.kt)("p",null,"Using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackError"),"\xa0it's assumed that developer knows where error could happen, which is not often the case. Therefor it's recommended to use\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableErrorTracking"),"\xa0as it allows you to discover errors that weren't expected."),(0,r.kt)("h5",{id:"enableerrortracking"},(0,r.kt)("inlineCode",{parentName:"h5"},"enableErrorTracking")),(0,r.kt)("p",null,"Use the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"enableErrorTracking"),"\xa0method to track unhandled exceptions (application errors) in your JS code. This is its signature:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableErrorTracking', {\n  /** A callback which allows on certain errors to be tracked */\n  filter?: (error: ErrorEvent) => boolean;\n  /** A callback to dynamically add extra context based on the error */\n  contextAdder?: (error: ErrorEvent) => Array<SelfDescribingJson>;\n  /** Context to be added to every error */\n  context?: Array<SelfDescribingJson>;\n}\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Name")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Type")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"filter")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Predicate to filter exceptions"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"(ErrorEvent) => Boolean"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"contextAdder")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Function to get dynamic context"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"(ErrorEvent) => Array<SelfDescribingJson>"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"context"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Additional custom context"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Array<SelfDescribingJson>"))))),(0,r.kt)("p",null,"Unlike\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"trackError"),"\xa0you need enable error tracking only once:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('enableErrorTracking')\n")),(0,r.kt)("p",null,"Application error events are implemented as Snowplow self describing events.\xa0",(0,r.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.snowplowanalytics.snowplow/application_error/jsonschema/1-0-1"},"Here"),"\xa0is the schema for a\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"application_error"),"\xa0event."),(0,r.kt)("h3",{id:"setting-the-true-timestamp"},"Setting the true timestamp"),(0,r.kt)("p",null,"As standard, every event tracked by the Javascript tracker will be recorded with two timestamps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"A\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"device_created_tstamp"),"\xa0- set when the event occurred"),(0,r.kt)("li",{parentName:"ol"},"A\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"device_sent_tstamp"),"\xa0- set when the event was sent by the tracker to the collector")),(0,r.kt)("p",null,"These are combined downstream in the Snowplow pipeline (with the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"collector_tstamp"),") to calculate the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"derived_tstamp"),", which is our best estimate of when the event actually occurred."),(0,r.kt)("p",null,"In certain circumstances you might want to set the timestamp yourself e.g. if the JS tracker is being used to process historical event data, rather than tracking the events live. In this case you can set the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"true_timestamp"),"\xa0for the event. When set, this will be used as the value in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"derived_tstamp"),"\xa0rather than a combination of the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"device_created_tstamp"),",\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"device_sent_tstamp"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"collector_tstamp"),"."),(0,r.kt)("p",null,"To set the true timestamp add an extra argument to your track method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{type: 'ttm', value: unixTimestampInMs}\n")),(0,r.kt)("p",null,"e.g. to set a true timestamp with a page view event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackPageView', {\n  timestamp: { type: 'ttm', value: 1361553733371 }\n});\n")),(0,r.kt)("p",null,"e.g. to set a true timestamp for a self-describing event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"snowplow('trackSelfDescribingEvent', {\n  event: {\n    schema: 'iglu:com.acme_company/viewed_product/jsonschema/2-0-0',\n    data: {\n        productId: 'ASO01043',\n        category: 'Dresses',\n        brand: 'ACME',\n        returning: true,\n        price: 49.95,\n        sizes: ['xs', 's', 'l', 'xl', 'xxl'],\n        availableSince: new Date(2013,3,7)\n    }\n  },\n  timestamp: { type: 'ttm', value: 1361553733371 }\n});\n")))}m.isMDXComponent=!0},41481:(e,t,n)=>{n.d(t,{ZP:()=>i});var a=n(87462),r=(n(67294),n(3905));const l={toc:[]};function i(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow-javascript-tracker/releases"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/github/v/release/snowplow/snowplow-javascript-tracker?include_prereleases&sort=semver&style=flat",alt:null}))))}i.isMDXComponent=!0}}]);