"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[47228],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),h=i,d=m["".concat(l,".").concat(h)]||m[h]||u[h]||a;return n?o.createElement(d,r(r({ref:t},p),{},{components:n})):o.createElement(d,r({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<a;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},53888:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>d,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var o=n(87462),i=(n(67294),n(3905)),a=n(13963);const r={toc:[{value:"Setting the application ID",id:"setting-the-application-id",level:4},{value:"Setting the platform",id:"setting-the-platform",level:4},{value:"Configuring the cookie domain",id:"configuring-the-cookie-domain",level:4},{value:"Configuring the cookie name",id:"configuring-the-cookie-name",level:4},{value:"Configuring the cookie samesite attribute",id:"configuring-the-cookie-samesite-attribute",level:4},{value:"Configuring the cookie secure attribute",id:"configuring-the-cookie-secure-attribute",level:4},{value:"Configuring base 64 encoding",id:"configuring-base-64-encoding",level:4},{value:"Respecting Do Not Track",id:"respecting-do-not-track",level:4},{value:"Opt-out cookie",id:"opt-out-cookie",level:4},{value:"Anonymous Tracking (2.15.0+)",id:"anonymous-tracking-2150",level:4},{value:"Client Anonymous Tracking",id:"client-anonymous-tracking",level:5},{value:"Full Anonymous/Cookieless Tracking (2.17.0+)",id:"full-anonymouscookieless-tracking-2170",level:5},{value:"Anonymous Session Tracking",id:"anonymous-session-tracking",level:5},{value:"Setting the page unload pause",id:"setting-the-page-unload-pause",level:4},{value:"Setting the event request protocol",id:"setting-the-event-request-protocol",level:4},{value:"Setting an unsecure event request protocol",id:"setting-an-unsecure-event-request-protocol",level:4},{value:"Configuring the session cookie duration",id:"configuring-the-session-cookie-duration",level:4},{value:"Configuring the storage strategy",id:"configuring-the-storage-strategy",level:4},{value:"Adding predefined contexts",id:"adding-predefined-contexts",level:4},{value:"webPage context",id:"webpage-context",level:5},{value:"performanceTiming context",id:"performancetiming-context",level:5},{value:"gaCookies context",id:"gacookies-context",level:5},{value:"clientHints context (2.15.0+)",id:"clienthints-context-2150",level:5},{value:"geolocation context",id:"geolocation-context",level:5},{value:"optimizelyExperiments context",id:"optimizelyexperiments-context",level:5},{value:"optimizelyStates context",id:"optimizelystates-context",level:5},{value:"optimizelyVariations context",id:"optimizelyvariations-context",level:5},{value:"optimizelyVisitor context",id:"optimizelyvisitor-context",level:5},{value:"optimizelyAudiences context",id:"optimizelyaudiences-context",level:5},{value:"optimizelyDimensions context",id:"optimizelydimensions-context",level:5},{value:"optimizelySummary context",id:"optimizelysummary-context",level:5},{value:"optimizelyXSummary context",id:"optimizelyxsummary-context",level:5},{value:"parrable context",id:"parrable-context",level:5},{value:"POST support",id:"post-support",level:4},{value:"Beacon API support",id:"beacon-api-support",level:5},{value:"POST path",id:"post-path",level:5},{value:"Configuring cross-domain tracking",id:"configuring-cross-domain-tracking",level:4},{value:"Configuring the maximum payload size in bytes",id:"configuring-the-maximum-payload-size-in-bytes",level:4},{value:"Automatically discover and set the root domain",id:"automatically-discover-and-set-the-root-domain",level:4},{value:"Configuring the cookies lifetime",id:"configuring-the-cookies-lifetime",level:4},{value:"Tracking prerendered pages",id:"tracking-prerendered-pages",level:4},{value:"Limiting Local Storage queue size",id:"limiting-local-storage-queue-size",level:4},{value:"Reset Page Ping on Page View",id:"reset-page-ping-on-page-view",level:4},{value:"Skip tracking browser features (2.15.0+)",id:"skip-tracking-browser-features-2150",level:4},{value:"Set connection timeout (2.15.0+)",id:"set-connection-timeout-2150",level:4}]};function s(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},r,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Tracker initialization is started by calling the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},'"newTracker"'),"\xa0function and takes three arguments:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The tracker namespace"),(0,i.kt)("li",{parentName:"ol"},"The collector endpoint"),(0,i.kt)("li",{parentName:"ol"},"An optional configuration object containing other settings")),(0,i.kt)("p",null,"Here is a simple example of how to initialise a tracker:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('newTracker', 'sp', '{{collector_url_here}}', {\n  appId: 'my-app-id',\n  discoverRootDomain: true,\n  cookieSameSite: 'Lax', // Recommended\n  contexts: {\n    webPage: true\n  }\n});\n")),(0,i.kt)("p",null,"The tracker will be named \u201csp\u201d and will send events to the a collector url you specify by replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"{{collector_url_here}}"),". The final argument is the configuration object. Here it is just used to set the app ID and the common webPage context for each event. Each event the tracker sends will have an app ID field set to \u201cmy-app-id\u201d."),(0,i.kt)("p",null,"Here is a longer example in which every tracker configuration parameter is set:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('newTracker', 'sp', '{{collector_url_here}}', {\n  appId: 'my-app-id',\n  platform: 'web',\n  cookieDomain: null,\n  discoverRootDomain: true,\n  cookieName: '_sp_',\n  cookieSameSite: 'Lax', // Recommended\n  cookieSecure: true,\n  encodeBase64: true,\n  respectDoNotTrack: false,\n  pageUnloadTimer: 500,\n  forceSecureTracker: false,\n  eventMethod: 'post',\n  bufferSize: 1,\n  maxPostBytes: 40000,\n  postPath: '/custom/path',\n  crossDomainLinker: function (linkElement) {\n    return (linkElement.href === 'http://acme.de' || linkElement.id === 'crossDomainLink');\n  },\n  cookieLifetime: 63072000,\n  stateStorageStrategy: 'cookieAndLocalStorage',\n  maxLocalStorageQueueSize: 1000,\n  resetActivityTrackingOnPageView: true,\n  connectionTimeout: 5000, // Available from 2.15.0\n  skippedBrowserFeatures: [], // Available from 2.15.0\n  anonymousTracking: false, // Available from 2.15.0\n  // anonymousTracking: { withSessionTracking: true } // Available from 2.15.0\n  // anonymousTracking: { withSessionTracking: true, withServerAnonymisation: true } // Available from 2.17.0\n  contexts: {\n    webPage: true,\n    performanceTiming: true,\n    gaCookies: true,\n    geolocation: false,\n    clientHints: true, // Available from 2.15.0\n    // clientHints: { includeHighEntropy: true } // Optional\n  }\n});\n")),(0,i.kt)("p",null,"We will now go through the various configuration parameters. Note that these are all optional. In fact, you aren\u2019t required to provide any configuration object at all."),(0,i.kt)("h4",{id:"setting-the-application-id"},"Setting the application ID"),(0,i.kt)("p",null,"Set the application ID using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"appId"),"\xa0field of the configuration object. This will be attached to every event the tracker fires. You can set different application IDs on different parts of your site. You can then distinguish events that occur on different applications by grouping results based on\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"application_id"),"."),(0,i.kt)("h4",{id:"setting-the-platform"},"Setting the platform"),(0,i.kt)("p",null,"Set the application platform using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"platform"),"\xa0field of the configuration object. This will be attached to every event the tracker fires. Its default value is \u201cweb\u201d. For a list of supported platforms, please see the\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/SnowPlow-Tracker-Protocol"},"Snowplow Tracker Protocol"),"."),(0,i.kt)("h4",{id:"configuring-the-cookie-domain"},"Configuring the cookie domain"),(0,i.kt)("p",null,"If your website spans multiple subdomains e.g."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://www.mysite.com"},"www.mysite.com")),(0,i.kt)("li",{parentName:"ul"},"blog.mysite.com"),(0,i.kt)("li",{parentName:"ul"},"application.mysite.com")),(0,i.kt)("p",null,"You will want to track user behaviour across all those subdomains, rather than within each individually. As a result, it is important that the domain for your first party cookies is set to \u2018.mysite.com\u2019 rather than \u2018",(0,i.kt)("a",{parentName:"p",href:"http://www.mysite.com%E2%80%99"},"www.mysite.com\u2019"),". By doing so, any values that are stored on the cookie on one of subdomain will be accessible on all the others."),(0,i.kt)("p",null,"It is recommended that you\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker#discoverRootDomain"},"enable automatic discovery and setting of the root domain"),"."),(0,i.kt)("p",null,"Otherwise, set the cookie domain for the tracker instance using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cookieDomain"),"\xa0field of the configuration object. If this field is not set, the cookies will not be given a domain."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"WARNING"),":\xa0",(0,i.kt)("em",{parentName:"p"},"Changing the cookie domain will reset all existing cookies. As a result, it might be a major one-time disruption to data analytics because all visitors to the website will receive a new\xa0",(0,i.kt)("inlineCode",{parentName:"em"},"domain_userid"),".")),(0,i.kt)("h4",{id:"configuring-the-cookie-name"},"Configuring the cookie name"),(0,i.kt)("p",null,"Set the cookie name for the tracker instance using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cookieName"),"\xa0field of the configuration object. The default is \u201c",(0,i.kt)("em",{parentName:"p"},"sp"),"\u201c. Snowplow uses two cookies, a domain cookie and a session cookie. In the default case, their names are \u201c","_","sp","_","id\u201d and \u201c","_","sp","_","ses\u201d respectively. If you are upgrading from an earlier version of Snowplow, you should use the default cookie name so that the cookies set by the earlier version are still remembered. Otherwise you should provide a new name to prevent clashes with other Snowplow users on the same page."),(0,i.kt)("p",null,"Once set, you can retrieve a cookie name thanks to the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"getCookieName(basename)"),"\xa0method where basename is id or ses for the domain and session cookie respectively. As an example, you can retrieve the complete name of the domain cookie with\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"getCookieName('id')"),"."),(0,i.kt)("h4",{id:"configuring-the-cookie-samesite-attribute"},"Configuring the cookie samesite attribute"),(0,i.kt)("p",null,"Set the cookie samesite attribute for the tracker instance using the ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieSameSite"),' field of the configuration object. The default is \u201cNone\u201d for backward compatibility reasons, however \u2018Lax\u2019 is likely a better option for most use cases given the reasons below. Valid values are "Strict", "Lax", "None" or ',(0,i.kt)("inlineCode",{parentName:"p"},"null"),". ",(0,i.kt)("inlineCode",{parentName:"p"},"null")," will not set the SameSite attribute."),(0,i.kt)("p",null,'It is recommended to set either "None" or "Lax". You must use "None" if using the tracker in a third party iframe. "Lax" is good in all other cases and must be used if not setting Secure to true.'),(0,i.kt)("p",null,"Safari 12 Issue with SameSite cookies"),(0,i.kt)("p",null,"It's been noted that Safari 12 doesn't persist cookies with ",(0,i.kt)("inlineCode",{parentName:"p"},"SameSite: None")," as expected which can lead to rotation of the ",(0,i.kt)("inlineCode",{parentName:"p"},"domain_userid")," from users using this browser. You should switch to ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieSameSite: 'Lax'")," in your tracker configuration to solve this, unless you are tracking inside a third party iframe."),(0,i.kt)("h4",{id:"configuring-the-cookie-secure-attribute"},"Configuring the cookie secure attribute"),(0,i.kt)("p",null,"Set the cookie secure attribute for the tracker instance using the ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieSecure"),' field of the configuration object. The default is "true". Valid values are "true" or "false".'),(0,i.kt)("p",null,'It is recommended to set this to "true". This must be set to "false" if using the tracker on non-secure HTTP.'),(0,i.kt)("h4",{id:"configuring-base-64-encoding"},"Configuring base 64 encoding"),(0,i.kt)("p",null,"By default, self-describing events and custom contexts are encoded into Base64 to ensure that no data is lost or corrupted. You can turn encoding on or off using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"encodeBase64"),"\xa0field of the configuration object."),(0,i.kt)("h4",{id:"respecting-do-not-track"},"Respecting Do Not Track"),(0,i.kt)("p",null,"Most browsers have a Do Not Track option which allows users to express a preference not to be tracked. You can respect that preference by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"respectDoNotTrack"),"\xa0field of the configuration object to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". This prevents cookies from being sent and events from being fired."),(0,i.kt)("h4",{id:"opt-out-cookie"},"Opt-out cookie"),(0,i.kt)("p",null,"It is possible to set an opt-out cookie in order not to track anything similarly to Do Not Track through\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window.snowplow('setOptOutCookie', 'opt-out');"),"\xa0where \u2018opt-out\u2019 is the name of your opt-out cookie. If this cookie is set, cookies won\u2019t be stored and events won\u2019t be fired."),(0,i.kt)("h4",{id:"anonymous-tracking-2150"},"Anonymous Tracking (2.15.0+)"),(0,i.kt)("p",null,"The Snowplow JavaScript tracker offers two techniques where tracking can be done anonymously. This means that no user identifiers are sent to the Snowplow Collector. By default ",(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking: false"),"."),(0,i.kt)("p",null,"Recommended configurations when using ",(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"anonymousTracking: true, \nstateStorageStrategy: 'cookieAndLocalStorage'\n")),(0,i.kt)("p",null,"or"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"anonymousTracking: { withSessionTracking: true },\nstateStorageStrategy: 'cookieAndLocalStorage'\n")),(0,i.kt)("p",null,"or for a completely cookieless experience (from JavaScript Tracker 2.17.0+)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"anonymousTracking: { withServerAnonymisation: true },\nstateStorageStrategy: 'none',\neventMethod: 'post'\n")),(0,i.kt)("h5",{id:"client-anonymous-tracking"},"Client Anonymous Tracking"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking: true")),(0,i.kt)("p",null,"This mode will no longer track any user identifiers or session information. Similar in behaviour to setting ",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy: 'none'"),", as it will store no values in cookies or localStorage, however by using ",(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking")," you can toggle this behaviour on and off (useful for allowing events to be sent without user identifiers until cookie banners have been accepted)."),(0,i.kt)("p",null,"Setting ",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieAndLocalStorage")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage")," also allows for event buffering to continue working whilst not sending user information when ",(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking")," is enabled."),(0,i.kt)("p",null,"Anonymous tracking can be toggled on and off. The methods to control this behaviour are described ",(0,i.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/browser-tracker/browser-tracker-v3-reference/tracker-setup/additional-options/"},"here"),"."),(0,i.kt)("h5",{id:"full-anonymouscookieless-tracking-2170"},"Full Anonymous/Cookieless Tracking (2.17.0+)"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking: { withServerAnonymisation: true }")),(0,i.kt)("p",null,"Server Anonymisation requires the Snowplow Stream Collector v2.1.0+. Using a lower version will cause events to fail to send until Server Anonymisatoin is disabled."),(0,i.kt)("p",null,"Server Anonymisation will not work when the tracker is initialized with ",(0,i.kt)("inlineCode",{parentName:"p"},"eventMethod: 'beacon'")," as it requires additional custom headers which beacon does not support."),(0,i.kt)("p",null,"This mode will no longer track any user identifiers or session information, and will additionally prevent the Snowplow Collector from generating a ",(0,i.kt)("inlineCode",{parentName:"p"},"network_userid")," cookie and capturing the users IP address. The same behaviour described for above for Client side Anonymous tracking also applies."),(0,i.kt)("p",null,"Setting ",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieAndLocalStorage")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage")," also allows for event buffering to continue working whilst not sending user information when ",(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking")," is enabled. However for an experience that doesn't use any browser storage (cookieless), set ",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"none"),". This can be later toggled on, once a user accepts a cookie policy."),(0,i.kt)("p",null,"Anonymous tracking can be toggled on and off. The methods to control this behaviour are described ",(0,i.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/browser-tracker/browser-tracker-v3-reference/tracker-setup/additional-options/"},"here"),"."),(0,i.kt)("h5",{id:"anonymous-session-tracking"},"Anonymous Session Tracking"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"anonymousTracking: { withSessionTracking: true }")),(0,i.kt)("p",null,"This mode will continue to track session information in the client side but will track no user identifiers. To achieve this, the tracker will use Cookies or Local Storage. For session tracking, ",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy")," must be either ",(0,i.kt)("inlineCode",{parentName:"p"},"cookieAndLocalStorage")," (default), ",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"cookie"),". If this feature is enabled and the storage strategy is not appropriate, then full anonymous tracking will occur."),(0,i.kt)("p",null,"The Snowplow JavaScript Tracker performs sessionization client side. This allows anonymous session tracking to be done using client side storage without sending any user identifier fields to the collector."),(0,i.kt)("h4",{id:"setting-the-page-unload-pause"},"Setting the page unload pause"),(0,i.kt)("p",null,"Whenever the Snowplow Javascript Tracker fires an event, it automatically starts a 500 millisecond timer running. If the user clicks on a link or refreshes the page during this period (or, more likely, if the event was triggered by the user clicking a link), the page will wait until either the event is sent or the timer is finished before unloading. 500 milliseconds is usually enough to ensure the event has time to be sent."),(0,i.kt)("p",null,"You can change the pause length (in milliseconds) using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"pageUnloadTimer"),"\xa0of the configuration object. The above example completely eliminates the pause. This does make it unlikely that events triggered by link clicks will be sent."),(0,i.kt)("p",null,"See also\xa0",(0,i.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/cookies-local-storage/#Local_Storage"},"How the Tracker uses\xa0",(0,i.kt)("inlineCode",{parentName:"a"},"localStorage")),"\xa0for an explanation of how the tracker can later recover and send unsent events."),(0,i.kt)("h4",{id:"setting-the-event-request-protocol"},"Setting the event request protocol"),(0,i.kt)("p",null,"Normally the protocol (http or https) used by the Tracker to send events to a collector is the same as the protocol of the current page. You can force it to use https by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"forceSecureTracker"),"\xa0field of the configuration object to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,i.kt)("h4",{id:"setting-an-unsecure-event-request-protocol"},"Setting an unsecure event request protocol"),(0,i.kt)("p",null,"Normally the protocol (http or https) used by the Tracker to send events to a collector is the same as the protocol of the current page. You can force it to use http by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"forceUnsecureTracker"),"\xa0field of the configuration object to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". If\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"forceSecureTracker"),"\xa0is activated this argument is ignored."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE"),": This argument should only be used for testing purposes as it creates security vulnerabilities."),(0,i.kt)("h4",{id:"configuring-the-session-cookie-duration"},"Configuring the session cookie duration"),(0,i.kt)("p",null,"Whenever an event fires, the Tracker creates a session cookie. If the cookie didn\u2019t previously exist, the Tracker interprets this as the start of a new session."),(0,i.kt)("p",null,"By default the session cookie expires after 30 minutes. This means that a user leaving the site and returning in under 30 minutes does not change the session. You can override this default by setting\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sessionCookieTimeout"),"\xa0to a duration (in seconds) in the configuration object. For example,"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"{\n  ...\n  sessionCookieTimeout: 3600\n  ...\n}\n")),(0,i.kt)("p",null,"would set the session cookie lifespan to an hour."),(0,i.kt)("h4",{id:"configuring-the-storage-strategy"},"Configuring the storage strategy"),(0,i.kt)("p",null,"Three strategies are made available to store the Tracker\u2019s state: cookies, local storage or no storage at all. You can set the strategy with the help of the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"stateStorageStrategy"),"\xa0parameter in the configuration object to \u201ccookieAndLocalStorage\u201d (the default), \u201ccookie\u201d, \u201clocalStorage\u201d or \u201cnone\u201d respectively."),(0,i.kt)("p",null,"When choosing local storage, the Tracker will additionally store events in local storage before sending them so that they can be recovered if the user leaves the page before they are sent."),(0,i.kt)("h4",{id:"adding-predefined-contexts"},"Adding predefined contexts"),(0,i.kt)("p",null,"The JavaScript Tracker comes with many predefined contexts which you can automatically add to every event you send. To enable them, simply add them to the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"contexts"),"\xa0field of the configuration object as above."),(0,i.kt)("h5",{id:"webpage-context"},"webPage context"),(0,i.kt)("p",null,"When the JavaScript Tracker loads on a page, it generates a new page view UUID. If the webPage context is enabled, then a context containing this UUID is attached to every page view."),(0,i.kt)("h5",{id:"performancetiming-context"},"performanceTiming context"),(0,i.kt)("p",null,"If this context is enabled, the JavaScript Tracker will use the create a context JSON from the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window.performance.timing"),"\xa0object, along with the Chrome\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"firstPaintTime"),"\xa0field (renamed to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},'"chromeFirstPaint"'),") if it exists. This data can be used to calculate page performance metrics."),(0,i.kt)("p",null,"Note that if you fire a page view event as soon as the page loads, the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"domComplete"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"loadEventStart"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"loadEventEnd"),", and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"chromeFirstPaint"),"\xa0metrics in the Navigation Timing API may be set to zero. This is because those properties are only known once all scripts on the page have finished executing. See the\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/3-Advanced-usage-of-the-JavaScript-tracker#timing"},"Advanced Usage"),"\xa0page for more information on circumventing this limitation. Additionally the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"redirectStart"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"redirectEnd"),", and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"secureConnectionStart"),"\xa0are set to 0 if there is no redirect or a secure connection is not requested."),(0,i.kt)("p",null,"For more information on the Navigation Timing API, see\xa0",(0,i.kt)("a",{parentName:"p",href:"http://www.w3.org/TR/2012/REC-navigation-timing-20121217/#sec-window.performance-attribute"},"the specification"),"."),(0,i.kt)("h5",{id:"gacookies-context"},"gaCookies context"),(0,i.kt)("p",null,"If this context is enabled, the JavaScript Tracker will look for Google Analytics cookies (specifically the \u201c","_","_","utma\u201d, \u201c","_","_","utmb\u201d, \u201c","_","_","utmc\u201d, \u201c","_","_","utmv\u201d, \u201c","_","_","utmz\u201d, and \u201c","_","ga\u201d cookies) and combine their values into a JSON which gets sent with every event."),(0,i.kt)("h5",{id:"clienthints-context-2150"},"clientHints context (2.15.0+)"),(0,i.kt)("p",null,"If this context is enabled, the JavaScript Tracker will capture the Client Hints data made available in the browser. See ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-CH#Browser_compatibility"},"here")," for browser support."),(0,i.kt)("p",null,"This is useful data to capture as browsers are moving away from high entropy User Agent strings. Client Hints offer useful information to understand browser usage without the potential to infringe on a users privacy as is often the case with the User Agent string."),(0,i.kt)("p",null,"This context be enabled in two ways:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"clientHints: true"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'This will capture the "basic" client hints'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"clientHints: { includeHighEntropy: true }"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'This will capture the "basic" client hints as well as hints that are deemed "High Entropy" and could be used to fingerprint users. Browsers may choose to prompt the user before making this data available.')))),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file ",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/org.ietf/http_client_hints/jsonschema/1-0-0"},"org.ietf/http","_","client","_","hints/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"geolocation-context"},"geolocation context"),(0,i.kt)("p",null,"If this context is enabled, the JavaScript Tracker will attempt to create a context from the visitor\u2019s geolocation information. If the visitor has not already given or denied the website permission to use their geolocation information, a prompt will appear. If they give permission, then all events from that moment on will include their geolocation information."),(0,i.kt)("p",null,"For more information on the geolocation API, see\xa0",(0,i.kt)("a",{parentName:"p",href:"http://dev.w3.org/geo/api/spec-source.html"},"the specification"),"."),(0,i.kt)("h5",{id:"optimizelyexperiments-context"},"optimizelyExperiments context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.experiments"),"\xa0object to create an array of context JSONs; one for each sub-object."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/experiment/jsonschema/1-0-0"},"com.optimizely/experiment/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelystates-context"},"optimizelyStates context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.state"),"\xa0object to create an array of context JSONs; one for each sub-object."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/state/jsonschema/1-0-0"},"com.optimizely/state/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelyvariations-context"},"optimizelyVariations context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.variations"),"\xa0object to create an array of context JSONs; one for each sub-object."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/variation/jsonschema/1-0-0"},"com.optimizely/variation/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelyvisitor-context"},"optimizelyVisitor context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.visitor"),"\xa0object to create a context JSON."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/visitor/jsonschema/1-0-0"},"com.optimizely/visitor/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelyaudiences-context"},"optimizelyAudiences context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.visitor.audiences"),"\xa0object to create an array of context JSONs; one for each sub-object."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/visitor_audience/jsonschema/1-0-0"},"com.optimizely/visitor","_","audience/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelydimensions-context"},"optimizelyDimensions context"),(0,i.kt)("p",null,"If this context is enabled the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['optimizely'].data.visitor.dimensions"),"\xa0object to create an array of context JSONs; one for each sub-object."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely/visitor_dimension/jsonschema/1-0-0"},"com.optimizely/visitor","_","dimension/jsonschema/1-0-0"),"."),(0,i.kt)("h5",{id:"optimizelysummary-context"},"optimizelySummary context"),(0,i.kt)("p",null,"Unlike previously mentioned Optimizely contexts this context doesn\u2019t attach existing in browser object, but constructs its own using only data necessary to join with\xa0",(0,i.kt)("a",{parentName:"p",href:"https://developers.optimizely.com/classic/events/export/index.html"},"exported Optimizely"),"\xa0data."),(0,i.kt)("p",null,"To see what will be captured please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.optimizely.snowplow/optimizely_summary/jsonschema/1-0-0"},"com.optimizely.snowplow/optimizely","_","summary/jsonschema/1-0-0"),"."),(0,i.kt)("p",null,"We highly recommend to use this context instead of previous ones because it is has much smaller footprint and contains all necessary data."),(0,i.kt)("h5",{id:"optimizelyxsummary-context"},"optimizelyXSummary context"),(0,i.kt)("p",null,"Support for OptimizelyX has been introduced in the tracker, you can have a look at the JsonSchema in\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.optimizely.optimizelyx/summary/jsonschema/1-0-0"},"com.optimizely.optimizelyx/summary/jsonschema/1-0-0"),"\xa0to see what is being captured."),(0,i.kt)("p",null,"If you\u2019re planning on leveraging the context\u2019s variation names, you\u2019ll have to untick \u2018Mask descriptive names in project code and third-party integrations\u2019 in the OptimizelyX menu -> Settings -> Privacy. Otherwise, all variation names will be\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"null"),"."),(0,i.kt)("h5",{id:"parrable-context"},"parrable context"),(0,i.kt)("p",null,"If this context is enabled, the JavaScript Tracker will use the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"window['_hawk']"),"\xa0object to create a\xa0",(0,i.kt)("a",{parentName:"p",href:"https://www.parrable.com/"},"Parrable"),"\xa0context JSON."),(0,i.kt)("p",null,"To see what will captured, please see the JsonSchema file\xa0",(0,i.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/snowplow/iglu-central/master/schemas/com.parrable/encrypted_payload/jsonschema/1-0-0"},"com.parrable/encrypted","_","payload/jsonschema/1-0-0"),"."),(0,i.kt)("h4",{id:"post-support"},"POST support"),(0,i.kt)("p",null,"If you set the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"eventMethod"),"\xa0field of the configuration object to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"post"),", the tracker will send events using POST requests rather than GET requests. In browsers such as Internet Explorer 9 which do not support cross-origin XMLHttpRequests, the tracker will fall back to using GET."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"eventMethod"),"\xa0defaults to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"post"),", other options available are\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"get"),"\xa0for GET requests and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"beacon"),"\xa0for using the Beacon API (note: Using Beacon will store a Session Cookie in the users browser for reliability reasons described below)."),(0,i.kt)("p",null,"The main advantage of POST requests is that they circumvent Internet Explorer\u2019s maximum URL length of 2083 characters by storing the event data in the body of the request rather than the querystring."),(0,i.kt)("p",null,"You can also batch events sent by POST by setting a numeric\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"bufferSize"),"\xa0field in the configuration object. This is the number of events to buffer before sending them all in a single POST. If the user navigates away from the page while the buffer is only partially full, the tracker will attempt to send all stored events immediately, but this often doesn\u2019t happen before the page unloads. Normally the tracker will store unsent events in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage"),", meaning that unsent events will be resent when the user next visits a page on the same domain. The\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"bufferSize"),"\xa0defaults to 1, meaning events are sent as soon as they are created."),(0,i.kt)("p",null,"If you have set\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"bufferSize"),"\xa0to greater than 1, you can flush the buffer using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"flushBuffer"),"\xa0method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('flushBuffer');\n")),(0,i.kt)("p",null,"For instance, if you wish to send several events at once, you might make the API calls to create the events and store them and then and call\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"flushBuffer"),"\xa0afterwards to ensure they are all sent before the user leaves the page."),(0,i.kt)("p",null,"Note that if\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage"),"\xa0is inaccessible or you are not using it to store data, the buffer size will always be 1 to prevent losing events when the user leaves the page."),(0,i.kt)("h5",{id:"beacon-api-support"},"Beacon API support"),(0,i.kt)("p",null,"The Beacon interface is used to schedule asynchronous and non-blocking requests to a web server. This will allow events to be sent even after a webpage is closed. This browser interface can be used to send events by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"eventMethod"),"\xa0field in the configuration object to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"beacon"),"."),(0,i.kt)("p",null,"Using Beacon will store a Session Cookie in the users browser for reliability reasons, and will always send the first request as a standard POST. This prevents data loss in a number of older browsers with broken Beacon implementations."),(0,i.kt)("p",null,"Note: the Beacon API makes POST requests."),(0,i.kt)("p",null,"More information and documentation about the Beacon API can be found\xa0",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API"},"here"),"."),(0,i.kt)("h5",{id:"post-path"},"POST path"),(0,i.kt)("p",null,"The POST path that is used to send POST requests to a collector can be change with the configuration object value\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"postPath"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"postPath"),"\xa0defaults to the standard path:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/com.snowplowanalytics.snowplow/tp2")),(0,i.kt)("p",null,"Note: changing\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"postPath"),"\xa0is non-standard behavior that does not conform to the default collector protocol. The collector configuration must be updated to support this path."),(0,i.kt)("p",null,"Care must be taken to ensure that requests are supported by your collector configuration or redirected to the collector at the correct endpoint (normally this is\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/com.snowplowanalytics.snowplow/tp2"),")."),(0,i.kt)("h4",{id:"configuring-cross-domain-tracking"},"Configuring cross-domain tracking"),(0,i.kt)("p",null,"The JavaScript Tracker can add an additional parameter named \u201c","_","sp\u201d to the querystring of outbound links. Its value includes the domain user ID for the current page and the time at which the link was clicked. This makes these values visible in the \u201curl\u201d field of events sent by an instance of the JavaScript Tracker on the destination page. The enrichment process will use these values to populate the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"refr_domain_userid"),"\xa0and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"refr_dvce_tstamp"),"\xa0fields in Redshift for all events fired on the destination page."),(0,i.kt)("p",null,"You can configure which links get decorated this way using the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"crossDomainLinker"),"\xa0field of the configuration object. This field should be a function taking one argument (the link element) and return\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"true"),"\xa0if the link element should be decorated and false otherwise. For example, this function would only decorate those links whose destination is \u201c",(0,i.kt)("a",{parentName:"p",href:"http://acme.de/"},"http://acme.de"),"\u201d or whose HTML id is \u201ccrossDomainLink\u201d:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"{\n  crossDomainLinker: function (linkElement) {\n    return (linkElement.href === 'http://acme.de' || linkElement.id === 'crossDomainLink');\n  }\n}\n")),(0,i.kt)("p",null,"If you want to decorate every link to the domain github.com:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"{\n  crossDomainLinker: function (linkElement) {\n    return /^https:\\/\\/github\\.com/.test(linkElement.href);\n  }\n}\n")),(0,i.kt)("p",null,"If you want to decorate every link, regardless of its destination:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"{\n  crossDomainLinker: function (linkElement) {\n    return true;\n  }\n}\n")),(0,i.kt)("p",null,"Note that the above will decorate \u201clinks\u201d which are actually just JavaScript actions (with an\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"href"),"\xa0of\xa0",(0,i.kt)("inlineCode",{parentName:"p"},'"javascript:void(0)"'),"). To exclude these links:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('crossDomainLinker', function(linkElement) {\n  return linkElement.href.indexOf('javascript:') < 0;\n});\n")),(0,i.kt)("p",null,"Note that when the tracker loads, it does not immediately decorate links. Instead it adds event listeners to links which decorate them as soon as a user clicks on them or navigates to them using the keyboard. This ensures that the timestamp added to the querystring is fresh."),(0,i.kt)("p",null,"If further links get added to the page after the tracker has loaded, you can use the tracker\u2019s\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"crossDomainLinker"),"\xa0method to add listeners again. (Listeners won\u2019t be added to links which already have them.)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('crossDomainLinker', function (linkElement) {\n  return (linkElement.href === 'http://acme.de' || linkElement.id === 'crossDomainLink');\n});\n")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Warning"),": If you enable link decoration, you should also make sure that at least one event is fired on the page. Firing an event causes the tracker to write the domain","_","userid to a cookie. If the cookie doesn\u2019t exist when the user leaves the page, the tracker will generate a new ID for them when they return rather than keeping the old ID."),(0,i.kt)("h4",{id:"configuring-the-maximum-payload-size-in-bytes"},"Configuring the maximum payload size in bytes"),(0,i.kt)("p",null,"Because the Clojure Collector and the Scala Stream Collector both have a maximum request size, the Tracker limits POST requests to 40000 bytes. If the combined size of the events in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localStorage"),"\xa0is greater than this limit, they will be split into multiple POST requests. You can override this default using a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"maxPostBytes"),"\xa0in the configuration object."),(0,i.kt)("p",null,"The Clojure Collector can\u2019t handle requests bigger than 64kB. The Scala Stream Collector cannot process requests bigger than 1MB because that is the maximum size of a Kinesis record."),(0,i.kt)("h4",{id:"automatically-discover-and-set-the-root-domain"},"Automatically discover and set the root domain"),(0,i.kt)("p",null,"If the optional\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"discoverRootDomain"),"\xa0field of the configuration object is set to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", the Tracker automatically discovers and sets the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"configCookieDomain"),"\xa0value to the root domain."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE"),": If you have been setting this manually please note that the automatic detection does not prepend a \u2018.\u2019 to the domain. For example a root domain of \u201c.mydomain.com\u201d would become \u201cmydomain.com\u201d. This is because the library we use for setting cookies doesn\u2019t care about the difference."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"This will then result in a different domain hash, so we recommend that if you have been setting this manually with a leading \u2018.\u2019 to continue to do so manually.")),(0,i.kt)("h4",{id:"configuring-the-cookies-lifetime"},"Configuring the cookies lifetime"),(0,i.kt)("p",null,"Whenever tracker initialized on your domain \u2013 it will set domain-specific visitor\u2019s cookies. By default, these cookies will be active for 2 years. You can change this duration using\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cookieLifetime"),"\xa0configuration object parameter or\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"setVisitorCookieTimeout"),"\xa0method."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('newTracker', 'cf', '{{COLLECTOR_URL}}', {\n  cookieLifetime: 86400 * 31,\n});\n")),(0,i.kt)("p",null,"or"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('setVisitorCookieTimeout', 86400 * 30);  // 30 days\n")),(0,i.kt)("p",null,"If\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cookieLifetime"),"\xa0is set to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"0"),", the cookie will expire at the end of the session (when the browser closes). If set to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"-1"),", the first-party cookies will be disabled."),(0,i.kt)("h4",{id:"tracking-prerendered-pages"},"Tracking prerendered pages"),(0,i.kt)("p",null,"Some browsers can \u201cpreload\u201d pages while user typing URL in. These users not always end up in that page, however due page preloading tracker is initialized and loaded."),(0,i.kt)("p",null,"JS Tracker by default doesn\u2019t fire events when page is preloaded, but sets callback on\xa0",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Events/visibilitychange"},"visibilitychange"),"\xa0event, which fires actual event only when page starts to render."),(0,i.kt)("p",null,"To explicitly enable tracking for prerendered pages you can use\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"setCountPreRendered"),"\xa0function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow('setCountPreRendered', true);\n")),(0,i.kt)("h4",{id:"limiting-local-storage-queue-size"},"Limiting Local Storage queue size"),(0,i.kt)("p",null,"Because most browsers limit Local Storage to around 5mb per site, you may want to limit the number of events the tracker will queue in local storage if they fail to send. The default is a max queue size of 1000, but you may wish to reduce this if your web application also makes use local storage. To do so, you should set the optional\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"maxLocalStorageQueueSize"),"\xa0field of the configuration object is set to your desired value (e.g. 500)."),(0,i.kt)("h4",{id:"reset-page-ping-on-page-view"},"Reset Page Ping on Page View"),(0,i.kt)("p",null,"By default the tracker will reset the Page Ping timers, which were configured when\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"enableActivityTracking"),"\xa0is called, as well as reset the attached Page View contexts on all future Page Pings when a new\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"trackPageView"),"\xa0event occurs. This is enabled by default as of 2.13.0 and is particularly useful for Single Page Applications (SPA), if you previously relied on this behaviour, you can disable this functionality by specifying\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"resetActivityTrackingOnPageView: false"),"\xa0in the configuration object on tracker initialisation."),(0,i.kt)("h4",{id:"skip-tracking-browser-features-2150"},"Skip tracking browser features (2.15.0+)"),(0,i.kt)("p",null,"By default the tracker will capture a number of browser features that are available. If you don't require these to be captured and would like to reduce the size of the event payload, you can choose to skip them."),(0,i.kt)("p",null,"When initialising the tracker, you can specify an array of features to skip."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"skippedBrowserFeatures: ['realp', 'java', 'gears', 'ag']")),(0,i.kt)("p",null,"Full list of features:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"res")," - Screen Resolution"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cd")," - Screen Colour Depth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cookie")," - Cookie support (if cookies enabled in tracker initialization)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pdf")," - PDF MimeType Support (application/pdf)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"qt")," - Quicktime Video MimeType Support (video/quicktime)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"realp")," - RealAudio MimeType Support (audio/x-pn-realaudio-plugin)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"wma")," - WMA MimeType Support (application/x-mplayer2)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"dir")," - Director MimeType Support (application/x-director)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fla")," - Flash MimeType Support (application/x-shockwave-flash)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"java")," - Java MimeType Support (application/x-java-vm)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"gears")," - Google Gears MimeType Support (application/x-googlegears)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ag")," - Silverlight MimeType Support (application/x-silverlight)")),(0,i.kt)("h4",{id:"set-connection-timeout-2150"},"Set connection timeout (2.15.0+)"),(0,i.kt)("p",null,"When events are sent using POST or GET, they are given 5 seconds to complete by default. GET requests having a timeout is only available in 2.15.0."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"_connectionTimeout_: 5000")),(0,i.kt)("p",null,"This value is configurable when initialising the tracker and is specified in milliseconds. The value specified here will effect both POST and GET requests."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Warning:")," Setting this value too low may prevent events from successfully sending to your collector or the tracker may retry to send events that have already arrived at the collector, as the tracker will assume the request failed on timeout, leading to duplicate events in the warehouse. ",(0,i.kt)("strong",{parentName:"p"},"We recommend 5000 milliseconds as the minimum value and 10000 as the maximum value.")))}s.isMDXComponent=!0;const l={title:"Initialization options",date:"2020-03-03",sidebar_position:10},c=void 0,p={unversionedId:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/index",id:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/index",title:"Initialization options",description:"This page refers to version 2.14.0+ of the Snowplow JavaScript Tracker.",source:"@site/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2",slug:"/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/initializing-a-tracker-2/index.md",tags:[],version:"current",lastUpdatedAt:1661424728,formattedLastUpdatedAt:"Aug 25, 2022",sidebarPosition:10,frontMatter:{title:"Initialization options",date:"2020-03-03",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Loading tracker with the Snowplow tag",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/loading/"},next:{title:"Additional options",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracker-setup/other-parameters-2/"}},u={},m=[],h={toc:m};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"This page refers to version 2.14.0+ of the Snowplow JavaScript Tracker.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v1"},"here"),"\xa0for the corresponding documentation for version 1.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.0"},"here"),"\xa0for the corresponding documentation for version 2.1.1.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.2"},"here"),"\xa0for the corresponding documentation for version 2.2.2.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.3"},"here"),"\xa0for the corresponding documentation for version 2.3.0.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.4"},"here"),"\xa0for the corresponding documentation for version 2.4.3.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.5"},"here"),"\xa0for the corresponding documentation for version 2.5.3.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.6"},"here"),"\xa0for the corresponding documentation for version 2.6.2.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.7"},"here"),"\xa0for the corresponding documentation for version 2.7.2.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.8"},"here"),"\xa0for the corresponding documentation for version 2.8.2.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.9"},"here"),"\xa0for the corresponding documentation for version 2.9.0.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.10"},"here"),"\xa0for the corresponding documentation for version 2.10.0.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.11"},"here"),"\xa0for the corresponding documentation for version 2.11.0.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.12"},"here"),"\xa0for the corresponding documentation for version 2.12.0.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Click\xa0",(0,i.kt)("a",{parentName:"em",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker-v2.13"},"here"),"\xa0for the corresponding documentation for version 2.13.0.")),(0,i.kt)(a.ZP,{mdxType:"Block3067"}),(0,i.kt)("p",null,"Documentation for latest release"),(0,i.kt)("p",null,"The documentation listed here is for Version 2 of the JavaScript Tracker. Version 3 is now available and upgrading is recommended."),(0,i.kt)("p",null,"-"," ",(0,i.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/"},"Documentation for Version 3")),(0,i.kt)("p",null,"-"," ",(0,i.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/v2-to-v3-migration-guide/"},"v2 to v3 Migration Guide")),(0,i.kt)(s,{mdxType:"Block1512"}))}d.isMDXComponent=!0},13963:(e,t,n)=>{n.d(t,{ZP:()=>r});var o=n(87462),i=(n(67294),n(3905));const a={toc:[]};function r(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},a,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow-javascript-tracker/releases"},(0,i.kt)("img",{parentName:"a",src:"https://img.shields.io/github/v/release/snowplow/sp-js-assets?sort=semver&style=flat",alt:null}))))}r.isMDXComponent=!0}}]);