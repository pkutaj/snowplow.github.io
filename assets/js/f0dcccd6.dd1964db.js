"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[39427],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=i,k=p["".concat(s,".").concat(m)]||p[m]||u[m]||r;return n?a.createElement(k,o(o({ref:t},d),{},{components:n})):a.createElement(k,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},88514:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(87462),i=(n(67294),n(3905));const r={title:"Android (0.8.0)",date:"2020-03-05",sidebar_position:930},o=void 0,l={unversionedId:"collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/index",id:"collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/index",title:"Android (0.8.0)",description:"The Android tracker can be used to send events from Android apps and games.",source:"@site/docs/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0",slug:"/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-8-0/index.md",tags:[],version:"current",lastUpdatedAt:1661254422,formattedLastUpdatedAt:"Aug 23, 2022",sidebarPosition:930,frontMatter:{title:"Android (0.8.0)",date:"2020-03-05",sidebar_position:930},sidebar:"tutorialSidebar",previous:{title:"Android (1.0.0)",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-1-0-0/"},next:{title:"Android (0.7.0)",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/previous-versions/android-tracker/android-0-7-0/"}},s={},c=[{value:"Installation",id:"installation",level:2},{value:"Gradle",id:"gradle",level:3},{value:"Demo apps",id:"demo-apps",level:3},{value:"Quick start guide",id:"quick-start-guide",level:2},{value:"Permissions",id:"permissions",level:3},{value:"Send events",id:"send-events",level:3},{value:"Tracker structure",id:"tracker-structure",level:2},{value:"Emitter",id:"emitter",level:3},{value:"Tracker",id:"tracker",level:3},{value:"Payload",id:"payload",level:3},{value:"SelfDescribingJson",id:"selfdescribingjson",level:3},{value:"Subject",id:"subject",level:3},{value:"Event",id:"event",level:3},{value:"Screenview events",id:"screenview-events",level:4},{value:"RequestCallback",id:"requestcallback",level:3},{value:"Tracking basic methods",id:"tracking-basic-methods",level:2},{value:"Creating an emitter",id:"creating-an-emitter",level:3},{value:"Creating a tracker",id:"creating-a-tracker",level:3},{value:"Sending events",id:"sending-events",level:3},{value:"Attaching contexts to events",id:"attaching-contexts-to-events",level:3},{value:"More advanced methods",id:"more-advanced-methods",level:2},{value:"Tracking features",id:"tracking-features",level:3},{value:"Event types",id:"event-types",level:4},{value:"ScreenView tracking",id:"screenview-tracking",level:5},{value:"PageView event",id:"pageview-event",level:5},{value:"EcommerceTransaction event",id:"ecommercetransaction-event",level:5},{value:"Structured event",id:"structured-event",level:5},{value:"Self-describing event",id:"self-describing-event",level:5},{value:"Timing event",id:"timing-event",level:5},{value:"ConsentGranted event",id:"consentgranted-event",level:5},{value:"ConsentWithdrawn event",id:"consentwithdrawn-event",level:5},{value:"Consent documents",id:"consent-documents",level:5},{value:"Session tracking",id:"session-tracking",level:4},{value:"Foreground and background events",id:"foreground-and-background-events",level:5},{value:"Install tracking",id:"install-tracking",level:5},{value:"Crash tracking",id:"crash-tracking",level:5},{value:"Standard contexts",id:"standard-contexts",level:4},{value:"Session context",id:"session-context",level:5},{value:"Mobile context",id:"mobile-context",level:5},{value:"Geolocation context",id:"geolocation-context",level:5},{value:"Application context",id:"application-context",level:5},{value:"Screen Context",id:"screen-context",level:5},{value:"GDPR Context",id:"gdpr-context",level:5},{value:"Tracker&#39;s diagnostic",id:"trackers-diagnostic",level:3},{value:"Emitter options",id:"emitter-options",level:3},{value:"Setting the request method",id:"setting-the-request-method",level:4},{value:"Setting the emit timeout",id:"setting-the-emit-timeout",level:4},{value:"Configure the buffer",id:"configure-the-buffer",level:4},{value:"Setting the protocol",id:"setting-the-protocol",level:4},{value:"Setting the TLS version",id:"setting-the-tls-version",level:4},{value:"Setting a callback",id:"setting-a-callback",level:4},{value:"Send limit",id:"send-limit",level:4},{value:"GET byte limit",id:"get-byte-limit",level:4},{value:"POST byte limit",id:"post-byte-limit",level:4},{value:"Global Contexts",id:"global-contexts",level:3},{value:"Context primitives",id:"context-primitives",level:4},{value:"Self-describing JSON",id:"self-describing-json",level:5},{value:"Context Generator",id:"context-generator",level:5},{value:"Conditional Context Providers",id:"conditional-context-providers",level:4},{value:"Filter Provider",id:"filter-provider",level:5},{value:"Ruleset Provider",id:"ruleset-provider",level:5},{value:"Ruleset format",id:"ruleset-format",level:6},{value:"API Reference",id:"api-reference",level:2}],d={toc:c};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Android tracker can be used to send events from Android apps and games."),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("p",null,"Add the following snippet to a file (e.g.\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SnowplowTracker.java"),"):"),(0,i.kt)("p",null,"In order to add the tracker to your project, you must add it as a dependency."),(0,i.kt)("h3",{id:"gradle"},"Gradle"),(0,i.kt)("p",null,"If you use Gradle, here\u2019s how to add the tracker to your project."),(0,i.kt)("p",null,"Add into your ",(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"dependencies {\n    ...\n    // Snowplow Android Tracker\n    compile 'com.snowplowanalytics:snowplow-android-tracker:0.8.0@aar'\n}\n")),(0,i.kt)("p",null,"This will install version 0.8.0 of the Android tracker. If you would like to ensure that all bug fixes and patches for version 0.8.0 are installed, simply change 0.8.0 into 0.8.+."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"dependencies {\n    ...\n    // Snowplow Android Tracker\n    compile 'com.snowplowanalytics:snowplow-android-tracker:0.8.+@aar'\n}\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note"),": no breaking changes will occur in the \u20180.8.x\u2019 space."),(0,i.kt)("h3",{id:"demo-apps"},"Demo apps"),(0,i.kt)("p",null,"With the tracker we\u2019ve included a demo app that shows an example of how to integrate the tracker."),(0,i.kt)("p",null,"For general testing,\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow-mini"},"Snowplow Mini"),"\xa0can be used as an easily deployable collector with a live web interface for viewing received events."),(0,i.kt)("p",null,"The app can be run in the Android Studio emulator or on an actual device."),(0,i.kt)("p",null,"Simply enter the endpoint of the collector in the app\u2019s interface once it\u2019s launched and press\xa0",(0,i.kt)("inlineCode",{parentName:"p"},'"send\xa0events"'),"!"),(0,i.kt)("h2",{id:"quick-start-guide"},"Quick start guide"),(0,i.kt)("p",null,"Add the following snippet to a file (e.g.\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SnowplowTracker.java"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'import com.snowplowanalytics.snowplow.tracker.*;\nimport android.content.Context;\n\npublic class SnowplowTrackerBuilder {\n\n    public static Tracker getTracker(Context context) {\n        Emitter emitter = getEmitter(context);\n        Subject subject = getSubject(context); // Optional\n\n        return Tracker.init(new Tracker.TrackerBuilder(emitter, "your-namespace", "your-appid", context)\n            .subject(subject) // Optional\n            .build()\n        )\n    }\n\n    private static Emitter getEmitter(Context context) {\n        return new Emitter.EmitterBuilder("notarealuri.fake.io", context)\n            .build();\n    }\n\n    private static Subject getSubject(Context context) {\n        return new Subject.SubjectBuilder()\n            .context(context)\n            .build();\n    }\n}\n')),(0,i.kt)("h3",{id:"permissions"},"Permissions"),(0,i.kt)("p",null,"To send the events, you need to update your AndroidManifest.xml with the following permission:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'<uses-permission android:name="android.permission.INTERNET" /> \n<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>\n')),(0,i.kt)("p",null,"If you want to send location information with each event you will need to add the following permissions to your AndroidManifest.xml:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />\n')),(0,i.kt)("h3",{id:"send-events"},"Send events"),(0,i.kt)("p",null,"Now you can try to track events:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Tracker tracker = SnowplowTrackerBuilder.getTracker(activity, context);\ntracker.track(ScreenView.builder().name("screenName").id("screenId").build());\n')),(0,i.kt)("h2",{id:"tracker-structure"},"Tracker structure"),(0,i.kt)("p",null,"Here we\u2019ll explain the purpose of the classes provided in the tracker."),(0,i.kt)("h3",{id:"emitter"},"Emitter"),(0,i.kt)("p",null,"Responsible for all the storage, networking and scheduling required to ensure events are sent to a collector."),(0,i.kt)("p",null,"Details like the collector endpoint and sending timeout lengths are set here."),(0,i.kt)("h3",{id:"tracker"},"Tracker"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Tracker"),"\xa0is the class where you can find the methods available for tracking events. This is also where all parts of the tracker are brought together, i.e. within\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Tracker"),"\xa0you must set the associated emitter, subject, etc."),(0,i.kt)("h3",{id:"payload"},"Payload"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Payload"),"\xa0is simply a key-value store used for constructing events."),(0,i.kt)("h3",{id:"selfdescribingjson"},"SelfDescribingJson"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),"\xa0is the class used for making self-describing JSONs (SDJs)."),(0,i.kt)("p",null,"An SDJ has a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"schema"),"\xa0field that holds a URI (string) that identifies the structure of the data nested in the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"data"),"\xa0field."),(0,i.kt)("p",null,"All events sent to the collector are self-describing JSONs."),(0,i.kt)("p",null,"When sending your own custom events, you will want to create a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),"\xa0object given two arguments: the schema, and a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Map<String,\xa0String>"),"\xa0or\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Map<String,\xa0Object>"),"\xa0that holds the data you\u2019d like to track."),(0,i.kt)("h3",{id:"subject"},"Subject"),(0,i.kt)("p",null,"A \u201csubject\u201d represents an individual user that is being tracked. It is used to track data that persists with a user like timezone, user ID, platform, etc."),(0,i.kt)("h3",{id:"event"},"Event"),(0,i.kt)("p",null,"This is where all events are found, the available classes are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"PageView"),(0,i.kt)("li",{parentName:"ul"},"Structured"),(0,i.kt)("li",{parentName:"ul"},"Unstructured"),(0,i.kt)("li",{parentName:"ul"},"ScreenView"),(0,i.kt)("li",{parentName:"ul"},"ConsentWithdrawn"),(0,i.kt)("li",{parentName:"ul"},"ConsentGranted"),(0,i.kt)("li",{parentName:"ul"},"ConsentDocument"),(0,i.kt)("li",{parentName:"ul"},"Timing"),(0,i.kt)("li",{parentName:"ul"},"EcommTransaction"),(0,i.kt)("li",{parentName:"ul"},"EcommTransactionItem"),(0,i.kt)("li",{parentName:"ul"},"NotificationContent"),(0,i.kt)("li",{parentName:"ul"},"PushNotification")),(0,i.kt)("p",null,"Events are sent by providing them as arguments to the tracking methods found in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Tracker"),"."),(0,i.kt)("h4",{id:"screenview-events"},"Screenview events"),(0,i.kt)("p",null,"A screenview event can be manually tracked like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'tracker.track(ScreenView.builder()\n    .name("Product list")\n    .id("some Id")\n    .type("ListView")\n    .previousName("User grid")\n    .previousId("another Id")\n    .previousType("GridView")\n    .transitionType("swipe")\n    .build());\n')),(0,i.kt)("h3",{id:"requestcallback"},"RequestCallback"),(0,i.kt)("p",null,"This is a class that defines callbacks that are called when an emitter either fails or succeeds to send requests."),(0,i.kt)("h2",{id:"tracking-basic-methods"},"Tracking basic methods"),(0,i.kt)("h3",{id:"creating-an-emitter"},"Creating an emitter"),(0,i.kt)("p",null,"Every tracker must have an emitter in order to send events."),(0,i.kt)("p",null,"Note: the URL endpoint is the only required parameter."),(0,i.kt)("p",null,"Here\u2019s an example that creates an emitter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .method(HttpMethod.GET) // Optional - Defines how we send the request\n        .option(BufferOption.Single) // Optional - Defines how many events we bundle in a POST\n        .security(RequestSecurity.HTTPS) // Optional - Defines what protocol used to send events\n        .tls(TLSVersion.TLSv1_2) // Optional - Defines what TLS versions are used for the request\n        .callback(new EmitterCallback() {...})\n        .build();\n')),(0,i.kt)("h3",{id:"creating-a-tracker"},"Creating a tracker"),(0,i.kt)("p",null,"To instantiate a tracker in your code simply instantiate the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Tracker"),"\xa0class with the following builder pattern:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'// Create a Tracker with all options\nTracker.init(new Tracker\n  .TrackerBuilder(e2, "myNamespace", "myAppId", getContext())\n  .base64(false) // Optional - defines if we use base64 encoding\n  .platform(DevicePlatforms.Mobile) // Optional - defines what platform the event will report to be on\n  .subject(new Subject.SubjectBuilder().build()) // Optional - a subject which contains values appended to every event\n  .build()\n);\n')),(0,i.kt)("h3",{id:"sending-events"},"Sending events"),(0,i.kt)("p",null,"The following methods are available for sending events from the tracker:"),(0,i.kt)("h3",{id:"attaching-contexts-to-events"},"Attaching contexts to events"),(0,i.kt)("p",null,"Contexts augment events with additional information. The tracker has standard contexts for automatically attaching useful information like geolocation, session, or app version/build to every event."),(0,i.kt)("p",null,"Each event has an argument for custom contexts in order to attach information that isn\u2019t covered by standard contexts."),(0,i.kt)("p",null,"The custom context argument should consist of a List of SelfDescribingJson representing an array of one or more contexts. The format of each individual context element is the same as for an unstructured event (referring to the fact that it consists of a schema and data field - they\u2019re all self-describing JSONs)."),(0,i.kt)("p",null,"If a visitor arrives on a page advertising a movie, the context dictionary might look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "schema": "iglu:com.acme_company/movie_poster/jsonschema/2-1-1",\n  "data": {\n    "movieName": "The Guns of Navarone",\n    "posterCountry": "US",\n    "posterYear": "1961"\n  }\n}\n')),(0,i.kt)("p",null,"The corresponding\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Map"),"\xa0can be used to create a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'// Create a Map of the data you want to include...\nMap<String, String> dataMap = new HashMap<>();\ndataMap.put("movie_name", "solaris");\ndataMap.put("poster_country", "JP");\ndataMap.put("poster_year", "1978");\n\n// Now create your SelfDescribingJson object...\nSelfDescribingJson context1 = new SelfDescribingJson("iglu:com.acme/movie_poster/jsonschema/2-1-1", dataMap);\n')),(0,i.kt)("p",null,"Sending the movie poster context with an event looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// Now add this JSON into a list of SelfDescribingJsons...\nList<SelfDescribingJson> contexts = new ArrayList<>();\ncontexts.add(context1);\n")),(0,i.kt)("p",null,"Note: even if there is only one custom context attached to the event, it still needs to be placed in an array."),(0,i.kt)("h2",{id:"more-advanced-methods"},"More advanced methods"),(0,i.kt)("h3",{id:"tracking-features"},"Tracking features"),(0,i.kt)("h4",{id:"event-types"},"Event types"),(0,i.kt)("h5",{id:"screenview-tracking"},"ScreenView tracking"),(0,i.kt)("p",null,"Auto-tracking can be enabled to send screen view events whenever a screen is changed in the app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .screenviewEvents(true)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"pageview-event"},"PageView event"),(0,i.kt)("p",null,"Use PageView events to track a user viewing a web page within your app:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'tracker.track(PageView.builder()\n    .pageUrl("www.example.com")\n    .pageTitle("example")\n    .referrer("www.referrer.com")\n    .build());\n')),(0,i.kt)("h5",{id:"ecommercetransaction-event"},"EcommerceTransaction event"),(0,i.kt)("p",null,"Use an e-commerce transaction event to track things like online purchases. Transaction items are attached to an e-commerce event in order to record individual items in a transaction."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note"),": that tracking an e-commerce transaction sends multiple events: one transaction event for the transaction as a whole, and one transaction item event for each element of the items list. Each transaction item event will have the same timestamp, order","_","id, and currency as the main transaction event."),(0,i.kt)("p",null,"Here is an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'// Create some Transaction Items\nEcommerceTransactionItem item1 = EcommerceTransactionItem.builder()\n    .itemId("item_id_1")\n    .sku("item_sku_1")\n    .price(1.00)\n    .quantity(1)\n    .name("item_name")\n    .category("item_category")\n    .currency("currency")\n    .build();\n\nEcommerceTransactionItem item2 = EcommerceTransactionItem.builder()\n    .itemId("item_id_2")\n    .sku("item_sku_2")\n    .price(1.00)\n    .quantity(1)\n    .name("item_name")\n    .category("item_category")\n    .currency("currency")\n    .build();\n\n// Add these items to a List\nList<EcommerceTransactionItem> items = new ArrayList<>();\nitems.add(item1);\nitems.add(item2);\n\n// Now track the transaction by using this list of items as an argument\ntracker.track(EcommerceTransaction.builder()\n    .orderId("6a8078be")\n    .totalValue(300.00)\n    .affiliation("my_affiliate")\n    .taxValue(30.00)\n    .shipping(10.00)\n    .city("Boston")\n    .state("Massachusetts")\n    .country("USA")\n    .currency("USD")\n    .items(items)\n    .build());\n\n// Or include the items as varargs in the items section\ntracker.track(EcommerceTransaction.builder()\n    .orderId("6a8078be")\n    .totalValue(300.00)\n    .affiliation("my_affiliate")\n    .taxValue(30.00)\n    .shipping(10.00)\n    .city("Boston")\n    .state("Massachusetts")\n    .country("USA")\n    .currency("USD")\n    .items(item1, item2)\n    .build());\n')),(0,i.kt)("h5",{id:"structured-event"},"Structured event"),(0,i.kt)("p",null,"Use structured events to track a custom event happening in your app which fits the Google Analytics-style structure of having up to five fields (with only the first two required):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'tracker.track(Structured.builder()\n    .category("shop")\n    .action("add-to-basket")\n    .label("Add To Basket")\n    .property("pcs")\n    .value(2.00)\n    .build());\n')),(0,i.kt)("h5",{id:"self-describing-event"},"Self-describing event"),(0,i.kt)("p",null,"A\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),"\xa0is used as a wrapper around either a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"TrackerPayload"),", another\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),"\xa0or a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Map"),"\xa0object. After creating the object you want to wrap, you can create a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"SelfDescribingJson"),"\xa0and track it like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'// This is the Map we have created\nMap<String, String> eventData = new HashMap<>();\neventData.put("Event", "Data")\n\n// We wrap that map in a SelfDescribingJson before sending it\nSelfDescribingJson json = new SelfDescribingJson("iglu:com.acme/example/jsonschema/1-0-0", eventData);\n\n// Now track the event\ntracker.track(json);\n')),(0,i.kt)("h5",{id:"timing-event"},"Timing event"),(0,i.kt)("p",null,"Use a timing event to track a custom timing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'tracker.track(Timing.builder()\n    .category("category")\n    .variable("variable")\n    .timing(1)\n    .label("label")\n    .build());\n')),(0,i.kt)("h5",{id:"consentgranted-event"},"ConsentGranted event"),(0,i.kt)("p",null,"Consent-granted events are used to track when a user consents to data collection:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'t1.track(ConsentGranted.builder()\n    .expiry("Monday, 19-Aug-05 15:52:01 UTC")\n    .documentVersion("5")\n    .documentId("1234")\n    .build());\n')),(0,i.kt)("h5",{id:"consentwithdrawn-event"},"ConsentWithdrawn event"),(0,i.kt)("p",null,"Consent-withdrawn events are used to track when a user withdraws consent to data collection:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'t1.track(ConsentWithdrawn.builder()\n    .all(true)\n    .build());\n\nt1.track(ConsentWithdrawn.builder()\n    .all(false)\n    .documentVersion("5")\n    .documentId("1234")\n    .documentDescription("An example description")\n    .documentName("Consent document")\n    .customContext(contextList)\n    .timestamp(1423583655000)\n    .eventId("uid-1")\n    .build());\n')),(0,i.kt)("h5",{id:"consent-documents"},"Consent documents"),(0,i.kt)("p",null,"Consent documents (documents that detail an agreement around data privacy) can be attached to consent events where they\u2019re applicable."),(0,i.kt)("p",null,"When a consent event is sent for collection, the consent documents will be added as contexts."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'// Create some consent documents\nConsentDocument document1 = ConsentDocument.builder()\n    .documentId("doc-id1")\n    .documentVersion("1")\n    .build();\n\nConsentDocument document2 = ConsentDocument.builder()\n    .documentId("doc-id2")\n    .documentVersion("1")\n    .documentName("document name")\n    .documentDescription("document description")\n    .build();\n\n// Add these items to a List\nList<ConsentDocument> documents = new ArrayList<>();\ndocuments.add(document1);\ndocuments.add(document2);\n\n// Now Track the Transaction by using this list of items as an argument\nt1.track(ConsentGranted.builder()\n    .expiry("Monday, 19-Aug-05 15:52:01 UTC")\n    .documentVersion("5")\n    .documentId("1234")\n    .documentDescription("An example description")\n    .documentName("Consent document")\n    .consentDocuments(documents)\n    .customContext(contextList)\n    .timestamp(1423583655000)\n    .eventId("uid-1")\n    .build());\n')),(0,i.kt)("h4",{id:"session-tracking"},"Session tracking"),(0,i.kt)("p",null,"By default, no client session tracking is activated. Once enabled the tracker will start appending a\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/client_session/jsonschema/1-0-1"},"client","_","session"),"\xa0context to each event it sends and it will maintain this session information for the life of the application, i.e. as long as the application is installed on the device."),(0,i.kt)("p",null,"Sessions correspond to tracked user activity. A session expires when no tracking events have occurred for the amount of time defined in a timeout. When a session expires, the session ID is incremented and session checking will stop. There are two timeouts since a session can timeout in the foreground (while the app is visible) or in the background (when the app has been suspended, but not closed)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder( ... )\n  .sessionContext(true)     // To use the session context\n  .sessionCheckInterval(10) // Checks every 10 seconds (default is 15)\n  .foregroundTimeout(300)   // Timeout after 5 minutes (default is 10)\n  .backgroundTimeout(120)   // Timeout after 2 minutes (default is 5)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"foreground-and-background-events"},"Foreground and background events"),(0,i.kt)("p",null,"Events can be sent whenever the app is foregrounded and backgrounded."),(0,i.kt)("p",null,"In order to enable these events, use the builder method\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"lifecycleEvents"),"\xa0during initialization of the tracker:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(emitter, namespace, appId, this.getApplicationContext())\n                .lifecycleEvents(true)\n                .build()\n);\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/application_foreground/jsonschema/1-0-0"},"Foreground events"),"\xa0are sent whenever an app is opened or resumed."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/application_background/jsonschema/1-0-0"},"Background events"),"\xa0are sent whenever an app is moved to the background."),(0,i.kt)("p",null,"Events are not sent on app close since the OS cannot guarantee advance notice of app closing."),(0,i.kt)("h5",{id:"install-tracking"},"Install tracking"),(0,i.kt)("p",null,"Auto-tracking can be enabled to send an install event whenever the tracker is used for the first time in an app. The tracker will record when it\u2019s first been installed, so deleting and reinstalling an app will trigger another install event."),(0,i.kt)("p",null,"If install auto-tracking is not enabled, the tracker will still keep track of when the app was first installed, so that when enabled, the tracker will send the recorded install event with a timestamp reflecting when it was first installed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .installTracking(true)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"crash-tracking"},"Crash tracking"),(0,i.kt)("p",null,"Auto-tracking for application crashes can be enabled to send events that capture exception information."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .applicationCrash(true)\n  .build()\n);\n")),(0,i.kt)("h4",{id:"standard-contexts"},"Standard contexts"),(0,i.kt)("p",null,"These are out-of-the-box tracker options that when enabled will attach useful contexts to every event."),(0,i.kt)("h5",{id:"session-context"},"Session context"),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/client_session/jsonschema/1-0-1"},"session context"),"\xa0includes sessionization information like user ID and session ID that can be used to relate user activity patterns to events."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder( ... )\n  .sessionContext(true)     // To use the session context\n  .sessionCheckInterval(10) // Checks every 10 seconds (default is 15)\n  .foregroundTimeout(300)   // Timeout after 5 minutes (default is 10)\n  .backgroundTimeout(120)   // Timeout after 2 minutes (default is 5)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"mobile-context"},"Mobile context"),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/mobile_context/jsonschema/1-1-0"},"mobile"),"\xa0context contains information like OS version, device model, carrier and more."),(0,i.kt)("p",null,"It is enabled when creating the tracker:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .mobileContext(true)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"geolocation-context"},"Geolocation context"),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/geolocation_context/jsonschema/1-1-0"},"geolocation context"),"\xa0contains information like the coordinates, speed and bearing of the device."),(0,i.kt)("p",null,"It is enabled when creating the tracker:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .geoLocationContext(true)\n  .build()\n);\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note"),": Requires Location permissions accordingly to the requirements of the various Android versions. Otherwise the whole context is skipped."),(0,i.kt)("h5",{id:"application-context"},"Application context"),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.mobile/application/jsonschema/1-0-0"},"application context"),"\xa0includes app build and version number."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .applicationContext(true)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"screen-context"},"Screen Context"),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.mobile/screen/jsonschema/1-0-0"},"screen context"),"\xa0contains information related to the current screen being viewed on the device when the event is created."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Tracker.init(new Tracker.TrackerBuilder(...)\n  .screenContext(true)\n  .build()\n);\n")),(0,i.kt)("h5",{id:"gdpr-context"},"GDPR Context"),(0,i.kt)("p",null,"The GDPR context attaches a context with the GDPR basis for processing and the details of a related document (eg. a consent document) to all events which are fired after it is set."),(0,i.kt)("table",null,(0,i.kt)("tbody",null,(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("strong",null,"NAME")),(0,i.kt)("td",null,(0,i.kt)("strong",null,"DESCRIPTION")),(0,i.kt)("td",null,(0,i.kt)("strong",null,"REQUIRED")),(0,i.kt)("td",null,(0,i.kt)("strong",null,"TYPE"))),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"basisForProcessing")),(0,i.kt)("td",null,"GDPR Basis for processing"),(0,i.kt)("td",null,"Yes"),(0,i.kt)("td",null,"Enum")),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"documentId")),(0,i.kt)("td",null,"ID of a GDPR basis document"),(0,i.kt)("td",null,"No"),(0,i.kt)("td",null,"String")),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"documentVersion")),(0,i.kt)("td",null,"Version of the document"),(0,i.kt)("td",null,"No"),(0,i.kt)("td",null,"String")),(0,i.kt)("tr",null,(0,i.kt)("td",null,(0,i.kt)("code",null,"documentDescription")),(0,i.kt)("td",null,"Description of the document"),(0,i.kt)("td",null,"No"),(0,i.kt)("td",null,"String")))),(0,i.kt)("p",null,"The required basisForProcessing accepts only the following literals: ",(0,i.kt)("inlineCode",{parentName:"p"},"consent"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"contract"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"legal_obligation"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"vital_interests"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"public_task"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"legitimate_interests")," - in accordance with the ",(0,i.kt)("a",{parentName:"p",href:"https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/lawful-basis-for-processing/"},"five legal bases for processing")),(0,i.kt)("p",null,"The GDPR context is enabled by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"gdprContext")," method of the tracker builder or by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"enableGdprContext")," method once the tracker has been initialised."),(0,i.kt)("p",null,"Setup on tracker settings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Tracker.TrackerBuilder builder = new Tracker.TrackerBuilder(emitter, namespace, appId, appContext)\n    .gdprContext(\n        Gdpr.Basis.CONSENT,\n        "someId",\n        "0.1.0",\n        "a demo document description"\n    )\n    ...\n    .build()\nTracker.init(builder);\n')),(0,i.kt)("p",null,"Setup on tracker already initialised:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Tracker.instance().enableGdprContext(\n    Gdpr.Basis.CONSENT,\n    "someId",\n    "0.1.0",\n    "a demo document description"\n);\n')),(0,i.kt)("h3",{id:"trackers-diagnostic"},"Tracker's diagnostic"),(0,i.kt)("p",null,"The tracker is constantly tested with different platforms and versions but there are rare situations where an error can be reported. The tracker can manage the situation avoiding crashes of the app and assuring that the events are not lost. However, it can report errors to the collector as ",(0,i.kt)("inlineCode",{parentName:"p"},"diagnostic_error")," events."),(0,i.kt)("p",null,"To activate this feature you only need to enable ",(0,i.kt)("inlineCode",{parentName:"p"},"trackerDiagnostic"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"TrackerBuilder trackerBuilder =\n    new TrackerBuilder(emitter, namespace, appId, appContext)\n        .trackerDiagnostic(true)\n        ...\n        .build();\nTracker.init(trackerBuilder);\n")),(0,i.kt)("h3",{id:"emitter-options"},"Emitter options"),(0,i.kt)("p",null,"These options are used to fine-tune the emitter."),(0,i.kt)("h4",{id:"setting-the-request-method"},"Setting the request method"),(0,i.kt)("p",null,"The request method used to connect to the collector, either:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"HttpMethod.GET"),", or\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"HttpMethod.POST"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .method(HttpMethod.GET) // Optional - Defines how we send the request\n        .build();\n')),(0,i.kt)("p",null,"In a GET request, each event is sent in an individual request. In a POST request, events can be bundled together in one request."),(0,i.kt)("h4",{id:"setting-the-emit-timeout"},"Setting the emit timeout"),(0,i.kt)("p",null,"The maximum timeout for emitting events"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .emitTimeout(5)\n        .build();\n')),(0,i.kt)("h4",{id:"configure-the-buffer"},"Configure the buffer"),(0,i.kt)("p",null,"A buffer is used to group events together in bulk before sending them. This is especially handy to reduce network usage. By default, the Emitter buffers up to 10 events together before sending them; only available if you are using POST as your request type."),(0,i.kt)("p",null,"The buffer can be configured when creating the emitter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .option(BufferOption.Single) // Optional - Defines how many events we bundle in a POST\n        .build();\n')),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"OPTION"),(0,i.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Single"),(0,i.kt)("td",{parentName:"tr",align:null},"Events are sent individually")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DefaultGroup"),(0,i.kt)("td",{parentName:"tr",align:null},"Sends events in groups of 10 events or less")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"HeavyGroup"),(0,i.kt)("td",{parentName:"tr",align:null},"Sends events in groups of 25 events or less")))),(0,i.kt)("p",null,"Note: Buffer options will only ever influence how POST request are sent however. All GET requests will be sent individually."),(0,i.kt)("h4",{id:"setting-the-protocol"},"Setting the protocol"),(0,i.kt)("p",null,"The protocol used to connect to the collector, either:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"RequestSecurity.HTTP"),", or\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"RequestSecurity.HTTPS"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .security(RequestSecurity.HTTPS) // Optional - Defines what protocol used to send events\n        .build();\n')),(0,i.kt)("h4",{id:"setting-the-tls-version"},"Setting the TLS version"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Transport_Layer_Security"},"TLS"),"\xa0is a cryptography protocol needed if you\u2019ve chosen to send events over HTTPS."),(0,i.kt)("p",null,"To specify a specific version, supply\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"TLSVersion"),"\xa0(or for multiple versions,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"EnumSet<TLSVersion>"),") to the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"tls"),"\xa0builder method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .tls(TLSVersion.TLSv1_2) // Optional - Defines what TLS versions are used for the request\n        .build();\n')),(0,i.kt)("h4",{id:"setting-a-callback"},"Setting a callback"),(0,i.kt)("p",null,"An emitter callback can be set which will be called with the count of successful and failed events."),(0,i.kt)("p",null,"First create the callback you\u2019d like to define, and then supply it to an emitter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'RequestCallback callback = new RequestCallback() {\n  @Override\n  public void onSuccess(int successCount) {\n    Log.d("Tracker", "Buffer length for POST/GET:" + successCount);\n  }\n  @Override\n  public void onFailure(int successCount, int failureCount) {\n    Log.d("Tracker", "Failures: " + failureCount + "; Successes: " + successCount);\n  }\n});\n\nEmitter emitter = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context)\n        .callback(callback)\n        .build();\n')),(0,i.kt)("h4",{id:"send-limit"},"Send limit"),(0,i.kt)("p",null,"The number of events retrieved from storage in the database whenever the emitter needs more to send."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .sendLimit(250)\n        .build();\n')),(0,i.kt)("h4",{id:"get-byte-limit"},"GET byte limit"),(0,i.kt)("p",null,"The maximum data size of GET requests made by the emitter to send events."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .byteLimitGet(40000)\n        .build();\n')),(0,i.kt)("h4",{id:"post-byte-limit"},"POST byte limit"),(0,i.kt)("p",null,"The maximum data size of POST requests made by the emitter to send events."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Emitter e2 = new Emitter\n        .EmitterBuilder("com.collector.acme", Context context) // Required\n        .byteLimitGet(40000)\n        .build();\n')),(0,i.kt)("h3",{id:"global-contexts"},"Global Contexts"),(0,i.kt)("p",null,"Apart from the predefined contexts that are sent with every event, custom contexts are added to events individually. However there are times when we wish to attach a custom context to every event, or a set of events automatically. Global contexts are introduced to meet this requirement: send custom contexts with every event or a set of events based on criterias specified by the user."),(0,i.kt)("h4",{id:"context-primitives"},"Context primitives"),(0,i.kt)("p",null,"Context primitive is a term for anything that can be used as a context. A context primitive is either a self-describing JSON, or a callback that creates a self-describing JSON."),(0,i.kt)("h5",{id:"self-describing-json"},"Self-describing JSON"),(0,i.kt)("p",null,"Custom contexts are represented as self describing JSONs and they can be used as a global context when you\u2019d like define a context that is attached to every event and its\u2019 content never changes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Map<String, String> attributes = new HashMap<>();\nattributes.put("test-key-1", "test-value-1");\nGlobalContext testCtx = new SelfDescribingJson("sdjExample", "iglu:com.snowplowanalytics.snowplow/test_sdj/jsonschema/1-0-1", attributes);\nTracker.instance().addGlobalContext(testCtx);\n')),(0,i.kt)("h5",{id:"context-generator"},"Context Generator"),(0,i.kt)("p",null,"A context generator is a callback that returns a self describing JSON, representing a context. They are evaluated each time an event is sent, hence they meet the case where we would like to send a context based on event payload."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'GlobalContext testCtx = new ContextGenerator() {\n    @Override\n    public SelfDescribingJson generate(TrackerPayload payload, String eventType, String eventSchema) {\n        return new SelfDescribingJson("iglu:com.acme/test_event/jsonschema/1-0-0");\n    }\n\n    @Override\n    public String tag() {\n        return "testCtx";\n    }\n};\nTracker.instance().addGlobalContext(testCtx);\n')),(0,i.kt)("h4",{id:"conditional-context-providers"},"Conditional Context Providers"),(0,i.kt)("p",null,"A conditional context provider is used when a global context only needs to be sent for certain events. Whereas context primitives are sent with every event without exception."),(0,i.kt)("h5",{id:"filter-provider"},"Filter Provider"),(0,i.kt)("p",null,"A Filter Provider is used to discriminate between events so we can attach global contexts only to certain events."),(0,i.kt)("p",null,"A Filter Provider has a callback,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"filter"),", returning a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"boolean"),"\xa0which determines the events that this context primitive(s) will be added."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'ContextPrimitive primitive = new SelfDescribingJson("iglu:com.acme/test_event/jsonschema/1-0-0");\nGlobalContext testCtx = new FilterProvider("test-tag", new ContextFilter() {\n    @Override\n    public boolean filter(TrackerPayload payload, String eventType, String eventSchema) {\n        return eventType.equals("se");\n    }\n}, primitive);\nTracker.instance().addGlobalContext(testCtx);\n')),(0,i.kt)("h5",{id:"ruleset-provider"},"Ruleset Provider"),(0,i.kt)("p",null,"A Ruleset Provider is used when you want to attach a global context to certain events based on the schema URI."),(0,i.kt)("p",null,"A Ruleset Provider has a RuleSet which has an allow list and a deny list. Both lists contain Iglu URIs which can be modified based on some syntactic rules."),(0,i.kt)("p",null,"In this example, the Ruleset Provider will attach the context\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"primitive"),"\xa0to events with the schema\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"iglu:com.acme.*/*/jsonschema/*-*-*"),", but not to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"iglu:com.acme.marketing/*/jsonschema/*-*-*"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'ContextPrimitive primitive = new SelfDescribingJson("iglu:com.acme/test_event/jsonschema/1-0-0");\nRuleSet ruleSet = new RuleSet("iglu:com.acme.*/*/jsonschema/*-*-*", "iglu:com.acme.marketing/*/jsonschema/*-*-*");\n\nGlobalContext testCtx = new RuleSetProvider("ruleSetExample", ruleSet, primitive);\n\nTracker.instance().addGlobalContext(testCtx);\n')),(0,i.kt)("h6",{id:"ruleset-format"},"Ruleset format"),(0,i.kt)("p",null,"RuleSet\u2019s rules are the strings used to match against certain schemas, such as\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"iglu:com.acme/*/jsonschema/*-*-*"),"."),(0,i.kt)("p",null,"They follow the same five-part format as an Iglu URI:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"protocol:vendor/event_name/format/version\n")),(0,i.kt)("p",null,"with the exception that a wildcard can be used in an allowed fashion to refer to all applying cases."),(0,i.kt)("p",null,"The parts of a rule are wildcarded with certain guidelines:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"asterisks cannot be used for the protocol (i.e. schemas always start with\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"iglu:"),")."),(0,i.kt)("li",{parentName:"ul"},"version matching must be specified like so: ","*","-","*","-","*",", where any part of the versioning can be defined, e.g. 1-","*","-","*",", but only sequential parts are to be wildcarded, e.g. 1-","*","-1 is invalid but 1-","*","-","*"," is valid."),(0,i.kt)("li",{parentName:"ul"},"at least two parts parts:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"com.acme.*"),"\xa0is valid, while\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"com.*"),"\xa0is not."),(0,i.kt)("li",{parentName:"ul"},"vendors cannot be defined with non-wildcarded parts between wildcarded parts: com.acme.","*",".marketing.","*"," is invalid, while com.acme.","*",".","\\",(0,i.kt)("a",{parentName:"li",href:"https://zoom.us/j/779696786%5C"},"https://zoom.us/j/779696786\\"),"* is valid")),(0,i.kt)("h2",{id:"api-reference"},"API Reference"),(0,i.kt)("p",null,"For documentation detailing the entire Android tracking SDK, please refer to the API reference found\xa0",(0,i.kt)("a",{parentName:"p",href:"https://snowplow.github.io/snowplow-android-tracker/"},"here"),"."))}u.isMDXComponent=!0}}]);