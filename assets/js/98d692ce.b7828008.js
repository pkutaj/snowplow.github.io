"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[81037],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,g=m["".concat(s,".").concat(u)]||m[u]||d[u]||o;return n?a.createElement(g,i(i({ref:t},c),{},{components:n})):a.createElement(g,i({ref:t},c))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},28299:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={title:"Google AMP (1.0.3)",date:"2020-03-19",sidebar_position:990},i=void 0,l={unversionedId:"collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/index",id:"collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/index",title:"Google AMP (1.0.3)",description:"Overview",source:"@site/docs/collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2",slug:"/collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/",permalink:"/docs/collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0-2/index.md",tags:[],version:"current",lastUpdatedAt:1661254422,formattedLastUpdatedAt:"Aug 23, 2022",sidebarPosition:990,frontMatter:{title:"Google AMP (1.0.3)",date:"2020-03-19",sidebar_position:990},sidebar:"tutorialSidebar",previous:{title:"Google AMP Tracker",permalink:"/docs/collecting-data/collecting-from-own-applications/google-amp-tracker/"},next:{title:"Google AMP (0.1.0)",permalink:"/docs/collecting-data/collecting-from-own-applications/google-amp-tracker/google-amp-1-0-0/"}},s={},p=[{value:"Overview",id:"overview",level:2},{value:"Redshift Users",id:"redshift-users",level:3},{value:"Standard variables",id:"standard-variables",level:2},{value:"<code>collectorHost</code>",id:"collectorhost",level:3},{value:"<code>appId</code>",id:"appid",level:3},{value:"<code>userId</code>",id:"userid",level:3},{value:"<code>nameTracker</code>",id:"nametracker",level:3},{value:"<code>customContexts</code>",id:"customcontexts",level:3},{value:"Tracking events",id:"tracking-events",level:2},{value:"Page view",id:"page-view",level:3},{value:"Structured events",id:"structured-events",level:3},{value:"Page pings",id:"page-pings",level:3},{value:"Custom events",id:"custom-events",level:3},{value:"Analytics",id:"analytics",level:2},{value:"Standard fields",id:"standard-fields",level:3},{value:"Page view and ping aggregation",id:"page-view-and-ping-aggregation",level:3},{value:"User Identification",id:"user-identification",level:3},{value:"JS-tracker page to AMP page",id:"js-tracker-page-to-amp-page",level:4},{value:"AMP page to JS-tracker page",id:"amp-page-to-js-tracker-page",level:4},{value:"Reporting Issues and Contributing",id:"reporting-issues-and-contributing",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Snowplow is collaborating with Google on their  ",(0,r.kt)("a",{parentName:"p",href:"https://www.ampproject.org/"},"Accelerated Mobile Pages Project")," (AMPP or AMP for short). AMP is an open source (Apache License 2.0) initiative to improve the mobile web experience by optimizing web pages for mobile devices."),(0,r.kt)("p",null,"To learn more about analytics for AMP pages see the ",(0,r.kt)("a",{parentName:"p",href:"https://www.ampproject.org/docs/reference/extended/amp-analytics.html"},"amp-analytics")," reference. For general information about AMP see ",(0,r.kt)("a",{parentName:"p",href:"https://www.ampproject.org/docs/get_started/about-amp.html"},"What Is AMP?")," on the ",(0,r.kt)("a",{parentName:"p",href:"https://www.ampproject.org/"},"Accelerated Mobile Pages (AMP) Project")," site."),(0,r.kt)("p",null,"Snowplow is natively integrated into the project, so pages optimized with AMP HTML can be tracked in Snowplow by adding the appropriate ",(0,r.kt)("inlineCode",{parentName:"p"},"amp-analytics")," tag to your pages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\n<body>\n  ...\n  <amp-analytics type="snowplow_v2" id="snowplow_v2">\n  <script type="application/json">\n  {\n    "vars": {\n     "collectorHost": "collector.snplow.net",\n     "appId": "amp-examples-v2.0.2",\n     ...\n    },\n    "linkers": {\n     "enabled": true,\n     ...\n    },\n    "triggers": {\n     "defaultPageview": {\n       "on": "visible",\n       "request": "pageView"\n     }\n    }\n  }\n  <\/script>\n  </amp-analytics>\n</body>\n')),(0,r.kt)("p",null,"*","Note:","*"," The tracker utilises AMP linker functionality to ensure that user identification can be done where a user may visit via the google domain or the site's own domain. In order to function, this requires that linkers are enabled in the amp-analytics configuration. Not doing so can result in changing AMP client Ids (which are the primary user identifier)."),(0,r.kt)("h3",{id:"redshift-users"},"Redshift Users"),(0,r.kt)("p",null,"The v2 AMP tracker attaches two custom contexts to all events by defaul. Redshift users using RDB 0.16 or earlier must create the ",(0,r.kt)("inlineCode",{parentName:"p"},"amp_id_1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"amp_web_page_1")," tables before use. SQL definitions can be found in Iglu central"),(0,r.kt)("h2",{id:"standard-variables"},"Standard variables"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"collectorHost")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"appId")," must be provided in the ",(0,r.kt)("inlineCode",{parentName:"p"},'"vars"')," section of the tag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  ...\n},\n')),(0,r.kt)("p",null,"The rest are optional"),(0,r.kt)("h3",{id:"collectorhost"},(0,r.kt)("inlineCode",{parentName:"h3"},"collectorHost")),(0,r.kt)("p",null,"Specify the host to your collector like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "collectorHost": "snowplow-collector.acme.com",\n  ...\n')),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Do ",(0,r.kt)("em",{parentName:"li"},"not")," include the protocol aka schema (",(0,r.kt)("inlineCode",{parentName:"li"},"http(s)://"),")"),(0,r.kt)("li",{parentName:"ul"},"Do ",(0,r.kt)("em",{parentName:"li"},"not")," include a trailing slash"),(0,r.kt)("li",{parentName:"ul"},"Use of HTTPS is mandatory in AMP, so your Snowplow collector ",(0,r.kt)("strong",{parentName:"li"},"must")," support HTTPS")),(0,r.kt)("h3",{id:"appid"},(0,r.kt)("inlineCode",{parentName:"h3"},"appId")),(0,r.kt)("p",null,"You must set the application ID for the website you are tracking via AMP:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "appId": "campaign-microsite",\n  ...\n')),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You do not have to use the ",(0,r.kt)("inlineCode",{parentName:"li"},"appId")," to distinguish AMP traffic from other web traffic (unless you want to) - see the  ",(0,r.kt)("a",{parentName:"li",href:"#analytics"},"Analytics")," section for an alternative approach")),(0,r.kt)("h3",{id:"userid"},(0,r.kt)("inlineCode",{parentName:"h3"},"userId")),(0,r.kt)("p",null,"Specify the optional ",(0,r.kt)("inlineCode",{parentName:"p"},'"userId"')," var to set the uid/user","_","id  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/snowplow-tracker-protocol"},"Snowplow")," ",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol/"},"tracker")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/snowplow-tracker-protocol"},"protocol")," field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "userId": "someUserId",\n  ...\n')),(0,r.kt)("h3",{id:"nametracker"},(0,r.kt)("inlineCode",{parentName:"h3"},"nameTracker")),(0,r.kt)("p",null,'Specify the optional "nameTracker" var to set the tna/name',"_","tracker ",(0,r.kt)("a",{parentName:"p",href:"/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol/"},"Snowplow tracker protocol")," field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "nameTracker": "someTrackerName",\n  ...\n')),(0,r.kt)("h3",{id:"customcontexts"},(0,r.kt)("inlineCode",{parentName:"h3"},"customContexts")),(0,r.kt)("p",null,"Custom contexts may be added by including Self-Describing JSON as a ",(0,r.kt)("inlineCode",{parentName:"p"},'"customContexts"')," var, with ",(0,r.kt)("inlineCode",{parentName:"p"},'"')," characters escaped:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "customContexts":  "{\\"schema\\":\\"iglu:com.acme/first_context/jsonschema/1-0-0\\",\\"data\\":{\\"someKey\\":\\"someValue\\"}}"\n  ...\n')),(0,r.kt)("p",null,"Multiple custom contexts may be added by separating each self-describing JSON with a comma:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"vars": {\n  "customContexts":  "{\\"schema\\":\\"iglu:com.acme/first_context/jsonschema/1-0-0\\",\\"data\\":{\\"someKey\\":\\"someValue\\"}},{\\"schema\\":\\"iglu:com.acme/second_context/jsonschema/1-0-0\\",\\"data\\":{\\"someOtherKey\\":\\"someOtherValue\\"}}"\n  ...\n')),(0,r.kt)("p",null,"Custom contexts may either be set globally for all events (as a top-level var, see above) or per-event trigger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'...\n"triggers": {\n...\n  "defaultPageview": {\n    "on": "click",\n    "selector": "visible",\n    "request": "pageView",\n    "vars": {\n      "customContexts":  "{\\"schema\\":\\"iglu:com.acme/first_context/jsonschema/1-0-0\\",\\"data\\":{\\"someKey\\":\\"someValue\\"}}"\n    }\n  }\n}\n...\n')),(0,r.kt)("p",null,"These approaches may not currently be mixed, however."),(0,r.kt)("h2",{id:"tracking-events"},"Tracking events"),(0,r.kt)("p",null,"The following trigger request values are supported for the Snowplow Analytics configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pageView")," for page view tracking"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"structEvent")," for structured event tracking"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ampPagePing")," for page ping tracking"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"selfDescribingEvent")," for custom event tracking")),(0,r.kt)("p",null,"All event tracking is disabled by default; you can enable it on an event-by-event basis as follows:"),(0,r.kt)("h3",{id:"page-view"},"Page view"),(0,r.kt)("p",null,"Enable the page view tracking like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<amp-analytics type="snowplow_v2" id="event1">\n<script type="application/json">\n{\n  "vars": {\n    "collectorHost": "snowplow-collector.acme.com",  // Replace with your collector host\n    "appId": "campaign-microsite"                    // Replace with your app ID\n  },\n  "triggers": {\n    "trackPageview": {  // Trigger names can be any string. trackPageview is not a required name\n      "on": "visible",\n      "request": "pageView"\n    }\n  }\n}\n<\/script>\n</amp-analytics>\n')),(0,r.kt)("h3",{id:"structured-events"},"Structured events"),(0,r.kt)("p",null,'Structured events are user interactions with content that can be tracked independently from a web page or a screen load. "Structured" refers to the Google Analytics-style structure of having up to five fields (with only the first two required).'),(0,r.kt)("p",null,"Events can be sent by setting the AMP trigger request value to event and setting the required event category and action fields."),(0,r.kt)("p",null,"The following example uses the selector attribute of the trigger to send an event when a particular element is clicked:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<amp-analytics type="snowplow_v2" id="event2">\n<script type="application/json">\n{\n  "vars": {\n    "collectorHost": "snowplow-collector.acme.com",  // Replace with your collector host\n    "appId": "campaign-microsite"                    // Replace with your app ID\n  },\n  "triggers": {\n    "trackClickOnHeader" : {\n      "on": "click",\n      "selector": "#header",\n      "request": "structEvent",\n      "vars": {\n        "structEventCategory": "ui-components",\n        "structEventAction": "header-click"\n      }\n    }\n  }\n}\n<\/script>\n</amp-analytics>\n')),(0,r.kt)("p",null,"You can set key-value pairs for the following event fields in the vars attribute of the trigger:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Argument")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Required?")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Validation")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"structEventCategory")),(0,r.kt)("td",{parentName:"tr",align:null},"The grouping of structured events which this ",(0,r.kt)("inlineCode",{parentName:"td"},"action")," belongs to"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"structEventAction")),(0,r.kt)("td",{parentName:"tr",align:null},"Defines the type of user interaction which this event involves"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"structEventLabel")),(0,r.kt)("td",{parentName:"tr",align:null},"A string to provide additional dimensions to the event data"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"structEventProperty")),(0,r.kt)("td",{parentName:"tr",align:null},"A string describing the object or the action performed on it"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"structEventValue")),(0,r.kt)("td",{parentName:"tr",align:null},"A value to provide numerical data about the event"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Int or Float")))),(0,r.kt)("h3",{id:"page-pings"},"Page pings"),(0,r.kt)("p",null,"Enable page ping tracking like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<amp-analytics type="snowplow_v2" id="event3">\n<script type="application/json">\n{\n  "vars": {\n    "collectorHost": "snowplow-collector.acme.com",  // Replace with your collector host\n    "appId": "campaign-microsite"                    // Replace with your app ID\n  },\n  "triggers": {\n    "trackPagePings": {\n      "on": "timer",\n      "request": "ampPagePing",\n      "timerSpec": {\n        "interval": 30,      // Set to desired ping interval\n        "maxTimerLength": 1800,\n        "immediate": false,\n        "startSpec": {\n          "on": "visible",\n          "selector": ":root"\n        },\n        "stopSpec": {\n          "on": "hidden",\n          "selector": ":root"\n        }\n      }\n    }\n  }\n}\n<\/script>\n</amp-analytics>\n')),(0,r.kt)("p",null,"AMP page ping events will be sent as AMP-specific page ping events (rather than Javascript tracker page pings), against the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/dev.amp.snowplow/amp_page_ping/jsonschema/1-0-0"},"AMP page ping schema"),", since the data available on AMP is defined differently to Javascript tracker page pings.  "),(0,r.kt)("p",null,"All events are sent with an  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/dev.amp.snowplow/amp_web_page/jsonschema/1-0-0"},"AMP web page")," context, for aggregation of pings by page view id."),(0,r.kt)("h3",{id:"custom-events"},"Custom events"),(0,r.kt)("p",null,"Custom events may be sent via the AMP tracker by passing the schema vendor, and version, and an escaped JSON of the desired data, as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<amp-analytics type="snowplow_v2" id="event3">\n<script type="application/json">\n{\n  "vars": {\n    "collectorHost": "snowplow-collector.acme.com",  // Replace with your collector host\n    "appId": "campaign-microsite"                    // Replace with your app ID\n  },\n  "triggers": {\n    "trackSelfDescribingEvent": {\n      "on": "click",\n      "selector": "a",\n      "request": "selfDescribingEvent",\n      "vars": {\n        "customEventSchemaVendor": "com.snowplowanalytics.snowplow",\n        "customEventSchemaName": "link_click",\n        "customEventSchemaVersion": "1-0-1",\n        "customEventSchemaData": "{\\"targetUrl\\":\\"${targetUrl}\\",\\"elementId\\":\\"TEST\\",\\"elementContent\\":\\"${elementContent}\\"}"\n      }\n    }\n  }\n}\n<\/script>\n</amp-analytics>\n')),(0,r.kt)("h2",{id:"analytics"},"Analytics"),(0,r.kt)("p",null,"v2 of the tracker brings with it significant improvements in our ability to model and gain insights."),(0,r.kt)("h3",{id:"standard-fields"},"Standard fields"),(0,r.kt)("p",null,"All events sent via this tracker will have:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"v_tracker")," set to ",(0,r.kt)("inlineCode",{parentName:"li"},"amp-1.0.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"platform")," set to ",(0,r.kt)("inlineCode",{parentName:"li"},"web"))),(0,r.kt)("p",null,"If you want to analyze events sent via this tracker, you may prefer to query for ",(0,r.kt)("inlineCode",{parentName:"p"},"v_tracker LIKE 'amp-%'")," to future-proof your query against future releases of this tracker (which may change the version number)."),(0,r.kt)("h3",{id:"page-view-and-ping-aggregation"},"Page view and ping aggregation"),(0,r.kt)("p",null,"By default, the  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/dev.amp.snowplow/amp_web_page/jsonschema/1-0-0"},"AMP web page context")," is attached to every event. This will contain the AMP-defined ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#page-view-id-64"},"PAGE","_","VIEW","_","ID","_","64"),', which defined as "intended to be random with a high entropy and likely to be unique per URL, user and day".'),(0,r.kt)("p",null,"Users can aggregate page views, page pings and other events on-page by this ID to aggregate engaged time, and model events to a page view level, by combining it with the url, amp client ID, and date."),(0,r.kt)("p",null,"Note that page pings and the page view ID itself are not defined by Snowplow's logic, but by what's made available by AMP - therefore applying the same logic to this data as that produced by the Javascript tracker is liable to produce different results."),(0,r.kt)("h3",{id:"user-identification"},"User Identification"),(0,r.kt)("p",null,"By default, the  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/dev.amp.snowplow/amp_id/jsonschema/1-0-0"},"AMP ID")," context is attached to every event. This contains the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#client-id"},"AMP Client ID"),", the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," (if set via the ",(0,r.kt)("inlineCode",{parentName:"p"},"userId")," var), and the domain","_","userid (if passed to an AMP page via cross-domain linking - more detail below)."),(0,r.kt)("p",null,"This provides a map between the main relevant identifiers, which can be used to model user journeys across platforms. Users can choose to instrument further user identification methods using custom contexts."),(0,r.kt)("p",null,"In order for the AMP Client ID to behave as expected, the 'linker' parameter of the configuration JSON must have ",(0,r.kt)("inlineCode",{parentName:"p"},"'enabled': true")," set. Failing to do so can result in changing AMP client IDs, even where a user remains on AMP pages for the whole journey. (This can happen because AMP pages can be served from Google's AMP cache)."),(0,r.kt)("p",null,"The tracker is designed to handle user journeys as follows:"),(0,r.kt)("h4",{id:"js-tracker-page-to-amp-page"},"JS-tracker page to AMP page"),(0,r.kt)("p",null,"Where a user moves from a standard web page, tracked by the Javascript tracker, to an AMP page, the domain userid from the Javascript tracker can be passed to the AMP tracker by enabling the  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow/wiki/1-General-parameters-for-the-Javascript-tracker#2217-configuring-cross-domain-tracking"},"Javascript tracker's crossDomainLinker"),". The AMP tracker will parse the value from the querystring, and attach it to all events, along with the AMP client ID, via the AMP ID context."),(0,r.kt)("p",null,"The AMP tracker uses a combination of cookies and the AMP linker to attempt to retain the value, however due to the nature of AMP pages, there is no guarantee that the value will be retained across sessions. To ensure best possible retention of the value within the session, make sure the tracker config has linker pages enabled for your AMP domains:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'...\n"linkers": {\n  "enabled": true,\n  "proxyOnly": false,\n  "destinationDomains": ["ampdomain"]\n},\n...\n')),(0,r.kt)("p",null,"Data models should be designed for an 'at least once' identification structure - in other words, configuring the cross-domain linker correcttly will ensure at least one event contains both AMP ID and domain User ID. Models should aim to map this across all events. Of course, this method of identification depends on the user traveling directly from a JS-tracked page to an AMP page at least once."),(0,r.kt)("h4",{id:"amp-page-to-js-tracker-page"},"AMP page to JS-tracker page"),(0,r.kt)("p",null,"Where a user moves frrom an AMP page to a standard web page which is tracked by the Javascript tracker, the AMP tracker will use AMP's linker functionality to append the AMP CLient ID to the querystring, as long as linkers are enabled for the destination domain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'...\n"linkers": {\n  "enabled": true,\n  "proxyOnly": false,\n  "destinationDomains": ["destDomain"]\n},\n...\n')),(0,r.kt)("p",null,"This will add a querystring parameter 'linker=' to the destination url, which contains the amp","_","id value, base-64 encoded. This will look something like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"?sp_amp_linker=1*1c1wx43*amp_id*amp-a1b23cDEfGhIjkl4mnoPqr"),"."),(0,r.kt)("p",null,"The structure of this param is explained in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ampproject/amphtml/blob/master/extensions/amp-analytics/linker-id-receiving.md"},"AMP documentation")," - models can extract the base64-encoded AMP Client ID, decode it, and map it to the domain userid (or any other user value) from the Javascript tracker."),(0,r.kt)("h2",{id:"reporting-issues-and-contributing"},"Reporting Issues and Contributing"),(0,r.kt)("p",null,"A fork of the AMP project can be found in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow-incubator/amphtml"},"Snowplow Incubator Github")," Repo. Please submit issues, bugreports and PRs to this repo."))}d.isMDXComponent=!0}}]);