"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[57205],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>g});var r=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(a),g=o,k=u["".concat(s,".").concat(g)]||u[g]||d[g]||n;return a?r.createElement(k,l(l({ref:t},c),{},{components:a})):r.createElement(k,l({ref:t},c))}));function g(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,l=new Array(n);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<n;p++)l[p]=a[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},77881:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>p,toc:()=>d});var r=a(87462),o=(a(67294),a(3905));const n={toc:[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Download the JavaScript tracker file",id:"download-the-javascript-tracker-file",level:2},{value:"gzip and rename the file",id:"gzip-and-rename-the-file",level:2},{value:"Uploading to Google Cloud Storage",id:"uploading-to-google-cloud-storage",level:2},{value:"Create a storage bucket",id:"create-a-storage-bucket",level:3},{value:"Upload your file",id:"upload-your-file",level:3},{value:"Set metadata",id:"set-metadata",level:3},{value:"Set permissions",id:"set-permissions",level:3},{value:"Add DNS Record for bucket (optional)",id:"add-dns-record-for-bucket-optional",level:3},{value:"Update your tracking tags",id:"update-your-tracking-tags",level:2}]};function l(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,r.Z)({},n,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"pre-requisites"},(0,o.kt)("a",{parentName:"h2",href:"https://github.com/snowplow/snowplow/wiki/self-hosting-snowplow-js#pre-requisites"}),"Pre-requisites"),(0,o.kt)("p",null,"For the purposes of this guide, we are going to assume that you want to serve the standard\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"sp.js"),"\xa0from Google Cloud Storage. To accomplish this, you will need the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"An account with\xa0",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/"},"Google Cloud")),(0,o.kt)("li",{parentName:"ul"},"Access to Google Cloud Storage (GCS) within your GCP account")),(0,o.kt)("h2",{id:"download-the-javascript-tracker-file"},"Download the JavaScript tracker file"),(0,o.kt)("p",null,"Navigate to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow-javascript-tracker/releases"},"https://github.com/snowplow/snowplow-javascript-tracker/releases")," and download the latest version of the Snowplow JavaScript Tracker sp.js file"),(0,o.kt)("h2",{id:"gzip-and-rename-the-file"},"gzip and rename the file"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"rename ",(0,o.kt)("inlineCode",{parentName:"li"},"sp.js")," to a random 8 character string to reduce the chance of AdBlockers preventing the script from loading e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"gh7rnghq.js")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"gzip")," the file to reduce the file size and reduce associated cloud storage and egress costs.")),(0,o.kt)("p",null,"From a terminal / command prompt window, navigate to where you have downloaded the file and run:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"gzip -c sp.js > gh7rnghq.js")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"N.B.")," on Windows you may need to ",(0,o.kt)("a",{parentName:"p",href:"http://gnuwin32.sourceforge.net/packages/gzip.htm"},"download the gzip binaries")),(0,o.kt)("p",null,"We will continue referring to the file as ",(0,o.kt)("inlineCode",{parentName:"p"},"sp.js")," throughout this guide, however where ",(0,o.kt)("inlineCode",{parentName:"p"},"sp.js")," is mentioned we are referring to your renamed and gzipped file."),(0,o.kt)("h2",{id:"uploading-to-google-cloud-storage"},"Uploading to Google Cloud Storage"),(0,o.kt)("h3",{id:"create-a-storage-bucket"},"Create a storage bucket"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Navigate to ",(0,o.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/"},"Google Cloud Console")," and ensure you are in the Google Cloud Project that you wish to host the Snowplow JavaScript Tracker in"),(0,o.kt)("li",{parentName:"ol"},"Navigate to the ",(0,o.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/storage/browser"},"Storage section")," of Google Cloud Console"),(0,o.kt)("li",{parentName:"ol"},"Create a new bucket with the following settings")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Option"),(0,o.kt)("th",{parentName:"tr",align:null},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"Name")," (also see ",(0,o.kt)("a",{parentName:"td",href:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/#add-dns-record-for-bucket-optional"},"Add DNS Record for bucket"),")"),(0,o.kt)("td",{parentName:"tr",align:null},"For example, ",(0,o.kt)("inlineCode",{parentName:"td"},"[company-name]-sp-js"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"Storage region")),(0,o.kt)("td",{parentName:"tr",align:null},"Select a suitable region, multi-region offers the widest availability and highest SLAs")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"Storage class")),(0,o.kt)("td",{parentName:"tr",align:null},"Standard")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Access control options"),(0,o.kt)("td",{parentName:"tr",align:null},"Fine grained")))),(0,o.kt)("p",null,"Connecting your domain to your storage bucket (optional)"),(0,o.kt)("p",null,"You may wish to connect your domain to your Cloud Storage bucket. In this case your bucket can be named in the format of a subdomain e.g.",(0,o.kt)("inlineCode",{parentName:"p"},"spassets.acme.com"),"."),(0,o.kt)("p",null,"See ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"#add-dns-record-for-bucket-optional"},"Add DNS Record for bucket"))," for additional step you'll need to take."),(0,o.kt)("h3",{id:"upload-your-file"},"Upload your file"),(0,o.kt)("p",null,"Click ",(0,o.kt)("em",{parentName:"p"},"Upload Files")," and upload your tracker file."),(0,o.kt)("p",null,"Make future upgrades easier"),(0,o.kt)("p",null,"We recommend that you create a folder for each version of the JavaScript tracker to make future updates easier. If you wish to do this then first create a folder corresponding to the version and place your tracker file in that folder."),(0,o.kt)("h3",{id:"set-metadata"},"Set metadata"),(0,o.kt)("p",null,"Open the ",(0,o.kt)("em",{parentName:"p"},"Edit Metadata")," popup using the file menu."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Alter the ",(0,o.kt)("inlineCode",{parentName:"li"},"Content-Encoding")," value to be ",(0,o.kt)("inlineCode",{parentName:"li"},"gzip")),(0,o.kt)("li",{parentName:"ol"},"Alter the ",(0,o.kt)("inlineCode",{parentName:"li"},"Cache-Control")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"max-age=31536000")),(0,o.kt)("li",{parentName:"ol"},"Save the meta data")),(0,o.kt)("h3",{id:"set-permissions"},"Set permissions"),(0,o.kt)("p",null,"Open the ",(0,o.kt)("em",{parentName:"p"},"Edit Permissions")," popup using the file menu."),(0,o.kt)("p",null,"Add a new item in the table, enter the following details and click Save."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Option"),(0,o.kt)("th",{parentName:"tr",align:null},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Entity"),(0,o.kt)("td",{parentName:"tr",align:null},"Group")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Name"),(0,o.kt)("td",{parentName:"tr",align:null},"allUsers")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Access"),(0,o.kt)("td",{parentName:"tr",align:null},"Reader")))),(0,o.kt)("p",null,"Click the link icon next to ",(0,o.kt)("em",{parentName:"p"},"Public to internet")," to get the file URL e.g. ",(0,o.kt)("a",{parentName:"p",href:"https://storage.googleapis.com/company-name-sp-js/gh7rnghq.js"},"https://storage.googleapis.com/company-name-sp-js/gh7rnghq.js"),"\xa0"),(0,o.kt)("h3",{id:"add-dns-record-for-bucket-optional"},"Add DNS Record for bucket (optional)"),(0,o.kt)("p",null,"This will only work correctly if:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"you earlier created your bucket with a name corresponding to the subdomain (see ",(0,o.kt)("a",{parentName:"li",href:"#create-bucket"},"Creating a storage bucket"),") you wish to use"),(0,o.kt)("li",{parentName:"ul"},"you have verified ownership of this domain in Google Cloud: ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/storage/docs/domain-name-verification"},"https://cloud.google.com/storage/docs/domain-name-verification"),".")),(0,o.kt)("p",null,"To connect your domain to your Cloud Storage bucket, you will need to create a ",(0,o.kt)("inlineCode",{parentName:"p"},"CNAME")," record as below:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Option"),(0,o.kt)("th",{parentName:"tr",align:null},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Name"),(0,o.kt)("td",{parentName:"tr",align:null},"[","your domain","]")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Type"),(0,o.kt)("td",{parentName:"tr",align:null},"CNAME")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Data"),(0,o.kt)("td",{parentName:"tr",align:null},"c.storage.googleapis.com.")))),(0,o.kt)("p",null,"CNAME redirection only works on HTTP, to ensure this works on HTTPS you must follow ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/storage/docs/troubleshooting#https"},"this troubleshooting guide"),"."),(0,o.kt)("h2",{id:"update-your-tracking-tags"},"Update your tracking tags"),(0,o.kt)("p",null,"Update any existing tracking tags to point to your self-hosted file URL."))}l.isMDXComponent=!0;const i={title:"Self Hosting the JavaScript Tracker on GCP",date:"2020-04-28",sidebar_position:200},s=void 0,p={unversionedId:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/index",id:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/index",title:"Self Hosting the JavaScript Tracker on GCP",description:"",source:"@site/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud",slug:"/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-on-google-cloud/index.md",tags:[],version:"current",lastUpdatedAt:1660584206,formattedLastUpdatedAt:"Aug 15, 2022",sidebarPosition:200,frontMatter:{title:"Self Hosting the JavaScript Tracker on GCP",date:"2020-04-28",sidebar_position:200},sidebar:"tutorialSidebar",previous:{title:"Self Hosting the JavaScript Tracker on AWS",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/self-hosting-the-javascript-tracker/self-hosting-the-javascript-tracker-aws/"},next:{title:"Third Party CDN Hosting",permalink:"/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/third-party-cdn-hosting/"}},c={},d=[],u={toc:d};function g(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(l,{mdxType:"Block2451"}))}g.isMDXComponent=!0}}]);