<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159566509-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M24XMJD"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-M24XMJD",{anonymize_ip:!0})</script><title data-rh="true">EmrEtlRunner | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="EmrEtlRunner | Snowplow Documentation"><meta data-rh="true" name="description" content="Snowplow EmrEtlRunner is a deprecated application that ran Snowplow&#x27;s batch processing jobs in AWS EMR, such as the RDB shredder. See the RDB loader R35 upgrade guide for how to migrate away from this application."><meta data-rh="true" property="og:description" content="Snowplow EmrEtlRunner is a deprecated application that ran Snowplow&#x27;s batch processing jobs in AWS EMR, such as the RDB shredder. See the RDB loader R35 upgrade guide for how to migrate away from this application."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.17da4835.css">
<link rel="preload" href="/assets/js/runtime~main.a387fc65.js" as="script">
<link rel="preload" href="/assets/js/main.9bff8dd6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link nav-link__first navbar__link--active" href="/docs">Docs</a><a href="https://discourse.snowplowanalytics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://try.snowplowanalytics.com/?utm_content=hero-cta&amp;utm_campaign=snowplow-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button">Try Snowplow</a><a href="https://go.snowplowanalytics.com/l/571483/2021-02-19/3sn5nml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button">Book a demo</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/enriching-your-data">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/modeling-your-data">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/managing-data-quality">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/pipeline-components-and-applications">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/version-compatibility-matrix">Version compatibility matrix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Version compatibility matrix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/stream-collector">Stream Collector</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Collector&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/sqs2kinesis">Sqs2kinesis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Sqs2kinesis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/enrichment-components">Enrichment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enrichment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets">Loaders and storage targets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Loaders and storage targets&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader">S3 Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;S3 Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0">RDB Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;RDB Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-snowflake-loader">Snowflake Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowflake Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/bigquery-loader">BigQuery Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;BigQuery Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/google-cloud-storage-loader">Google Cloud Storage Loader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/elasticsearch-loader">Elasticsearch Loader</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-postgres-loader">Postgres Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Postgres Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/events-manifest-populator">Events Manifest Populator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner">EmrEtlRunner</a><button aria-label="Toggle the collapsible sidebar category &#x27;EmrEtlRunner&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner/common-configuration">Common configuration</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/iglu">Iglu</a><button aria-label="Toggle the collapsible sidebar category &#x27;Iglu&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/dataflow-runner">Dataflow Runner</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/snowplow-mini">Snowplow Mini</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Mini&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/piinguin">Piinguin</a><button aria-label="Toggle the collapsible sidebar category &#x27;Piinguin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/right-to-be-forgotten-spark-application">Right to be Forgotten Spark Application</a><button aria-label="Toggle the collapsible sidebar category &#x27;Right to be Forgotten Spark Application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications"><span itemprop="name">Pipeline Components and Applications</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets"><span itemprop="name">Loaders and storage targets</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">EmrEtlRunner</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>EmrEtlRunner</h1></header><p>Snowplow EmrEtlRunner is a <em>deprecated</em> application that ran Snowplow&#x27;s batch processing jobs in <a href="https://aws.amazon.com/emr/" target="_blank" rel="noopener noreferrer">AWS EMR</a>, such as the <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication">RDB shredder</a>. See the <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/upgrade-guides/r35-upgrade-guide">RDB loader R35 upgrade guide</a> for how to migrate away from this application.</p><p>Historically it was also used for enriching data, but that functionality was deprecated even longer ago in favour of the <a href="/docs/pipeline-components-and-applications/enrichment-components">streaming versions of Enrich</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-emretlrunner">Setting up EmrEtlRunner<a class="hash-link" href="#setting-up-emretlrunner" title="Direct link to heading">​</a></h2><p>This guide covers:</p><ol><li><a href="#installing">Installation</a>. You need to install EmrEtlRunner on your own server. It will interact with Amazon Elastic MapReduce and S3 via the Amazon API</li><li><a href="#using">Usage</a>. How to use EmrEtlRunner at the command line, to instruct it to process data from your collector</li><li><a href="#scheduling">Scheduling</a>. How to schedule the tool so that you always have an up to date set of cleaned, enriched data available for analysis</li><li><a href="#shredding">Configuring shredding</a>. How to configure Snowplow to shred custom self-describing events (also called unstructured events) and contexts ready for loading into dedicated tables in Redshift</li></ol><p>In this guide you&#x27;ll also find additional information:</p><ul><li>A <a href="#technical">deeper technical explanation</a> of EtlEmrRunner</li><li>A guide for <a href="#encryption">setting up end to end encryption</a></li><li>A guide to <a href="#ec2">setting up an EC2 instance</a> for EmrEtlRunner</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-emretlrunner">Installing EmrEtlRunner<a class="hash-link" href="#installing-emretlrunner" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assumptions">Assumptions<a class="hash-link" href="#assumptions" title="Direct link to heading">​</a></h3><p>This guide assumes that you have administrator access to a Unix-based server (e.g. Ubuntu, OS X, Fedora) on which you can install EmrEtlRunner and schedule a regular cronjob.</p><p>You might wish to try out the <a href="https://github.com/snowplow/snowplow/wiki/Setting-up-EC2-instance-for-EmrEtlRunner-and-StorageLoader" target="_blank" rel="noopener noreferrer">steps</a> showing you how an EC2 instance could be set up via <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI</a>.</p><p><em>In theory EmrEtlRunner can be deployed onto a Windows-based server, using the Windows Task Scheduler instead of cron, but this has not been tested or documented.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hardware">Hardware<a class="hash-link" href="#hardware" title="Direct link to heading">​</a></h4><p>You will need to setup EmrEtlRunner on your own server. A number of people choose to do so on an EC2 instance (thereby keeping all of Snowplow in the Amazon Cloud). If you do so, please note that you <strong>must not use a <code>t1.micro</code> instance</strong>. You should at the very least use an <code>m1.small</code> instance.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ec2-key">EC2 key<a class="hash-link" href="#ec2-key" title="Direct link to heading">​</a></h4><p>You will also need an <strong>EC2 key pair</strong> setup in your Amazon EMR account.</p><p>For details on how to do this, please see <a href="http://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/EMR_SetUp_KeyPair.html" target="_blank" rel="noopener noreferrer">Create a Key Pair</a>. Make sure that you setup the EC2 key pair inside the region in which you will be running your ETL jobs.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="s3-locations">S3 locations<a class="hash-link" href="#s3-locations" title="Direct link to heading">​</a></h4><p>EmrEtlRunner processes data through two states:</p><ol><li><strong>:enriched</strong> - Enriched Snowplow events are the input to the EmrEtlRunner process</li><li><strong>:shredded</strong> - EmrEtlRunner shreds JSONs found in enriched events ready for loading into dedicated Redshift tables</li></ol><p>For <code>:enriched:stream</code>, specify the Amazon S3 path you configured for your S3 loader.</p><p>For all other S3 locations, you can specify paths within a single S3 bucket that you setup now.</p><p>Done? Right, now we can install EmrEtlRunner.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">​</a></h3><p>EmrEtlRunner is hosted in the Releases section of the <a href="https://github.com/snowplow/emr-etl-runner/releases" target="_blank" rel="noopener noreferrer">Github repo</a>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ wget https://github.com/snowplow/emr-etl-runner/releases/download/1.0.4/snowplow_emr_1.0.4.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The archive contains both EmrEtlRunner and StorageLoader. Unzip the archive:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ unzip snowplow_emr_{{RELEASE_VERSION}}.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The archive should contain a <code>snowplow-emr-etl-runner</code> file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h3><p>EmrEtlRunner requires a YAML format configuration file to run. There is a configuration file template available in the Snowplow GitHub repository at <a href="https://github.com/snowplow/emr-etl-runner/blob/master/config/config.yml.sample" target="_blank" rel="noopener noreferrer"><code>https://github.com/snowplow/emr-etl-runner/blob/master/config/config.yml.sample</code></a>. See <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner/common-configuration">Common configuration</a> more information on how to write this file.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-targets"><a href="https://github.com/snowplow/snowplow/wiki/1-Installing-EmrEtlRunner#storage-targets" target="_blank" rel="noopener noreferrer"></a>Storage targets<a class="hash-link" href="#storage-targets" title="Direct link to heading">​</a></h4><p>Storages for data can be configured using storage targets JSONs. Configuration file templates available in the Snowplow GitHub repository at <a href="https://github.com/snowplow/snowplow/blob/master/4-storage/config/targets/" target="_blank" rel="noopener noreferrer"><code>/4-storage/config/targets</code> directory</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="iglu"><a href="https://github.com/snowplow/snowplow/wiki/1-Installing-EmrEtlRunner#iglu" target="_blank" rel="noopener noreferrer"></a>Iglu<a class="hash-link" href="#iglu" title="Direct link to heading">​</a></h4><p>You will also need an Iglu resolver configuration file. This is where we list the schema repositories to use to retrieve JSON Schemas for validation. For more information on this, see the <a href="#shredding">wiki page for Configuring shredding</a>.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-emretlrunner">Using EmrEtlRunner<a class="hash-link" href="#using-emretlrunner" title="Direct link to heading">​</a></h2><p>EmrEtlRunner works in <strong>Rolling mode</strong> where it processes whatever raw Snowplow event logs it finds in the In Bucket</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commands">Commands<a class="hash-link" href="#commands" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-command">Run command<a class="hash-link" href="#run-command" title="Direct link to heading">​</a></h4><p>The most useful command is the <code>run</code> command which allows you to actually run your EMR job:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./snowplow-emr-etl-runner run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The available options are as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: run [options]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -c, --config CONFIG              configuration file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -n, --enrichments ENRICHMENTS    enrichments directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -r, --resolver RESOLVER          Iglu resolver file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -t, --targets TARGETS            targets directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -d, --debug                      enable EMR Job Flow debugging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -f {enrich,shred,elasticsearch,archive_raw,rdb_load,analyze,archive_enriched,archive_shredded,staging_stream_enrich},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        --resume-from                resume from the specified step</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -x {staging,enrich,shred,elasticsearch,archive_raw,rdb_load,consistency_check,analyze,load_manifest_check,archive_enriched,archive_shredded,staging_stream_enrich},</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        --skip                       skip the specified step(s)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -i, --include {vacuum}           include additional step(s)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -l, --lock PATH                  where to store the lock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        --ignore-lock-on-start       ignore the lock if it is set when starting</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        --consul ADDRESS             address to the Consul server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the <code>config</code> and <code>resolver</code> options are mandatory.</p><p>Note that in <em>Stream Enrich mode</em> you cannot skip nor resume from <code>staging</code>, <code>enrich</code> and <code>archive_raw</code>. Instead of <code>staging</code> and <code>enrich</code>, in Stream Enrich mode single special <code>staging_stream_enrich</code> is used.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="lint-commands">Lint commands<a class="hash-link" href="#lint-commands" title="Direct link to heading">​</a></h4><p>Other useful commands include the <code>lint</code> commands which allows you to check the validity of your resolver or enrichments with respect to their respective schemas.</p><p>If you want to lint your resolver:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./snowplow-emr-etl-runner lint resolver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The mandatory options are:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: lint resolver [options]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -r, --resolver RESOLVER          Iglu resolver file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you want to lint your enrichments:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./snowplow-emr-etl-runner lint enrichments</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The mandatory options are:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: lint enrichments [options]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -r, --resolver RESOLVER          Iglu resolver file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -n, --enrichments ENRICHMENTS    enrichments directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checking-the-results">Checking the results<a class="hash-link" href="#checking-the-results" title="Direct link to heading">​</a></h3><p>Once you have run the EmrEtlRunner you should be able to manually inspect in S3 the folder specified in the <code>:out:</code> parameter in your <code>config.yml</code> file and see new files generated, which will contain the cleaned data either for uploading into a storage target (e.g. Redshift) or for analysing directly using Hive or Spark or some other querying tool on EMR.</p><p>Note: most Snowplow users run the &#x27;spark&#x27; version of the ETL process, in which case the data generated is saved into subfolders with names of the form <code>part-000...</code>. If, however, you are running the legacy &#x27;hive&#x27; ETL (because e.g. you want to use Hive as your storage target, rather than Redshift, which is the only storage target the &#x27;spark&#x27; etl currently supports), the subfolders names will be of the format <code>dt=...</code>.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-emretlrunner">Scheduling EmrEtlRunner<a class="hash-link" href="#scheduling-emretlrunner" title="Direct link to heading">​</a></h2><p>Once you have the ETL process working smoothly, you can schedule a daily (or more frequent) task to automate the daily ETL process.</p><p>We run our daily ETL jobs at 3 AM UTC so that we are sure that we have processed all of the events from the day before (CloudFront logs can take some time to arrive).</p><p>To consider your different scheduling options in turn:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cron">cron<a class="hash-link" href="#cron" title="Direct link to heading">​</a></h3><p>Warning</p><p>Running EmrEtlRunner as Ruby (rather than JRuby apps) is no longer actively supported.</p><p>The recommended way of scheduling the ETL process is as a daily cronjob.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">0 4   * * *   root    cronic /path/to/eer/snowplow-emr-etl-runner run -c config.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will run the ETL job daily at 4 AM, emailing any failures to you via cronic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jenkins">Jenkins<a class="hash-link" href="#jenkins" title="Direct link to heading">​</a></h3><p>Some developers use the <a href="http://jenkins-ci.org/" target="_blank" rel="noopener noreferrer">Jenkins</a> continuous integration server (or <a href="http://hudson-ci.org/" target="_blank" rel="noopener noreferrer">Hudson</a>, which is very similar) to schedule their Hadoop and Hive jobs.</p><p>Describing how to do this is out of scope for this guide, but the blog post <a href="http://blog.lusis.org/blog/2012/01/23/lowtech-monitoring-with-jenkins/" target="_blank" rel="noopener noreferrer">Lowtech Monitoring with Jenkins</a> is a great tutorial on using Jenkins for non-CI-related tasks, and could be easily adapted to schedule EmrEtlRunner.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-task-scheduler">Windows Task Scheduler<a class="hash-link" href="#windows-task-scheduler" title="Direct link to heading">​</a></h3><p>For Windows servers, in theory it should be possible to use a Windows PowerShell script plus <a href="http://en.wikipedia.org/wiki/Windows_Task_Scheduler#Task_Scheduler_2.0" target="_blank" rel="noopener noreferrer">Windows Task Scheduler</a> instead of bash and cron. However, this has not been tested or documented.</p><p>If you get this working, please let us know!</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-shredding">Configuring shredding<a class="hash-link" href="#configuring-shredding" title="Direct link to heading">​</a></h2><p>Snowplow has a <a href="https://github.com/snowplow/snowplow/wiki/Shredding" target="_blank" rel="noopener noreferrer">Shredding process</a> for Redshift which contributes to the following three phases:</p><ol><li>Extracting unstructured event JSONs and context JSONs from enriched event files into their own files</li><li>Removing endogenous duplicate records, which are sometimes introduced within the Snowplow pipeline (feature added to r76)</li><li>Loading those files into corresponding tables in Redshift</li></ol><p>The first two phases are instrumented by EmrEtlRunner; in this page we will explain how to configure the shredding process to operate smoothly with EmrEtlRunner.</p><p><strong>Note: Even though the first phase is required only if you want to shred your own unstructured event JSONs and context JSONs, the second phase will be beneficial to data modeling and analysis. If none of it is required and you are only shredding Snowplow-authored JSONs like link clicks and ad impressions, then you can skip this page and go straight to <a href="https://github.com/snowplow/snowplow/wiki/4-Loading-shredded-types" target="_blank" rel="noopener noreferrer">Loading shredded types</a>.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">​</a></h3><p>This guide assumes that</p><ul><li><p>all JSONs you are sending as unstructured events and contexts are self-describing JSONs</p></li><li><p>you have defined self-describing JSON Schemas for each of your JSONs</p></li><li><p>you have setup your own Iglu schema registry to host your schemas</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-emretlrunner-for-shredding">Configuring EmrEtlRunner for shredding<a class="hash-link" href="#configuring-emretlrunner-for-shredding" title="Direct link to heading">​</a></h3><p>The relevant section of the EmrEtlRunner&#x27;s <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer"><code>config.yml</code></a> is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shredded:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  good: s3://my-out-bucket/shredded/good       # e.g. s3://my-out-bucket/shredded/good</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bad: s3://my-out-bucket/shredded/bad        # e.g. s3://my-out-bucket/shredded/bad</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  errors: s3://my-out-bucket/shredded/errors     # Leave blank unless :continue_on_unexpected_error: set to true below</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  archive: s3://my-out-bucket/shredded/archive  # Not required for Postgres currently</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The configuration file is referenced with <code>--config</code> option to EmrEtlRunner.</p><p>Please make sure that these shredded buckets are set correctly.</p><p>Next, we let EmrEtlRunner know about your Iglu schema registry, so that schemas can be retrieved from there as well as from Iglu Central. Add your own registry to the repositories array in <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/config/iglu_resolver.json" target="_blank" rel="noopener noreferrer"><code>iglu_resolver.json</code></a> file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.iglu/resolver-config/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;cacheSize&quot;: 500,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;repositories&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;name&quot;: &quot;Iglu Central&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;priority&quot;: 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;vendorPrefixes&quot;: [ &quot;com.snowplowanalytics&quot; ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;connection&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;http&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;uri&quot;: &quot;http://iglucentral.com&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      #custom section starts here --&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      #custom section ends here &lt;--</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You must add an extra entr(-y/ies) in the <code>repositories:</code> array pointing to your own Iglu schema registry. If you are not submitting custom events and contexts and are not interested in shredding then there&#x27;s no need in adding the custom section but the <code>iglu_resolver.json</code> file is still required and is referenced with <code>--resolver</code> option to EmrEtlRunner.</p><p>For more information on how to customize the <code>iglu_resolver.json</code> file, please review the <a href="https://github.com/snowplow/iglu/wiki/Iglu-client-configuration" target="_blank" rel="noopener noreferrer">Iglu client configuration</a> wiki page.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-explanation">Technical explanation<a class="hash-link" href="#technical-explanation" title="Direct link to heading">​</a></h2><p><img loading="lazy" src="/assets/images/emr-etl-runner-steps-f0188e637f63d72b6102a4ec980ca37b.png" width="960" height="720" class="img_ev3q"></p><p>Raw collector logs that need to be processed are identified in the in-bucket. (This is the bucket that the collector log files are generated in: it&#x27;s location is specified in the <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer">EmrEtlRunner config file</a>.)</p><p>EmrEtlRunner then triggers the Enrichment process to run. It spins up an EMR cluster (the size of which is determined by the <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer">config file</a>), uploads the JAR with the Spark Enrichment process on, and instructs EMR to:</p><ol><li>Use S3DistCopy to aggregate the collector log files and write them to HDFS</li><li>Run the Enrichment process on those aggregated files in HDFS</li><li>Write the output of that Enrichment to the Out-bucket in S3. (As specified in the <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer">config file</a>).</li><li>When the job has completed, EmrEtlRunner moves the processed collector log files from the in-bucket to the archive bucket. (This, again, is specified in the <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer">config file</a>.)</li></ol><p>By setting up a <a href="https://github.com/snowplow/snowplow/wiki/3-Scheduling-EmrEtlRunner" target="_blank" rel="noopener noreferrer">scheduling job</a> to run EmrEtlRunner regularly, Snowplow users can ensure that the event data regularly flows through the Snowplow data pipeline from the collector to storage.</p><p>Note: many references are made to the &#x27;Hadoop ETL&#x27; and &#x27;Hive ETL&#x27; in the documentation and the <a href="https://github.com/snowplow/snowplow/blob/master/3-enrich/emr-etl-runner/config/config.yml.sample" target="_blank" rel="noopener noreferrer">config file</a>. &#x27;Hadoop ETL&#x27; refers to the current Spark-based Enrichment Process. &#x27;Hive ETL&#x27; refers to the legacy Hive-based ETL process. EmrEtlRunner can be setup to instrument either. However, we recommend <strong>all</strong> Snowplow users use the Spark based &#x27;Hadoop ETL&#x27;, as it is much more robust, as well as being cheaper to run.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-end-to-end-encryption">Setting up end-to-end encryption<a class="hash-link" href="#setting-up-end-to-end-encryption" title="Direct link to heading">​</a></h2><p>It is possible to setup end-to-end encryption for EmrEtlRunner. For reference, you can check out the dedicated EMR guide: <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-data-encryption-options.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-data-encryption-options.html</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites-1">Pre-requisites<a class="hash-link" href="#pre-requisites-1" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="encrypting-s3-buckets">Encrypting S3 buckets<a class="hash-link" href="#encrypting-s3-buckets" title="Direct link to heading">​</a></h4><p>For at rest encryption on S3, the buckets with which EmrEtlRunner will interact need to have SSE-S3 encryption enabled.</p><p>For more information, check out the dedicated AWS guide: <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/serv-side-encryption.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/AmazonS3/latest/dev/serv-side-encryption.html</a>.</p><p>Keep in mind that turning this setting on is not retroactive. It effectively means that if you want to have only encrypted data in your bucket you will need to go through the existing data and copy it in place.</p><p>Also, if you&#x27;re using the Clojure Collector, SSE-S3 encryption needs to be set up at the bucket level.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-emr-security-configuration">Setting up an EMR security configuration<a class="hash-link" href="#setting-up-an-emr-security-configuration" title="Direct link to heading">​</a></h4><p>Through an EMR security configuraton, you can specify at the EMR level for which parts of your job you want encryption to be enforced, the possibilities are:</p><ul><li>At rest on S3</li><li>At rest on local disks</li><li>In-transit</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="at-rest-encryption-in-s3">At rest encryption in S3<a class="hash-link" href="#at-rest-encryption-in-s3" title="Direct link to heading">​</a></h4><p>Once setup, S3 encrypts data as it writes it to disk.</p><p>By default, even without encryption setup, data is encrypted while in transit from EMR to S3 (e.g. for s3-dist-cp steps).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="at-rest-encryption-on-local-disks">At rest encryption on local disks<a class="hash-link" href="#at-rest-encryption-on-local-disks" title="Direct link to heading">​</a></h4><p>When running the Snowplow pipeline in EMR, an HDFS is setup on the different nodes of your cluster. Enabling encryption for the disks local to those nodes will have the following effects:</p><ul><li>HDFS RPC, e.g. between name node and data node, uses SASL</li><li>HDFS block transfers (e.g. replication) are encrypted using AES 256</li><li>Attached EBS volumes are encrypted using <a href="https://guardianproject.info/code/luks/" target="_blank" rel="noopener noreferrer">LUKS</a></li></ul><p>When enabling this option, please keep the following drawbacks in mind:</p><ul><li>EBS root volumes are not encrypted, you need to use a custom AMI for that: <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-custom-ami.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-custom-ami.html</a></li><li>KMS key usage is subject to pricing: <a href="https://aws.amazon.com/kms/pricing/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/kms/pricing/</a></li><li>It has a performance impact (e.g. when writing your enriched data to HDFS)</li></ul><p>To set this type of encryption up you will need to create an appropriate KMS key, refer to the AWS guide for more information: <a href="https://docs.aws.amazon.com/kms/latest/developerguide/create-keys.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/kms/latest/developerguide/create-keys.html</a>.</p><p>It is important to note that the role used in <code>aws:emr:jobflow_role</code> in the EmrEtlRunner configuration needs to have the <code>kms:GenerateDataKey</code> policy.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-transit-encryption-spark-and-mapreduce">In-transit encryption (Spark and MapReduce)<a class="hash-link" href="#in-transit-encryption-spark-and-mapreduce" title="Direct link to heading">​</a></h4><p>When running the Spark jobs of the Snowplow pipeline (enrich and shred) or consolidating s3-dist-cp steps (e.g. using <code>--groupBy</code> or <code>--targetSize</code>), data is shuffled around the different nodes in your EMR cluster. Enabling encryption for those data movements will have the following effects:</p><ul><li>MapReduce shuffles use TLS</li><li>RPC and data transfers in Spark are encrypted using AES 256 if emr &gt;= 5.9.0, otherwise RPC is encrypted using SASL</li><li>SSL is enabled for all things HTTP in Spark (e.g. history server and UI)</li></ul><p>Be aware that this type of encryption also has a performance impact as data needs to be encrypted when sent over the network (e.g. when running deduplication in the Shred job).</p><p>To set up this type of encryption, you will need to create certificates according to the guidelines specified at <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-encryption-enable.html#emr-encryption-pem-certificate" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-encryption-enable.html#emr-encryption-pem-certificate</a>.</p><p>Note that, for this type of encryption to work, you will need to be in a VPC and the domain name specified in the certificates needs to be <code>*.ec2.internal</code> if in us-east-1 or <code>*.region.compute.internal</code> otherwise.</p><p>For more information, on all those types of encryption, you can refer to the dedicated guide: <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-create-security-configuration.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-create-security-configuration.html</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-emretlrunner-for-end-to-end-encryption">Configuring EmrEtlRunner for end-to-end encryption<a class="hash-link" href="#configuring-emretlrunner-for-end-to-end-encryption" title="Direct link to heading">​</a></h3><p>To leverage the security configuration you created, you will need to specify it in the EmrEtlRunner configuration at: <code>aws:emr:security_configuration</code>.</p><p>Additionally, you will need to tell EmrEtlRunner that it will have to interact with encrypted buckets through: <code>aws:s3:buckets:encrypted: true</code>.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-ec2-instance-for-emretlrunner-and-storageloader">Setting up EC2 instance for EmrEtlRunner and StorageLoader<a class="hash-link" href="#setting-up-ec2-instance-for-emretlrunner-and-storageloader" title="Direct link to heading">​</a></h2><p>This tutorial assumes it&#x27;s your first installation and you probably just want to checkout the platform. Thus many steps describe low-performance and unsecured installation. In real-world scenario you may want to fix that.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-your-system"><a href="https://github.com/snowplow/snowplow/wiki/Setting-up-EC2-instance-for-EmrEtlRunner-and-StorageLoader#prepare-your-system" target="_blank" rel="noopener noreferrer"></a>Prepare your system<a class="hash-link" href="#prepare-your-system" title="Direct link to heading">​</a></h3><p>Before getting started you need to have:</p><ul><li>Account on <a href="http://aws.amazon.com/" target="_blank" rel="noopener noreferrer">Amazon Web Services</a>.</li><li>Installed <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI</a>.</li><li>IAM user, first one need to be created in <a href="https://console.aws.amazon.com/iam/home?#users" target="_blank" rel="noopener noreferrer">AWS Console</a>.</li><li>IAM user need to have attached <code>AdministratorAccess</code>.</li><li>Configured credentials on your local machine. (You can use <code>aws configure</code> for it).</li><li>For some steps you may want to install <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener noreferrer"><code>jq</code></a>. It&#x27;s optional, but handy.</li></ul><p>Everything else can be done from CLI.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-ec2-instance-for-emretlrunnerstorageloader"><a href="https://github.com/snowplow/snowplow/wiki/Setting-up-EC2-instance-for-EmrEtlRunner-and-StorageLoader#setting-up-ec2-instance-for-emretlrunnerstorageloader" target="_blank" rel="noopener noreferrer"></a>Setting up EC2 instance for EmrEtlRunner/StorageLoader<a class="hash-link" href="#setting-up-ec2-instance-for-emretlrunnerstorageloader" title="Direct link to heading">​</a></h3><p>In the end of this step, you&#x27;ll have an AWS EC2 instance, SSH access to it and key stored on local machine.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="find-your-default-vpc-id"><strong>Find your Default VPC ID</strong><a class="hash-link" href="#find-your-default-vpc-id" title="Direct link to heading">​</a></h3><p>We will refer to it as <code>{{ VPC_ID }}</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 describe-vpcs | jq -r &quot;.Vpcs[0].VpcId&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>NOTE</strong>: This step assumes the default VPC will be first in the list. If your environment has multiple VPCs, run the describe command without piping it to <code>jq</code> to get the ID of the default VPC. Mixing VPC IDs will result in the creation of an unreachable EC2 instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-security-group-for-ssh-access"><strong>Create Security Group for SSH access</strong><a class="hash-link" href="#create-security-group-for-ssh-access" title="Direct link to heading">​</a></h3><p>On output you&#x27;ll get <code>GroupId</code>. We will refer to it as <code>{{ SSH_SG }}</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 create-security-group \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --group-name &quot;EC2 SSH full access&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --description &quot;Unsafe. Use for demonstration only&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --vpc-id {{ VPC_ID }} \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | jq -r &#x27;.GroupId&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-rule-allowing-ssh-access-from-anywhere"><strong>Add rule allowing SSH access from anywhere</strong><a class="hash-link" href="#add-rule-allowing-ssh-access-from-anywhere" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 authorize-security-group-ingress \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --group-id {{ SSH_SG }} \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --protocol tcp \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --port 22 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --cidr 0.0.0.0/0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-ssh-key-pair-named-on-the-local-machine"><strong>Create SSH key-pair named on the local machine</strong><a class="hash-link" href="#create-ssh-key-pair-named-on-the-local-machine" title="Direct link to heading">​</a></h3><p>We named it &quot;snowplow-ec2&quot; here.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 create-key-pair --key-name snowplow-ec2 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | jq -r &quot;.KeyMaterial&quot; &amp;gt; ~/.ssh/snowplow-ec2.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ chmod go-rwx ~/.ssh/snowplow-ec2.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-t2small-instance-with-amazon-linux-ami-with-previously-created-ssh-key"><strong>Run t2.small instance with Amazon Linux AMI with previously created SSH-key</strong><a class="hash-link" href="#run-t2small-instance-with-amazon-linux-ami-with-previously-created-ssh-key" title="Direct link to heading">​</a></h3><p>On output you will get your instance id. We will refer to it as <code>{{ INSTANCE_ID }}</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 run-instances \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --image-id ami-60b6c60a \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --count 1 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --instance-type t2.small \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --key-name snowplow-ec2 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | jq -r &#x27;.Instances[0].InstanceId&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>NOTE: you can find available image ID by following this <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/finding-an-ami.html" target="_blank" rel="noopener noreferrer">AWS guide</a>.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="attach-security-group-to-instance"><strong>Attach security group to Instance</strong><a class="hash-link" href="#attach-security-group-to-instance" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 modify-instance-attribute \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --instance-id {{ INSTANCE_ID }} \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --groups {{ SSH_SG }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-public-ip-address-of-newly-created-instance"><strong>Check public IP-address of newly created Instance</strong><a class="hash-link" href="#check-public-ip-address-of-newly-created-instance" title="Direct link to heading">​</a></h3><p>Further we will refer to it as <code>{{ PUBLIC_IP }}</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ aws ec2 describe-instances \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --instance-ids {{ INSTANCE_ID }} \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | jq &#x27;.Reservations[0].Instances[0].PublicDnsName&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-in"><strong>Log-in</strong><a class="hash-link" href="#log-in" title="Direct link to heading">​</a></h3><p>Fill-in <code>{{ PUBLIC_IP }}</code> from previous step.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ssh -i ~/.ssh/snowplow-ec2.pem ec2-user@{{ PUBLIC_IP }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-24T14:45:56.000Z">Aug 24, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/pipeline-components-and-applications/loaders-storage-targets/events-manifest-populator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Events Manifest Populator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner/common-configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Common configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-emretlrunner" class="table-of-contents__link toc-highlight">Setting up EmrEtlRunner</a></li><li><a href="#installing-emretlrunner" class="table-of-contents__link toc-highlight">Installing EmrEtlRunner</a><ul><li><a href="#assumptions" class="table-of-contents__link toc-highlight">Assumptions</a></li><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li><li><a href="#using-emretlrunner" class="table-of-contents__link toc-highlight">Using EmrEtlRunner</a><ul><li><a href="#commands" class="table-of-contents__link toc-highlight">Commands</a></li><li><a href="#checking-the-results" class="table-of-contents__link toc-highlight">Checking the results</a></li></ul></li><li><a href="#scheduling-emretlrunner" class="table-of-contents__link toc-highlight">Scheduling EmrEtlRunner</a><ul><li><a href="#cron" class="table-of-contents__link toc-highlight">cron</a></li><li><a href="#jenkins" class="table-of-contents__link toc-highlight">Jenkins</a></li><li><a href="#windows-task-scheduler" class="table-of-contents__link toc-highlight">Windows Task Scheduler</a></li></ul></li><li><a href="#configuring-shredding" class="table-of-contents__link toc-highlight">Configuring shredding</a><ul><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#configuring-emretlrunner-for-shredding" class="table-of-contents__link toc-highlight">Configuring EmrEtlRunner for shredding</a></li></ul></li><li><a href="#technical-explanation" class="table-of-contents__link toc-highlight">Technical explanation</a></li><li><a href="#setting-up-end-to-end-encryption" class="table-of-contents__link toc-highlight">Setting up end-to-end encryption</a><ul><li><a href="#pre-requisites-1" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#configuring-emretlrunner-for-end-to-end-encryption" class="table-of-contents__link toc-highlight">Configuring EmrEtlRunner for end-to-end encryption</a></li></ul></li><li><a href="#setting-up-ec2-instance-for-emretlrunner-and-storageloader" class="table-of-contents__link toc-highlight">Setting up EC2 instance for EmrEtlRunner and StorageLoader</a><ul><li><a href="#prepare-your-system" class="table-of-contents__link toc-highlight">Prepare your system</a></li><li><a href="#setting-up-ec2-instance-for-emretlrunnerstorageloader" class="table-of-contents__link toc-highlight">Setting up EC2 instance for EmrEtlRunner/StorageLoader</a></li><li><a href="#find-your-default-vpc-id" class="table-of-contents__link toc-highlight"><strong>Find your Default VPC ID</strong></a></li><li><a href="#create-security-group-for-ssh-access" class="table-of-contents__link toc-highlight"><strong>Create Security Group for SSH access</strong></a></li><li><a href="#add-rule-allowing-ssh-access-from-anywhere" class="table-of-contents__link toc-highlight"><strong>Add rule allowing SSH access from anywhere</strong></a></li><li><a href="#create-ssh-key-pair-named-on-the-local-machine" class="table-of-contents__link toc-highlight"><strong>Create SSH key-pair named on the local machine</strong></a></li><li><a href="#run-t2small-instance-with-amazon-linux-ami-with-previously-created-ssh-key" class="table-of-contents__link toc-highlight"><strong>Run t2.small instance with Amazon Linux AMI with previously created SSH-key</strong></a></li><li><a href="#attach-security-group-to-instance" class="table-of-contents__link toc-highlight"><strong>Attach security group to Instance</strong></a></li><li><a href="#check-public-ip-address-of-newly-created-instance" class="table-of-contents__link toc-highlight"><strong>Check public IP-address of newly created Instance</strong></a></li><li><a href="#log-in" class="table-of-contents__link toc-highlight"><strong>Log-in</strong></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a387fc65.js"></script>
<script src="/assets/js/main.9bff8dd6.js"></script>
</body>
</html>