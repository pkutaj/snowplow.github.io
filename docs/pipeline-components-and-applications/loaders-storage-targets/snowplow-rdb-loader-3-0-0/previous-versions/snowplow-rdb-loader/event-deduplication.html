<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159566509-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M24XMJD"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-M24XMJD",{anonymize_ip:!0})</script><title data-rh="true">Event deduplication | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Event deduplication | Snowplow Documentation"><meta data-rh="true" name="description" content="Duplicates is a common problem in event pipelines, it has been described and studied many times. Basically, the problem is that we cannot guarantee that every event has a unique UUID because"><meta data-rh="true" property="og:description" content="Duplicates is a common problem in event pipelines, it has been described and studied many times. Basically, the problem is that we cannot guarantee that every event has a unique UUID because"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.17da4835.css">
<link rel="preload" href="/assets/js/runtime~main.a387fc65.js" as="script">
<link rel="preload" href="/assets/js/main.9bff8dd6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link nav-link__first navbar__link--active" href="/docs">Docs</a><a href="https://discourse.snowplowanalytics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://try.snowplowanalytics.com/?utm_content=hero-cta&amp;utm_campaign=snowplow-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button">Try Snowplow</a><a href="https://go.snowplowanalytics.com/l/571483/2021-02-19/3sn5nml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button">Book a demo</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/enriching-your-data">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/modeling-your-data">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/managing-data-quality">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/pipeline-components-and-applications">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/version-compatibility-matrix">Version compatibility matrix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Version compatibility matrix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/stream-collector">Stream Collector</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Collector&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/sqs2kinesis">Sqs2kinesis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Sqs2kinesis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/enrichment-components">Enrichment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enrichment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets">Loaders and storage targets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Loaders and storage targets&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader">S3 Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;S3 Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0">RDB Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;RDB Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data">Transforming enriched data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transforming enriched data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data">Loading transformed data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Loading transformed data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions">Previous versions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Previous versions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader-2">RDB Loader 2.x.x</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/shredding-overview">snowplow-rdb-loader</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/shredding-overview">Shredding Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication">Event deduplication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/dynamodb-table">DynamoDB Table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/run-the-rdb-shredder">Run the RDB shredder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/run-the-rdb-loader">Run the RDB loader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/monitoring">RDB loader monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/configuration-reference">RDB loader configuration reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/rdb-shredder-configuration-reference">RDB shredder configuration reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/upgrade-guides">Upgrade Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgrade Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-snowflake-loader">Snowflake Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowflake Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/bigquery-loader">BigQuery Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;BigQuery Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/google-cloud-storage-loader">Google Cloud Storage Loader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/elasticsearch-loader">Elasticsearch Loader</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-postgres-loader">Postgres Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Postgres Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/events-manifest-populator">Events Manifest Populator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner">EmrEtlRunner</a><button aria-label="Toggle the collapsible sidebar category &#x27;EmrEtlRunner&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/iglu">Iglu</a><button aria-label="Toggle the collapsible sidebar category &#x27;Iglu&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/dataflow-runner">Dataflow Runner</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/snowplow-mini">Snowplow Mini</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Mini&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/piinguin">Piinguin</a><button aria-label="Toggle the collapsible sidebar category &#x27;Piinguin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/right-to-be-forgotten-spark-application">Right to be Forgotten Spark Application</a><button aria-label="Toggle the collapsible sidebar category &#x27;Right to be Forgotten Spark Application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications"><span itemprop="name">Pipeline Components and Applications</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets"><span itemprop="name">Loaders and storage targets</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0"><span itemprop="name">RDB Loader</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions"><span itemprop="name">Previous versions</span></a><meta itemprop="position" content="4"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">snowplow-rdb-loader</span><meta itemprop="position" content="5"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Event deduplication</span><meta itemprop="position" content="6"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Event deduplication</h1></header><p>Duplicates is a common problem in event pipelines, it has been described and studied <a href="http://snowplowanalytics.com/blog/2015/08/19/dealing-with-duplicate-event-ids/" target="_blank" rel="noopener noreferrer">many</a> <a href="http://snowplowanalytics.com/blog/2016/01/26/snowplow-r76-changeable-hawk-eagle-released/#deduplication" target="_blank" rel="noopener noreferrer">times</a>. Basically, the problem is that we cannot guarantee that every event has a unique <code>UUID</code> because</p><ol><li>we have no exactly-once delivery guarantees</li><li>user-side software can send events more than once</li><li>we have to rely on flawed <a href="http://snowplowanalytics.com/blog/2016/01/26/snowplow-r76-changeable-hawk-eagle-released/#deduplication" target="_blank" rel="noopener noreferrer">algorithms</a></li></ol><p>There are four strategies planned regarding incorporating deduplication mechanisms in RDB Shredder:</p><table><thead><tr><th>Strategy</th><th>Batch?</th><th>Same event ID?</th><th>Same event fingerprint?</th><th>Availability</th></tr></thead><tbody><tr><td>In-batch natural de-duplication</td><td>In-batch</td><td>Yes</td><td>Yes</td><td><a href="http://snowplowanalytics.com/blog/2016/01/26/snowplow-r76-changeable-hawk-eagle-released/#deduplication" target="_blank" rel="noopener noreferrer">R76 Changeable Hawk-Eagle</a></td></tr><tr><td>In-batch synthetic de-duplication</td><td>In-batch</td><td>Yes</td><td>No</td><td><a href="http://snowplowanalytics.com/blog/2016/12/20/snowplow-r86-petra-released/" target="_blank" rel="noopener noreferrer">R86 Petra</a></td></tr><tr><td>Cross-batch natural de-duplication</td><td>Cross-batch</td><td>Yes</td><td>Yes</td><td><a href="http://snowplowanalytics.com/blog/2017/04/27/snowplow-r88-angkor-wat-released/" target="_blank" rel="noopener noreferrer">R88 Angkor Wat</a></td></tr><tr><td>Cross-batch synthetic de-duplication</td><td>Cross-batch</td><td>Yes</td><td>No</td><td>Planned</td></tr></tbody></table><p>We will cover these in turn:<a href="https://github.com/snowplow/snowplow/wiki/Relational-Database-Shredder#41-in-batch-natural-de-duplication" target="_blank" rel="noopener noreferrer"></a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-batch-natural-de-duplication">In-batch natural de-duplication<a class="hash-link" href="#in-batch-natural-de-duplication" title="Direct link to heading">​</a></h4><p>As of <a href="http://snowplowanalytics.com/blog/2016/01/26/snowplow-r76-changeable-hawk-eagle-released/#deduplication" target="_blank" rel="noopener noreferrer">the R76 Changeable Eagle-Hawk release</a>, RDP de-duplicates &quot;natural duplicates&quot;</p><ul><li>i.e. events which share the same event ID (<code>event_id</code>) and the same event payload (based by <code>event_fingerprint</code>), meaning that they are semantically identical to each other. For a given ETL run (batch) of events being processed, RDB Shredder keeps only the first out of each group of natural duplicates; all others will be discarded.</li></ul><p>To enable this functionality you need to have <a href="https://github.com/snowplow/snowplow/wiki/Event-fingerprint-enrichment" target="_blank" rel="noopener noreferrer">the Event Fingerprint Enrichment</a> enabled in order to correctly populate the <code>event_fingerprint</code> property.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-batch-synthetic-de-duplication">In-batch synthetic de-duplication<a class="hash-link" href="#in-batch-synthetic-de-duplication" title="Direct link to heading">​</a></h4><p>As of <a href="http://snowplowanalytics.com/blog/2016/12/20/snowplow-r86-petra-released/" target="_blank" rel="noopener noreferrer">the R86 Petra</a>, RDP de-duplicates &quot;synthetic duplicates&quot; - i.e. events which share the same event ID (<code>event_id</code>), but have different event payload (based on <code>event_fingerprint</code>), meaning that they can be either semantically independent events (caused by the flawed algorithms discussed above) or the same events with slightly different payloads (caused by third-party software). For a given ETL run (batch) of events being processed, RDB Shredder uses the following strategy:</p><ol><li>Collect all the events with identical <code>event_id</code> which are left after natural-deduplication</li><li>Generate new random <code>event_id</code> for each of them</li><li>Create a <a href="https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/duplicate/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer"><code>duplicate</code></a> context with the original <code>event_id</code> for each event where the duplicated <code>event_id</code> was found</li></ol><p>There is no configuration required for this functionality - de-duplication is performed automatically in RDB Shredder, but it is highly recommended to use the <a href="https://github.com/snowplow/snowplow/wiki/Event-fingerprint-enrichment" target="_blank" rel="noopener noreferrer">Event Fingerprint Enrichment</a> in order to correctly populate the <code>event_fingerprint</code> property.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cross-batch-natural-de-duplication">Cross-batch natural de-duplication<a class="hash-link" href="#cross-batch-natural-de-duplication" title="Direct link to heading">​</a></h4><p>With cross-batch natural de-duplication, we have to face a new issue: we need to track events across multiple ETL batches to detect duplicates. We don&#x27;t need to store the whole event - just the <code>event_id</code> and the <code>event_fingerprint</code> metadata. We also need to store these in a database that allows fast random access - we chose Amazon DynamoDB, a fully managed NoSQL database service.</p><p>Cross-batch natural deduplication implemented in both RDB Shredder and Snowflake Transformer on top <a href="https://github.com/snowplow-incubator/snowplow-events-manifest" target="_blank" rel="noopener noreferrer">Snowplow Events Manifest</a> Scala library.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="dynamodb-table-design">DynamoDB table design<a class="hash-link" href="#dynamodb-table-design" title="Direct link to heading">​</a></h5><p>We store the event metadata in a DynamoDB table with the following attributes:</p><ul><li><code>eventId</code>, a String</li><li><code>fingerprint</code>, a String</li><li><code>etlTime</code>, a Date</li><li><code>ttl</code>, a Date</li></ul><p>A lookup into this table will tell us if the event we are looking for has been seen before based on <code>event_id</code> and <code>event_fingerprint</code>.</p><p>We store the <code>etl_timestamp</code> to prevent issues in the case of a failed run. If a run fails and is then rerun, we don&#x27;t want the rerun to consider rows in the DynamoDB table which were written as part of the prior failed run; otherwise all events in the rerun would be rejected as dupes!</p><p><strong>WARNING</strong> Due used algorithm in cross-batch deduplication, we strictly discourage anyone from deleting <code>enriched/good</code> folder, as pipeline recovery step after RDB Shred job has started. Reprocessing known <code>eventId</code>s and <code>fingerprint</code>s will mark events as duplicates and therefore will result in <strong>data loss</strong>.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-and-set-algorithm">Check-and-set algorithm<a class="hash-link" href="#check-and-set-algorithm" title="Direct link to heading">​</a></h5><p>It is clear as to when we need to read the event metadata from DynamoDB: during the RDB Shredder process. But when do we write the event metadata for this run back to DynamoDB? Instead of doing all the reads and then doing all the writes, we decided to use DynamoDB&#x27;s <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.ConditionalUpdate" target="_blank" rel="noopener noreferrer">conditional updates</a> to perform a check-and-set operation inside RDB Shredder, on a per-event basis.</p><p>The algorithm is simple:</p><ul><li>Attempt to write the <code>event_id-event_fingerprint-etl_timestamp</code> triple to DynamoDB <strong>but only if</strong> the <code>event_id-event_fingerprint</code> pair cannot be found with an earlier <code>etl_timestamp</code> than the provided one</li><li>If the write fails, we have a natural duplicate</li><li>If the write succeeds, we know we have an event which is not a natural duplicate (it could still be a synthetic duplicate however)</li></ul><p>If we discover a natural duplicate, we delete it. We know that we have an &quot;original&quot; of this event already safely in Redshift (because we have found it in DynamoDB).</p><p>In the code, we perform this check after we have grouped the batch by <code>event_id</code> and <code>event_fingerprint</code>; this ensures that all check-and-set requests to a specific <code>event_id-event_fingerprint</code> pair in DynamoDB will come from a single mapper.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="enabling">Enabling<a class="hash-link" href="#enabling" title="Direct link to heading">​</a></h5><p>To enable cross-batch natural de-duplication you must provide a DynamoDB table <a href="https://github.com/snowplow/snowplow/wiki/Configuring-storage-targets#dynamodb" target="_blank" rel="noopener noreferrer">configuration</a> to EmrEtlRunner and provide <a href="https://github.com/snowplow/snowplow/wiki/Setting-up-Amazon-DynamoDB" target="_blank" rel="noopener noreferrer">necessary rights</a> in IAM. If this is not provided, then cross-batch natural de-duplication will be disabled. In-batch de-duplication will still work however.</p><p>To avoid &quot;cold start&quot; problems you may want to use the <a href="https://github.com/snowplow/snowplow/wiki/Event-manifest-populator" target="_blank" rel="noopener noreferrer">Event-manifest-populator</a> Spark job, which backpopulates duplicate storage with events from the specified point in time.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="table-cleanup">Table cleanup<a class="hash-link" href="#table-cleanup" title="Direct link to heading">​</a></h5><p>To make sure the DynamoDB table is not going to be overpopulated we&#x27;re using <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/TTL.html" target="_blank" rel="noopener noreferrer">the DynamoDB Time-to-Live</a> feature, which provides automatic cleanup after the specified time. For event manifests this time is the etl timestamp plus 180 days and stored in the <code>ttl</code> attribute.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="costs-and-performance-penalty">Costs and performance penalty<a class="hash-link" href="#costs-and-performance-penalty" title="Direct link to heading">​</a></h5><p>Cross-batch deduplication uses DynamoDB as transient storage and therefore has associated AWS costs. Default write capacity is 100 units, which means no matter how powerful your EMR cluster is - whole RDB Shredder can be throttled by AWS DynamoDB. The rough cost of the default setup is 50USD per month, however throughput can be <a href="https://github.com/snowplow/snowplow/wiki/Setting-up-Amazon-DynamoDB" target="_blank" rel="noopener noreferrer">tweaked</a> according to your needs.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/event-deduplication/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-24T14:45:56.000Z">Aug 24, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/shredding-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Shredding Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions/snowplow-rdb-loader/dynamodb-table"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DynamoDB Table</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a387fc65.js"></script>
<script src="/assets/js/main.9bff8dd6.js"></script>
</body>
</html>