<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159566509-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M24XMJD"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-M24XMJD",{anonymize_ip:!0})</script><title data-rh="true">Spark transformer | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spark transformer | Snowplow Documentation"><meta data-rh="true" name="description" content="For a high-level overview of the Transform process, see Transforming enriched data. For guidance on picking the right transformer app, see How to pick a transformer."><meta data-rh="true" property="og:description" content="For a high-level overview of the Transform process, see Transforming enriched data. For guidance on picking the right transformer app, see How to pick a transformer."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a6feea07.css">
<link rel="preload" href="/assets/js/runtime~main.9e6ea025.js" as="script">
<link rel="preload" href="/assets/js/main.957d7bc5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link nav-link__first customized_AOMy navbar__link--active" href="/docs">Docs</a><a href="https://discourse.snowplowanalytics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://try.snowplowanalytics.com/?utm_content=hero-cta&amp;utm_campaign=snowplow-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Try Snowplow</a><a href="https://go.snowplowanalytics.com/l/571483/2021-02-19/3sn5nml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Book a demo</a><div class="toggle_vylO extraSpace_k8HL"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG extraPadding_YQbj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/enriching-your-data">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/modeling-your-data">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/managing-data-quality">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/pipeline-components-and-applications">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/version-compatibility-matrix">Version compatibility matrix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Version compatibility matrix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/stream-collector">Stream Collector</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Collector&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/sqs2kinesis">Sqs2kinesis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Sqs2kinesis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/enrichment-components">Enrichment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enrichment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets">Loaders and storage targets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Loaders and storage targets&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader">S3 Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;S3 Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0">RDB Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;RDB Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data">Transforming enriched data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transforming enriched data&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer">Spark transformer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/stream-transformer">Stream transformer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/deduplication">Deduplication</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/rdb-transformer-configuration-reference">RDB Transformer configuration reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;RDB Transformer configuration reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data">Loading transformed data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Loading transformed data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/previous-versions">Previous versions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Previous versions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-snowflake-loader">Snowflake Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowflake Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/bigquery-loader">BigQuery Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;BigQuery Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/google-cloud-storage-loader">Google Cloud Storage Loader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/elasticsearch-loader">Elasticsearch Loader</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-postgres-loader">Postgres Loader</a><button aria-label="Toggle the collapsible sidebar category &#x27;Postgres Loader&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/events-manifest-populator">Events Manifest Populator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/loaders-storage-targets/emr-etl-runner">EmrEtlRunner</a><button aria-label="Toggle the collapsible sidebar category &#x27;EmrEtlRunner&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/iglu">Iglu</a><button aria-label="Toggle the collapsible sidebar category &#x27;Iglu&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pipeline-components-and-applications/dataflow-runner">Dataflow Runner</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/snowplow-mini">Snowplow Mini</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Mini&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/piinguin">Piinguin</a><button aria-label="Toggle the collapsible sidebar category &#x27;Piinguin&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/pipeline-components-and-applications/right-to-be-forgotten-spark-application">Right to be Forgotten Spark Application</a><button aria-label="Toggle the collapsible sidebar category &#x27;Right to be Forgotten Spark Application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications"><span itemprop="name">Pipeline Components and Applications</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets"><span itemprop="name">Loaders and storage targets</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0"><span itemprop="name">RDB Loader</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data"><span itemprop="name">Transforming enriched data</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spark transformer</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spark transformer</h1></header><p><em>For a high-level overview of the Transform process, see <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data">Transforming enriched data</a>. For guidance on picking the right <code>transformer</code> app, see <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0#how-to-pick-a-transformer">How to pick a transformer</a>.</em></p><p>The Spark-based transformer is a batch job designed to be deployed in an EMR cluster and process a bounded data set stored on S3.</p><p>In order to run it, you will need:</p><ul><li>the <code>snowplow-transformer-batch</code> jar file (from version 3.0.0 this replaces the <code>snowplow-rdb-shredder</code> asset)</li><li>configuration files for the jar file</li><li>an EMR cluster specification</li><li>a way to spin up an EMR cluster and submit a job to it.</li></ul><p>You can use any suitable tool to periodically submit the transformer job to an EMR cluster. We recommend you use our purpose-built <a href="https://github.com/snowplow/dataflow-runner" target="_blank" rel="noopener noreferrer">Dataflow Runner</a> tool. All the examples below assume that Dataflow Runner is being used. Refer to the app&#x27;s <a href="/docs/pipeline-components-and-applications/dataflow-runner">documentation</a> for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="downloading-the-artefact">Downloading the artefact<a class="hash-link" href="#downloading-the-artefact" title="Direct link to heading">​</a></h2><p>The asset is published as a jar file attached to the <a href="https://github.com/snowplow/snowplow-rdb-loader/releases" target="_blank" rel="noopener noreferrer">Github release notes</a> for each version.</p><p>It&#x27;s also available in several S3 buckets that are accessible to an EMR cluster:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3://snowplow-hosted-assets/4-storage/transformer-batch/snowplow-transformer-batch-4.1.0.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- or --</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3://snowplow-hosted-{{ region }}/4-storage/transformer-batch/snowplow-transformer-batch-4.1.0.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where <code>region</code> is one of <code>us-east-1</code>, <code>us-east-2</code>, <code>us-west-1</code>, <code>us-west-2</code>, <code>eu-central-1</code>, <code>eu-west-2</code>, <code>ca-central-1</code>, <code>sa-east-1</code>, <code>ap-southeast-1</code>, <code>ap-southeast-2</code>, <code>ap-northeast-1</code>, <code>ap-northeast-2</code>, or <code>ap-south-1</code>. Pick the region of your EMR cluster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-emr-cluster">Configuring the EMR cluster<a class="hash-link" href="#configuring-the-emr-cluster" title="Direct link to heading">​</a></h2><p>Here&#x27;s an example of an EMR cluster config file that can be used with Dataflow Runner:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.dataflowrunner/ClusterConfig/avro/1-1-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;name&quot;: &quot;RDB Transformer&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;region&quot;: &quot;eu-central-1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;logUri&quot;: &quot;s3://com-acme/logs/&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;credentials&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;accessKeyId&quot;: &quot;env&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;secretAccessKey&quot;: &quot;env&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;roles&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;jobflow&quot;: &quot;EMR_EC2_DefaultRole&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;service&quot;: &quot;EMR_DefaultRole&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ec2&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;amiVersion&quot;: &quot;6.2.0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;keyName&quot;: &quot;ec2-key-name&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;location&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;vpc&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;subnetId&quot;: &quot;subnet-id&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;instances&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;master&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;type&quot;: &quot;m4.large&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;ebsConfiguration&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;ebsOptimized&quot;: true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;ebsBlockDeviceConfigs&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;core&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;type&quot;: &quot;r4.xlarge&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;count&quot;: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;task&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;type&quot;: &quot;m4.large&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;count&quot;: 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;bid&quot;: &quot;0.015&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;tags&quot;: [],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;bootstrapActionConfigs&quot;: [],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;configurations&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;classification&quot;: &quot;core-site&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;Io.file.buffer.size&quot;: &quot;65536&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;configurations&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;classification&quot;: &quot;yarn-site&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;yarn.nodemanager.resource.memory-mb&quot;: &quot;57344&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;yarn.scheduler.maximum-allocation-mb&quot;: &quot;57344&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;yarn.nodemanager.vmem-check-enabled&quot;: &quot;false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;configurations&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;classification&quot;: &quot;spark&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;maximizeResourceAllocation&quot;: &quot;false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;configurations&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;classification&quot;: &quot;spark-defaults&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.executor.memory&quot;: &quot;7G&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.driver.memory&quot;: &quot;7G&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.driver.cores&quot;: &quot;3&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.yarn.driver.memoryOverhead&quot;: &quot;1024&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.default.parallelism&quot;: &quot;24&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.executor.cores&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.executor.instances&quot;: &quot;6&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.yarn.executor.memoryOverhead&quot;: &quot;1024&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark.dynamicAllocation.enabled&quot;: &quot;false&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;configurations&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;applications&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;Hadoop&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;Spark&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a typical cluster configuration for processing ~1.5GB of uncompressed enriched data.</p><p>You need to change the following settings with your own values:</p><ul><li><code>region</code>: the AWS region of your EMR cluster</li><li><code>logUri</code>: the location of an S3 bucket where EMR logs will be written</li><li><code>ec2.keyName</code> (optional): The name of an EC2 key pair that you’ll use to shh into the EMR cluster</li><li><code>ec2.location.vpc.subnetId</code>: your VPN subnet ID.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-snowplow-transformer-batch">Configuring <code>snowplow-transformer-batch</code><a class="hash-link" href="#configuring-snowplow-transformer-batch" title="Direct link to heading">​</a></h2><p>The transformer takes two configuration files:</p><ul><li>a <code>config.hocon</code> file with application settings</li><li>an <code>iglu_resolver.json</code> file with the resolver configuration for your <a href="https://github.com/snowplow/iglu" target="_blank" rel="noopener noreferrer">Iglu</a> schema registry.</li></ul><p>An example of the minimal required config for the Spark transformer can be found <a href="https://github.com/snowplow/snowplow-rdb-loader/blob/master/config/transformer.batch.config.minimal.hocon" target="_blank" rel="noopener noreferrer">here</a> and a more detailed one <a href="https://github.com/snowplow/snowplow-rdb-loader/blob/master/config/transformer.batch.config.reference.hocon" target="_blank" rel="noopener noreferrer">here</a>. For details about each setting, see the <a href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/rdb-transformer-configuration-reference">configuration reference</a>.</p><p>See <a href="/docs/pipeline-components-and-applications/iglu/iglu-resolver">here</a> for details on how to prepare the Iglu resolver file.</p><p><strong>NOTE:</strong> All self-describing schemas for events processed by the transformer <strong>must</strong> be hosted on <a href="/docs/pipeline-components-and-applications/iglu/iglu-repositories/iglu-server">Iglu Server</a> 0.6.0 or above. <a href="/docs/pipeline-components-and-applications/iglu/iglu-repositories/iglu-central">Iglu Central</a> is a registry containing Snowplow-authored schemas. If you want to use them alongside your own, you will need to add it to your resolver file. Keep it mind that it could override your own private schemas if you give it higher priority. For details on this see <a href="https://discourse.snowplowanalytics.com/t/important-changes-to-iglu-centrals-api-for-schema-lists/5720#how-will-this-affect-my-snowplow-pipeline-3" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-spark-transformer">Running the Spark transformer<a class="hash-link" href="#running-the-spark-transformer" title="Direct link to heading">​</a></h2><p>To run the transformer on EMR with Dataflow Runner, you need:</p><ul><li>the EMR cluster config (see <a href="#configuring-the-emr-cluster">Configuring the EMR cluster</a> above)</li><li>a Dataflow Runner playbook (a DAG with steps to be submitted to the EMR cluster).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-the-dataflow-runner-playbook">Preparing the Dataflow Runner playbook<a class="hash-link" href="#preparing-the-dataflow-runner-playbook" title="Direct link to heading">​</a></h3><p>A typical playbook can look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.dataflowrunner/PlaybookConfig/avro/1-0-1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;region&quot;: &quot;eu-central-1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;credentials&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;accessKeyId&quot;: &quot;env&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;secretAccessKey&quot;: &quot;env&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;steps&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;type&quot;: &quot;CUSTOM_JAR&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;name&quot;: &quot;S3DistCp enriched data archiving&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;actionOnFailure&quot;: &quot;CANCEL_AND_WAIT&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;jar&quot;: &quot;/usr/share/aws/emr/s3-dist-cp/lib/s3-dist-cp.jar&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;arguments&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--src&quot;, &quot;s3://com-acme/enriched/sink/&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--dest&quot;, &quot;s3://com-acme/enriched/archive/run={{nowWithFormat &quot;2006-01-02-15-04-05&quot;}}/&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--s3Endpoint&quot;, &quot;s3-eu-central-1.amazonaws.com&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--srcPattern&quot;, &quot;.*&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--outputCodec&quot;, &quot;gz&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--deleteOnSuccess&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;type&quot;: &quot;CUSTOM_JAR&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;name&quot;: &quot;RDB Transformer&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;actionOnFailure&quot;: &quot;CANCEL_AND_WAIT&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;jar&quot;: &quot;command-runner.jar&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;arguments&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;spark-submit&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--class&quot;, &quot;com.snowplowanalytics.snowplow.rdbloader.shredder.batch.Main&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--master&quot;, &quot;yarn&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--deploy-mode&quot;, &quot;cluster&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;s3://snowplow-hosted-assets-eu-central-1/4-storage/transformer-batch/snowplow-transformer-batch-4.1.0.jar&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--iglu-config&quot;, &quot;{{base64File &quot;/home/snowplow/configs/snowplow/iglu_resolver.json&quot;}}&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;--config&quot;, &quot;{{base64File &quot;/home/snowplow/configs/snowplow/config.hocon&quot;}}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;tags&quot;: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This playbook consists of two steps. The first one copies the enriched data to a dedicated directory, from which the transformer will read it. The second step is the transformer Spark job that transforms the data.</p><p>You need to change the following settings with your own values:</p><ul><li><code>region</code>: the AWS region of the EMR cluster</li><li><code>&quot;--src&quot;</code>: the bucket in which your enriched data is sunk by Enrich</li><li><code>&quot;--dest&quot;</code>: the bucket in which the data for your enriched data lake lives.</li></ul><p><strong>NOTE:</strong> The <code>&quot;--src&quot;</code> and <code>&quot;--dest&quot;</code> settings above apply only to the <code>s3DistCp</code> step of the playbook. The source and destination buckets for the transformer step are configured via the <code>config.hocon</code> file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="submitting-the-job-to-emr-with-dataflow-runner">Submitting the job to EMR with Dataflow Runner<a class="hash-link" href="#submitting-the-job-to-emr-with-dataflow-runner" title="Direct link to heading">​</a></h3><p>Here&#x27;s an example of putting all of the above together on a transient EMR cluster:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./dataflow-runner run-transient \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --emr-config path/to/cluster.conig \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --emr-playbook path/to/playbook</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will spin up the cluster with the above configuration, submit the steps from the playbook, and terminate the cluster once all steps are completed.</p><p>For more examples on running EMR jobs with Dataflow Runner, as well as details on cluster configurations and playbooks, see the app&#x27;s <a href="/docs/pipeline-components-and-applications/dataflow-runner">documentation</a>. It also details how you can submit steps to a persistent EMR cluster.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/spark-transformer/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-25T10:52:08.000Z">Aug 25, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Transforming enriched data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/transforming-enriched-data/stream-transformer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stream transformer</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#downloading-the-artefact" class="table-of-contents__link toc-highlight">Downloading the artefact</a></li><li><a href="#configuring-the-emr-cluster" class="table-of-contents__link toc-highlight">Configuring the EMR cluster</a></li><li><a href="#configuring-snowplow-transformer-batch" class="table-of-contents__link toc-highlight">Configuring <code>snowplow-transformer-batch</code></a></li><li><a href="#running-the-spark-transformer" class="table-of-contents__link toc-highlight">Running the Spark transformer</a><ul><li><a href="#preparing-the-dataflow-runner-playbook" class="table-of-contents__link toc-highlight">Preparing the Dataflow Runner playbook</a></li><li><a href="#submitting-the-job-to-emr-with-dataflow-runner" class="table-of-contents__link toc-highlight">Submitting the job to EMR with Dataflow Runner</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9e6ea025.js"></script>
<script src="/assets/js/main.957d7bc5.js"></script>
</body>
</html>