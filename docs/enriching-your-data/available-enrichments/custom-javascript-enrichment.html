<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-enriching-your-data/available-enrichments/custom-javascript-enrichment/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159566509-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M24XMJD"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-M24XMJD",{anonymize_ip:!0})</script><title data-rh="true">Custom JavaScript enrichment | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplowanalytics.com/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Custom JavaScript enrichment | Snowplow Documentation"><meta data-rh="true" name="description" content="Description"><meta data-rh="true" property="og:description" content="Description"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplowanalytics.com/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cb54eed0.css">
<link rel="preload" href="/assets/js/runtime~main.fbf54d6f.js" as="script">
<link rel="preload" href="/assets/js/main.82ee80ee.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link nav-link__first customized_AOMy navbar__link--active" href="/docs">Docs</a><a href="https://discourse.snowplowanalytics.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://try.snowplowanalytics.com/?utm_content=hero-cta&amp;utm_campaign=snowplow-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Try Snowplow</a><a href="https://go.snowplowanalytics.com/l/571483/2021-02-19/3sn5nml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Book a demo</a><div class="toggle_vylO extraSpace_k8HL"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG extraPadding_YQbj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/enriching-your-data">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/what-is-enrichment">What is the enrichment process?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/configuring-enrichments">Managing enrichments in the console</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/enriching-your-data/available-enrichments">Available enrichments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Available enrichments&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/http-header-extractor-enrichment">HTTP header extractor enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/campaign-attribution-enrichment">Campaign attribution enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/ip-lookup-enrichment">IP Lookup enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/yauaa-enrichment">YAUAA enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/ip-anonymization-enrichment">IP anonymization enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/referrer-parser-enrichment">Referer parser enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/cookie-extractor-enrichment">Cookie extractor enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/ua-parser-enrichment">UA parser enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/custom-sql-enrichment">Custom SQL enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/event-fingerprint-enrichment">Event fingerprint enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment">Custom JavaScript enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/pii-pseudonymization-enrichment">PII pseudonymization enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/currency-conversion-enrichment">Currency conversion enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/custom-api-request-enrichment">Custom API Request enrichment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enriching-your-data/available-enrichments/iab-enrichment">IAB enrichment</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/modeling-your-data">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/managing-data-quality">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/pipeline-components-and-applications">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/enriching-your-data"><span itemprop="name">Enriching your data</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/enriching-your-data/available-enrichments"><span itemprop="name">Available enrichments</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Custom JavaScript enrichment</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Custom JavaScript enrichment</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a class="hash-link" href="#description" title="Direct link to heading">​</a></h2><p>This enrichment lets you write a JavaScript function which is executed in the enrichment process for each enriched event. Use this enrichment to apply your own business logic to your enriched events at the row-level.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>The custom JavaScript enrichment is a great example of the power of Snowplow.</p><p>Through this functionality the ability to “data widen” your events at the row level, means that if you have access to a unique data set that can be used to give a higher level of detail and context around certain events you are collecting, you can insert them at this enrichment step before writing to your data store.</p><p>Since your company has a unique set of customers and likely a unique set of data points that speak towards the behavioural interactions customers have with your site or applications, the more information you can capture at the time of the event means the more insight you can find in the analysis of those events.</p><p>JavaScript Language Features</p><p>JavaScript enrichment uses <a href="https://docs.oracle.com/javase/10/nashorn/introduction.htm" target="_blank" rel="noopener noreferrer">Nashorn Engine</a> and since version 3.0.0 of enrich, many features of ECMAScript 6 are supported. Please refer to <a href="http://openjdk.java.net/jeps/292" target="_blank" rel="noopener noreferrer">this page</a> to know what is supported. About the uncertainty mentioned, our testing shows that classes and generators don&#x27;t work, but tail calls do.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/javascript_script_config/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer">schema</a></li><li><a href="https://github.com/snowplow/enrich/blob/master/config/enrichments/javascript_script_enrichment.json" target="_blank" rel="noopener noreferrer">example</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-example">Simple Example<a class="hash-link" href="#simple-example" title="Direct link to heading">​</a></h2><p>Although the use cases for this enrichment can be endless, they don’t need to only serve analytics purposes. A very useful case might be in anti-spoofing for instance. You might want to make sure that the events being sent over are from your app or website rather than one spoofed by a hacker.</p><p>To do so you might write a Javascript function that checks if a secret key is valid server side, and only then set the event with the correct “app<!-- -->_<!-- -->id” variable that denotes it is a valid event from your property.</p><p>Taking this example further, you could do something like notify the user that sent the event that they are likely on a spoofing website.</p><p>Here’s an example snippet of code relating to the above:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var SECRET_APP_ID = &quot;Joshua&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> * Performs two roles:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> * 1. If this is a server-side event, we</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *    validate that the app_id is our</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *    valid secret. Prevents spoofing of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *    our server-side events</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> * 2. If app_id is not null, return a new</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *    Acme context, derived_app_id, which</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *    contains the upper-cased app_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">function process(event) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var appId = event.getApp_id();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (platform == &quot;server&quot; &amp;&amp; appId != SECRET_APP_ID) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        throw &quot;Server-side event has invalid app_id: &quot; + appId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (appId == null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var appIdUpper = new String(appId.toUpperCase());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return [ { schema: &quot;iglu:com.acme/derived_app_id/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               data:  { appIdUpper: appIdUpper } } ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-event-data">Working with event data<a class="hash-link" href="#working-with-event-data" title="Direct link to heading">​</a></h2><p>The event variable that is provided to the JavaScript function can be queried to retrieve any information stored in the event. The example below provides an example on how to retrieve a <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracking-specific-events#Tracking_custom_self-describing_unstructured_events">custom event</a> and a <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v2/tracking-specific-events#Custom_contexts">custom context</a> from an event. A full list of the available information can be found by looking at the <a href="https://github.com/snowplow/enrich/blob/81d108152b54961867cd1f6218b22465afb5c083/modules/common/src/main/scala/com.snowplowanalytics.snowplow.enrich/common/outputs/EnrichedEvent.scala" target="_blank" rel="noopener noreferrer">class definition of an Event</a>.</p><p>The JavaScript enrichment can be used to add additional contextual information into the Snowplow event. This is defined as a JSON array where each entry of the array is a custom context. See the example below for how this is formatted.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* process()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* Entry point for the Javascript enrichment function. Executed using Nashorn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* @param {EnrichedEvent} event Snowplow event to perform enrichment on.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* @returns {JSON Array} additional custom context to add to the event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">function process(event) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // get a custom event (if available) in JSON format from the snowplow event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var customEvent = JSON.parse(event.getUnstruct_event());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // get the schema from the custom event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var customEventSchema = customEvent.data.schema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // get the data from the custom event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var customEventData = customEvent.data.data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // get contexts (if available) in JSON format from the snowplow event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var contexts = JSON.parse(event.getContexts());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var contextArray = contexts.data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // get the schema for the first custom context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var firstCustomContextSchema = contextArray[0].schema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // default response to return if not adding any additional custom contexts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var responseJSON = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // add a custom context to the array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    responseString = &#x27;{&quot;schema&quot;: &quot;iglu:com.example/example_entity/jsonschema/1-0-0&quot;, &quot;data&quot;: {&quot;content&quot;: &quot;content&quot;, &quot;task_id&quot;: &quot;a439e001-c058-4f06-b975-89733096df35&quot;, &quot;timestamp&quot;: &quot;2020-09-25 15:47:25&quot;}}&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    responseJSON.push(JSON.parse(responseString));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // return the new custom contexts to Snowplow for validation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return responseJSON;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-javascript">Working with JavaScript<a class="hash-link" href="#working-with-javascript" title="Direct link to heading">​</a></h2><p>The JavaScript enrichment in Snowplow is executed using Nashorn. This provides many <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/" target="_blank" rel="noopener noreferrer">libraries and functions</a> to power complex use cases.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dos-and-donts">Do&#x27;s and Don&#x27;ts<a class="hash-link" href="#dos-and-donts" title="Direct link to heading">​</a></h2><p>Manipulating your event stream with Javascript is bother powerful and can be dangerous.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="do">Do:<a class="hash-link" href="#do" title="Direct link to heading">​</a></h3><ul><li>use <a href="https://github.com/snowplow/snowplow/tags" target="_blank" rel="noopener noreferrer">Snowplow version tags</a> to confirm the fields available in your Snowplow version’s enriched event POJO</li><li>return as many contexts as you want</li><li>throw an exception if you want this enriched event to end up in the Bad Bucket or Bad Stream</li><li>include minified, self-contained JavaScript libraries that your <code>process(event)</code> function needs</li><li>test this enrichment on sample sets of events before putting it into production</li><li>ensure your new contexts are defined in Iglu, Redshift, JSON Paths etc</li><li>use es5 javascript features</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dont">Don’t:<a class="hash-link" href="#dont" title="Direct link to heading">​</a></h3><ul><li>mutate existing fields in the supplied enriched event – return a new context instead</li><li>try to share state across multiple enriched events – write your own Scalding or Spark job instead</li><li>include CPU-intensive tasks without being aware of the impact on your event processing time</li><li>allow untrusted parties to write your script – the script has access to the Java standard library and therefore to your filesystem.</li><li>use es6 javascript features</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uploading-a-custom-javascript-enrichment-to-snowplow-bdp">Uploading a custom JavaScript enrichment to Snowplow BDP<a class="hash-link" href="#uploading-a-custom-javascript-enrichment-to-snowplow-bdp" title="Direct link to heading">​</a></h2><p>The Snowplow BDP Console can be used to upload a custom JavaScript enrichment to your Snowplow Mini(s) and pipeline(s).</p><p>You will need to convert your Javascript code to base64, and add it to the script parameter in the configuration.</p><p>Then follow the <a href="/docs/enriching-your-data/configuring-enrichments">documentation on uploading enrichments</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="output">Output<a class="hash-link" href="#output" title="Direct link to heading">​</a></h2><p>This enrichment is the only one that can both update fields of the atomic event in-place or/and add derived contexts to the enriched event.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/enriching-your-data/available-enrichments/custom-javascript-enrichment/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-26T14:03:15.000Z">Aug 26, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/enriching-your-data/available-enrichments/event-fingerprint-enrichment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Event fingerprint enrichment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/enriching-your-data/available-enrichments/pii-pseudonymization-enrichment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PII pseudonymization enrichment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link toc-highlight">Description</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#simple-example" class="table-of-contents__link toc-highlight">Simple Example</a></li><li><a href="#working-with-event-data" class="table-of-contents__link toc-highlight">Working with event data</a></li><li><a href="#working-with-javascript" class="table-of-contents__link toc-highlight">Working with JavaScript</a></li><li><a href="#dos-and-donts" class="table-of-contents__link toc-highlight">Do&#39;s and Don&#39;ts</a><ul><li><a href="#do" class="table-of-contents__link toc-highlight">Do:</a></li><li><a href="#dont" class="table-of-contents__link toc-highlight">Don’t:</a></li></ul></li><li><a href="#uploading-a-custom-javascript-enrichment-to-snowplow-bdp" class="table-of-contents__link toc-highlight">Uploading a custom JavaScript enrichment to Snowplow BDP</a></li><li><a href="#output" class="table-of-contents__link toc-highlight">Output</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/cookie-settings">Change cookie settings</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/terms-and-conditions">Terms and conditions</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fbf54d6f.js"></script>
<script src="/assets/js/main.82ee80ee.js"></script>
</body>
</html>