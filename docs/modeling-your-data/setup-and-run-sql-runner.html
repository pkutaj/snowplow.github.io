<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-modeling-your-data/setup-and-run-sql-runner/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159566509-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M24XMJD"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-M24XMJD",{anonymize_ip:!0})</script><title data-rh="true">Setup and run SQL Runner | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplowanalytics.com/docs/modeling-your-data/setup-and-run-sql-runner"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Setup and run SQL Runner | Snowplow Documentation"><meta data-rh="true" name="description" content="SQL Runner enables you to execute SQL scripts against the Snowplow data in your data warehouse. Specifically, it allows you to organize your SQL scripts in templatable playbooks, and execute them in series or in parallel on Snowflake, Amazon Redshift, GCP BigQuery and PostgreSQL."><meta data-rh="true" property="og:description" content="SQL Runner enables you to execute SQL scripts against the Snowplow data in your data warehouse. Specifically, it allows you to organize your SQL scripts in templatable playbooks, and execute them in series or in parallel on Snowflake, Amazon Redshift, GCP BigQuery and PostgreSQL."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplowanalytics.com/docs/modeling-your-data/setup-and-run-sql-runner"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/modeling-your-data/setup-and-run-sql-runner" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplowanalytics.com/docs/modeling-your-data/setup-and-run-sql-runner" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0deba8e4.css">
<link rel="preload" href="/assets/js/runtime~main.b4fd5120.js" as="script">
<link rel="preload" href="/assets/js/main.71848256.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-icon-light-purple.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-icon-light-purple.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Snowplow Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/enriching-your-data">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/modeling-your-data">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modeling-your-data/what-is-data-modeling">What is data modeling?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/modeling-your-data/the-snowplow-web-data-model">The Snowplow web data model</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Snowplow web data model&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/modeling-your-data/the-snowplow-mobile-data-model">The Snowplow mobile data model</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Snowplow mobile data model&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/modeling-your-data/setup-and-run-sql-runner">Setup and run SQL Runner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modeling-your-data/configuring-and-running-data-models-via-snowplow-bdp">Configuring and running data models via Snowplow BDP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modeling-your-data/resolving-data-model-failures-via-snowplow-bdp">Resolving data model failures (via Snowplow BDP)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modeling-your-data/retrieving-job-execution-data-via-the-api">Retrieving data model execution data via the API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/modeling-your-data/analytics-sdk">Analytics SDKs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Analytics SDKs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/managing-data-quality">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/pipeline-components-and-applications">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/modeling-your-data"><span itemprop="name">Modeling your data</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Setup and run SQL Runner</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Setup and run SQL Runner</h1></header><p><a href="https://github.com/snowplow/sql-runner" target="_blank" rel="noopener noreferrer">SQL Runner</a> enables you to execute SQL scripts against the Snowplow data in your data warehouse. Specifically, it allows you to organize your SQL scripts in templatable playbooks, and execute them in series or in parallel on Snowflake, Amazon Redshift, GCP BigQuery and PostgreSQL.</p><p>To set up SQL Runner, Snowplow open source users can start from the <a href="/docs/modeling-your-data/setup-and-run-sql-runner#user-guide">User guide</a> .</p><p>For Snowplow BDP customers, SQL Runner is already setup as part of your pipeline, so you can <a href="/docs/modeling-your-data/configuring-and-running-data-models-via-snowplow-insights">get started</a> with configuring and deploying your SQL data models immediately.</p><p>A SQL Runner data model consists of:</p><ul><li>SQL files (containing one or more SQL statements)</li><li>Playbooks (YAML files organizing the SQL into steps)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="playbooks"><strong>Playbooks</strong><a class="hash-link" href="#playbooks" title="Direct link to heading">​</a></h3><p>A playbook consists of one of more <em>steps</em>, each of which consists of one or more <em>queries</em>. Steps are run in series, queries are run in parallel within the step.</p><p>Each query contains the path to a <em>query file</em>. </p><p>All steps are applied against all <em>targets</em>. All targets are processed in parallel.</p><p>In the following example, a.sql, b.sql and c.sql are run in parallel.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">:steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - :name: &quot;Run a,b and c in parallel&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: a.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: b.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: c.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By contrast, in the example below, the three SQL files are executed in sequence.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">:steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - :name: &quot;Run a...&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: a.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - :name: &quot;...then run b...&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: b.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - :name: &quot;...then run c...&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: c.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Playbooks can be templated, and corresponding variables can be passed in with the var flag like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sql-runner -var host=value,username=value2,password=value3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is the corresponding playbook template:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">:targets:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- :name: &quot;My Postgres database 1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :type: postgres</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :host: {{.host}}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :database: sql_runner_tests_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :port: 5432</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :username: {{.username}}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :password: {{.password}}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :ssl: false # SSL disabled by default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">:variables:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :test_schema: sql_runner_tests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :timeFormat: &quot;2006_01_02&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">:steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- :name: Create schema and table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    - :name: Create schema and table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      :file: postgres-sql/good/1.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      :template: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-files"><strong>SQL files</strong><a class="hash-link" href="#sql-files" title="Direct link to heading">​</a></h3><p>A query file contains one or more SQL statements. These are executed &quot;raw&quot; (i.e. not in a transaction) in series by SQL Runner. If the query file is flagged as a <em>template</em> in the playbook, then the file is pre-processed as a template before being executed.</p><p><strong>Note</strong>: If your query is a template that requires pre-processing, you must add <code>template: true</code> to the query definition in the playbook yml file, for example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">:name: &quot;Run a..&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    :queries:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - :name: a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :file: a.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        :template: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="templates">Templates<a class="hash-link" href="#templates" title="Direct link to heading">​</a></h3><p>Templates are run through Golang&#x27;s <a href="https://pkg.go.dev/text/template" target="_blank" rel="noopener noreferrer">text template processor</a>. The template processor can access all <em>variables</em> defined in the playbook.</p><p>The following custom functions are also supported:</p><ul><li><code>nowWithFormat [timeFormat]</code>: where <code>timeFormat</code> is a valid Golang <a href="http://golang.org/pkg/time/#Time.Format" target="_blank" rel="noopener noreferrer">time format</a></li><li><code>systemEnv &quot;ENV_VAR&quot;</code>: where <code>ENV_VAR</code> is a key for a valid environment variable</li><li><code>awsEnvCredentials</code>: supports passing credentials through environment variables, such as <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code></li><li><code>awsProfileCredentials</code>: supports getting credentials from a credentials file, also used by boto/awscli</li><li><code>awsEC2RoleCredentials</code>: supports getting role-based credentials, i.e. getting the automatically generated credentials in EC2 instances</li><li><code>awsChainCredentials</code>: tries to get credentials from each of the three methods above in order, using the first one returned</li><li><code>randomInt</code>: will return a random integer</li></ul><p><strong>Note</strong>: All AWS functions output strings in the Redshift credentials format (<code>CREDENTIALS &#x27;aws_access_key_id=%s;aws_secret_access_key=%s&#x27;</code>).</p><p>For an example query file using templating see: <a href="https://github.com/snowplow/sql-runner/blob/master/integration/resources/postgres-sql/good/3.sql" target="_blank" rel="noopener noreferrer">integration/resources/postgres-sql/good/3.sql</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="failure-modes"><strong>Failure modes</strong><a class="hash-link" href="#failure-modes" title="Direct link to heading">​</a></h3><p>If a statement fails in a query file, the query will terminate and report failure.</p><p>If a query fails, its sibling queries will continue running, but no further steps will run.</p><p>Failures in one target do not affect other targets in any way.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="return-codes"><strong>Return codes</strong><a class="hash-link" href="#return-codes" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">- 0 for no errors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- 5 for target initialization errors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- 6 for query errors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- 7 for both types of error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- 8 for no queries run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target-configuration"><strong>Target configuration</strong><a class="hash-link" href="#target-configuration" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="redshift"><strong>Redshift</strong><a class="hash-link" href="#redshift" title="Direct link to heading">​</a></h4><p>If your storage target is Amazon Redshift, then the target configuration in the playbook is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: &quot;My Redshift database&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: redshift</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    host: ADD HERE # The endpoint as shown in the Redshift console</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    database: ADD HERE # Name of database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    port: 5439 # Default Redshift port</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    username: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    password: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl: false # SSL disabled by default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bigquery"><strong>BigQuery</strong><a class="hash-link" href="#bigquery" title="Direct link to heading">​</a></h4><p>To access a BigQuery project, sql-runner will need some Google credentials. These can be set up by creating a new service account in the GCP console, then providing its private key to the application via a GOOGLE<!-- -->_<!-- -->APPLICATION<!-- -->_<!-- -->CREDENTIALS environment variable - a detailed walkthrough of this process is available on the <a href="https://cloud.google.com/docs/authentication/production#obtaining_and_providing_service_account_credentials_manually" target="_blank" rel="noopener noreferrer">GCP documentation website</a>.</p><p>After the credentials are set up, simply create a playbook with the following BigQuery-specific target configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: &quot;My BigQuery database&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: bigquery</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    project: ADD HERE # Project ID as shown in the GCP console&#x27;s front page</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="snowflake"><strong>Snowflake</strong><a class="hash-link" href="#snowflake" title="Direct link to heading">​</a></h4><p>If your data warehouse is Snowflake, then the SQL Runner playbooks will have a target configuration as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: &quot;My Snowflake database&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: snowflake</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    account: ADD HERE # Your Snowflake account name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    database: ADD HERE # Name of database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    warehouse: ADD HERE # Name of warehouse to run the queries</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    username: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    password: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    host: # Leave blank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    port: # Leave blank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl: true # Snowflake connection is always secured by TLS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_tag: ADD HERE # optional, available since v0.10.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>query_tag</code> parameter sets the <code>QUERY_TAG</code> <a href="https://docs.snowflake.com/en/sql-reference/parameters.html#query-tag" target="_blank" rel="noopener noreferrer">session parameter</a> in Snowflake. When set, it will be applied to all queries included in the playbook.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="postgresql"><strong>PostgreSQL</strong><a class="hash-link" href="#postgresql" title="Direct link to heading">​</a></h4><p>Finally, if your storage target is PostgreSQL, then can be configured as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - name: &quot;My Postgres database&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: postgres</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    host: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    database: ADD HERE # Name of database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    port: 5432 # Default Postgres port</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    username: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    password: ADD HERE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl: false # SSL disabled by default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">variables:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That&#x27;s it - you&#x27;re now ready to start running SQL against your data warehouse!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="user-guide">User guide<a class="hash-link" href="#user-guide" title="Direct link to heading">​</a></h2><p>SQL Runner is a zero-dependency binary and can be found as a <a href="https://github.com/snowplow/sql-runner/releases/latest" target="_blank" rel="noopener noreferrer">release asset</a> for:</p><ul><li><a href="https://github.com/snowplow/sql-runner/releases/download/0.10.0/sql_runner_0.10.0_darwin_amd64.zip" target="_blank" rel="noopener noreferrer">macOS</a></li><li><a href="https://github.com/snowplow/sql-runner/releases/download/0.10.0/sql_runner_0.10.0_linux_amd64.zip" target="_blank" rel="noopener noreferrer">Linux</a></li><li><a href="https://github.com/snowplow/sql-runner/releases/download/0.10.0/sql_runner_0.10.0_windows_amd64.zip" target="_blank" rel="noopener noreferrer">Windows</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cli-arguments">CLI Arguments<a class="hash-link" href="#cli-arguments" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">./sql-runner --help</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sql-runner version: 0.10.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Run playbooks of SQL scripts in series and parallel on Redshift, Postgres, BigQuery and Snowflake</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -checkLock string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Checks whether the lockfile already exists</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -consul string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        The address of a consul server with playbooks and SQL files stored in KV pairs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -consulOnlyForLock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Will read playbooks locally, but use Consul for locking.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -deleteLock string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Will attempt to delete a lockfile if it exists</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -dryRun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Runs through a playbook without executing any of the SQL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -fillTemplates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Will print all queries after templates are filled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -fromStep string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Starts from a given step defined in your playbook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -help</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Shows this message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -lock string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Optional argument which checks and sets a lockfile to ensure this run is a singleton. Deletes lock on run completing successfully</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -playbook string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Playbook of SQL scripts to execute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -runQuery string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Will run a single query in the playbook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -showQueryOutput</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Will print all output from queries</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -softLock string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Optional argument, like &#x27;-lock&#x27; but the lockfile will be deleted even if the run fails</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -sqlroot string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Absolute path to SQL scripts. Use PLAYBOOK, BINARY and PLAYBOOK_CHILD for those respective paths (default &quot;PLAYBOOK&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -var value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Variables to be passed to the playbook, in the key=value format</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Shows the program version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="more-on-consul">More on Consul<a class="hash-link" href="#more-on-consul" title="Direct link to heading">​</a></h4><p>Using the <code>-consul</code> argument results in the following changes:</p><ul><li>The <code>-playbook</code> argument becomes the key that is used to look for the playbook in Consul.</li><li>The <code>-sqlroot</code> argument also becomes a key argument for Consul.</li><li>The <code>-lock</code> argument creates a lock as a Consul key value pair</li><li>The <code>-softLock</code> argument creates a lock as a Consul key value pair</li><li>The <code>-checkLock</code> argument searches in Consul for a lock</li><li>The <code>-deleteLock</code> argument searches in Consul for a lock</li></ul><p>If you pass in the default:</p><ul><li><code>./sql-runner -consul &quot;localhost:8500&quot; -playbook &quot;sql-runner/playbook/1&quot;</code></li></ul><p>This results in:</p><ul><li>Looking for your playbook file at this key <code>sql-runner/playbook/1</code></li><li>Expecting all your SQL file keys to begin with <code>sql-runner/playbook/&lt;SQL path from playbook&gt;</code></li></ul><p>However as the key here can be used as a both a data and folder node we have added a new sqlroot option:</p><ul><li><code>./sql-runner -consul &quot;localhost:8500&quot; -playbook &quot;sql-runner/playbook/1&quot; -sqlroot PLAYBOOK_CHILD</code></li></ul><p>This results in:</p><ul><li>Looking for your playbook file at this key <code>sql-runner/playbook/1</code></li><li>Expecting all your SQL file keys to begin with <code>sql-runner/playbook/1/&lt;SQL path from playbook&gt;</code><ul><li>The data node is used as a folder node as well.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/modeling-your-data/setup-and-run-sql-runner/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-22T15:58:35.000Z">Aug 22, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/modeling-your-data/the-snowplow-mobile-data-model/dbt-mobile-data-model"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">dbt: Mobile data model</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/modeling-your-data/configuring-and-running-data-models-via-snowplow-bdp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuring and running data models via Snowplow BDP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#playbooks" class="table-of-contents__link toc-highlight"><strong>Playbooks</strong></a></li><li><a href="#sql-files" class="table-of-contents__link toc-highlight"><strong>SQL files</strong></a></li><li><a href="#templates" class="table-of-contents__link toc-highlight">Templates</a></li><li><a href="#failure-modes" class="table-of-contents__link toc-highlight"><strong>Failure modes</strong></a></li><li><a href="#return-codes" class="table-of-contents__link toc-highlight"><strong>Return codes</strong></a></li><li><a href="#target-configuration" class="table-of-contents__link toc-highlight"><strong>Target configuration</strong></a></li><li><a href="#user-guide" class="table-of-contents__link toc-highlight">User guide</a><ul><li><a href="#cli-arguments" class="table-of-contents__link toc-highlight">CLI Arguments</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/snowplow/snowplow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub for Open Source Snowplow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discourse.snowplowanalytics.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://snowplowanalytics.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.meetup.com/topics/snowplow/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetups<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://snowplowanalytics.com/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b4fd5120.js"></script>
<script src="/assets/js/main.71848256.js"></script>
</body>
</html>